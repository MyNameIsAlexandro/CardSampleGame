# Спецификация Investigator Pack

> **Версия:** 1.0
> **Статус:** Активна
> **Обновлено:** Январь 2026

---

## 1. Обзор

### 1.1 Назначение

Investigator Pack предоставляет игровых персонажей-героев с их стартовыми колодами, способностями и связанными картами. Эти паки фокусируются на кастомизации персонажей и возможностях построения колоды.

### 1.2 Область применения

Данная спецификация охватывает:
- Структуру пака и требования к манифесту
- Схемы определения героев
- Схемы определения карт
- Правила составления стартовой колоды
- Функциональные и нефункциональные требования

### 1.3 Терминология

| Термин | Определение |
|--------|-------------|
| **Hero** | Игровой персонаж с характеристиками и способностями |
| **Starting Deck** | Начальный набор карт героя |
| **Hero Class** | Архетип, определяющий стиль игры |
| **Ability** | Особая способность, уникальная для героя |
| **Card** | Играбельный элемент в бою и событиях |

---

## 2. Функциональные требования

### 2.1 Основная функциональность

| ID | Требование | Приоритет |
|----|------------|-----------|
| FR-INV-001 | Пак ДОЛЖЕН определять хотя бы одного героя | Обязательно |
| FR-INV-002 | Каждый герой ДОЛЖЕН иметь валидную стартовую колоду | Обязательно |
| FR-INV-003 | Пак МОЖЕТ определять дополнительные карты | Опционально |
| FR-INV-004 | Все карты в стартовой колоде ДОЛЖНЫ существовать | Обязательно |
| FR-INV-005 | Пак МОЖЕТ зависеть от других паков для карт | Опционально |

### 2.2 Требования к героям

| ID | Требование | Приоритет |
|----|------------|-----------|
| FR-HRO-001 | Герой ДОЛЖЕН иметь уникальный ID | Обязательно |
| FR-HRO-002 | Герой ДОЛЖЕН иметь локализованное имя и описание | Обязательно |
| FR-HRO-003 | Герой ДОЛЖЕН принадлежать к классу | Обязательно |
| FR-HRO-004 | Герой ДОЛЖЕН иметь базовые характеристики | Обязательно |
| FR-HRO-005 | Герой ДОЛЖЕН иметь стартовую колоду (мин. 6 карт) | Обязательно |
| FR-HRO-006 | Герой ДОЛЖЕН иметь особую способность | Рекомендуется |
| FR-HRO-007 | Герой МОЖЕТ иметь несколько способностей | Опционально |
| FR-HRO-008 | Герой МОЖЕТ иметь условия разблокировки | Опционально |

### 2.3 Требования к картам

| ID | Требование | Приоритет |
|----|------------|-----------|
| FR-CRD-001 | Карта ДОЛЖНА иметь уникальный ID | Обязательно |
| FR-CRD-002 | Карта ДОЛЖНА иметь локализованное название | Обязательно |
| FR-CRD-003 | Карта ДОЛЖНА иметь тип | Обязательно |
| FR-CRD-004 | Карта ДОЛЖНА иметь редкость | Обязательно |
| FR-CRD-005 | Карта ДОЛЖНА определять правила владения | Обязательно |
| FR-CRD-006 | Карта МОЖЕТ иметь особые способности | Опционально |
| FR-CRD-007 | Карта МОЖЕТ иметь классовые ограничения | Опционально |

### 2.4 Правила построения колоды

| ID | Требование | Приоритет |
|----|------------|-----------|
| FR-DEC-001 | Стартовая колода ДОЛЖНА содержать 6-12 карт | Обязательно |
| FR-DEC-002 | Стартовая колода ДОЛЖНА соответствовать стилю героя | Рекомендуется |
| FR-DEC-003 | Стартовая колода МОЖЕТ содержать дубликаты | Опционально |
| FR-DEC-004 | Колода ДОЛЖНА соблюдать правила владения картами | Обязательно |

---

## 3. Нефункциональные требования

### 3.1 Производительность

| ID | Требование | Цель |
|----|------------|------|
| NFR-PERF-001 | Время загрузки пака | < 200мс |
| NFR-PERF-002 | Максимум героев на пак | 20 |
| NFR-PERF-003 | Максимум карт на пак | 200 |
| NFR-PERF-004 | Максимальный размер файла | 5MB |

### 3.2 Совместимость

| ID | Требование | Цель |
|----|------------|------|
| NFR-COMP-001 | Совместимость версий ядра | Семантическое версионирование |
| NFR-COMP-002 | Проверка доступности карт | Runtime валидация |
| NFR-COMP-003 | Кросс-пак ссылки на карты | Через зависимости |

### 3.3 Баланс

| ID | Требование | Цель |
|----|------------|------|
| NFR-BAL-001 | Характеристики героя в пределах границ | Валидировано |
| NFR-BAL-002 | Уровень силы стартовой колоды | Сравнимо с базовыми героями |
| NFR-BAL-003 | Кулдауны способностей | Минимум 1 ход |

---

## 4. Схемы данных

### 4.1 Схема манифеста

```json
{
  "$schema": "investigator-pack-manifest-v1",
  "id": "string (обязательно, уникальный)",
  "name": "LocalizedString (обязательно)",
  "description": "LocalizedString (обязательно)",
  "version": "SemanticVersion (обязательно)",
  "type": "investigator (обязательно)",
  "core_version_min": "SemanticVersion (обязательно)",
  "core_version_max": "SemanticVersion | null",
  "dependencies": "PackDependency[] (опционально)",
  "heroes_path": "string (обязательно, относительный путь)",
  "cards_path": "string (опционально, относительный путь)",
  "locales": "string[] (по умолчанию: ['en'])",
  "localization_path": "string (опционально)",
  "recommended_campaigns": "string[] (опционально, ID кампейн-паков)"
}
```

### 4.2 Схема героя

```json
{
  "id": "string (обязательно, уникальный)",
  "name": "string (обязательно, отображаемое имя)",
  "name_ru": "string (опционально, русское имя)",
  "hero_class": "HeroClass (обязательно)",
  "description": "string (обязательно)",
  "description_ru": "string (опционально)",
  "icon": "string (обязательно, имя SF Symbol)",
  "base_stats": "HeroStats (обязательно)",
  "special_ability": "HeroAbility (обязательно)",
  "passive_abilities": "HeroAbility[] (опционально)",
  "starting_deck": "string[] (обязательно, ID карт, мин: 6)",
  "availability": "HeroAvailability (обязательно)",
  "recommended_cards": "string[] (опционально)",
  "lore": "LocalizedString (опционально, предыстория)"
}
```

#### HeroClass

```
warrior | mage | ranger | priest | shadow | alchemist | bard | monk
```

Каждый класс определяет стиль игры:

| Класс | Фокус | Типичные характеристики |
|-------|-------|-------------------------|
| warrior | Ближний бой, защита | Высокая сила, здоровье |
| mage | Заклинания, массовые эффекты | Высокая мудрость |
| ranger | Дальний бой, мобильность | Высокая ловкость |
| priest | Исцеление, поддержка | Высокая вера, мудрость |
| shadow | Скрытность, критические удары | Высокая ловкость |
| alchemist | Предметы, баффы | Сбалансировано |
| bard | Баффы, дебаффы | Высокая харизма |
| monk | Баланс, комбо | Сбалансировано |

#### HeroStats

```json
{
  "health": "integer (обязательно, диапазон: 8-15)",
  "faith": "integer (обязательно, диапазон: 1-10)",
  "strength": "integer (опционально, диапазон: 1-5)",
  "agility": "integer (опционально, диапазон: 1-5)",
  "wisdom": "integer (опционально, диапазон: 1-5)",
  "charisma": "integer (опционально, диапазон: 1-5)"
}
```

#### HeroAbility

```json
{
  "id": "string (обязательно)",
  "name": "string (обязательно)",
  "name_ru": "string (опционально)",
  "description": "string (обязательно)",
  "description_ru": "string (опционально)",
  "ability_type": "active | passive | triggered (обязательно)",
  "cooldown": "integer (опционально, ходы, мин: 1)",
  "uses_per_combat": "integer | null (null = неограниченно)",
  "faith_cost": "integer (опционально, по умолчанию: 0)",
  "effect": "AbilityEffect (обязательно)",
  "icon": "string (опционально, SF Symbol)"
}
```

### 4.3 Схема карты

```json
{
  "id": "string (обязательно, уникальный)",
  "name": "string (обязательно)",
  "name_ru": "string (опционально)",
  "card_type": "CardType (обязательно)",
  "rarity": "CardRarity (обязательно)",
  "description": "string (обязательно)",
  "description_ru": "string (опционально)",
  "icon": "string (обязательно, SF Symbol)",
  "expansion_set": "string (обязательно, идентификатор пака)",
  "ownership": "CardOwnership (обязательно)",
  "class_restriction": "HeroClass | null (опционально)",
  "abilities": "CardAbility[] (опционально)",
  "faith_cost": "integer (по умолчанию: 0)",
  "balance": "light | dark | neutral (по умолчанию: neutral)",
  "power": "integer (опционально, для атакующих карт)",
  "defense": "integer (опционально, для защитных карт)",
  "health_effect": "integer (опционально, для лечебных карт)"
}
```

#### CardType

```
attack | defense | skill | item | spell | ritual | blessing | curse
```

| Тип | Описание |
|-----|----------|
| attack | Наносит урон врагам |
| defense | Блокирует входящий урон |
| skill | Утилитарные эффекты |
| item | Расходуемые или экипировка |
| spell | Магические эффекты |
| ritual | Мощные многоходовые эффекты |
| blessing | Положительные эффекты от веры |
| curse | Негативные эффекты |

#### CardRarity

```
common | uncommon | rare | epic | legendary
```

| Редкость | Шанс выпадения | В стартовой колоде |
|----------|----------------|-------------------|
| common | 50% | Допускается |
| uncommon | 30% | Допускается |
| rare | 15% | Ограничено (макс. 2) |
| epic | 4% | Ограничено (макс. 1) |
| legendary | 1% | Запрещено |

---

## 5. Правила валидации

### 5.1 Валидация героев

| Правило | Описание | Серьёзность |
|---------|----------|-------------|
| VAL-HRO-001 | ID героя должен быть уникальным | Ошибка |
| VAL-HRO-002 | Класс героя должен быть валидным | Ошибка |
| VAL-HRO-003 | Базовые характеристики в пределах границ | Ошибка |
| VAL-HRO-004 | Стартовая колода должна содержать 6-12 карт | Ошибка |
| VAL-HRO-005 | Все карты стартовой колоды должны существовать | Ошибка |
| VAL-HRO-006 | Особая способность должна быть определена | Ошибка |
| VAL-HRO-007 | Иконка должна быть валидным SF Symbol | Предупреждение |

### 5.2 Валидация карт

| Правило | Описание | Серьёзность |
|---------|----------|-------------|
| VAL-CRD-001 | ID карты должен быть уникальным | Ошибка |
| VAL-CRD-002 | Тип карты должен быть валидным | Ошибка |
| VAL-CRD-003 | Редкость должна быть валидной | Ошибка |
| VAL-CRD-004 | Атакующие карты должны иметь power | Предупреждение |
| VAL-CRD-005 | Защитные карты должны иметь defense | Предупреждение |
| VAL-CRD-006 | Стоимость веры должна быть неотрицательной | Ошибка |

### 5.3 Валидация колоды

| Правило | Описание | Серьёзность |
|---------|----------|-------------|
| VAL-DEC-001 | Все карты должны быть доступны герою | Ошибка |
| VAL-DEC-002 | Легендарные карты запрещены в стартовой колоде | Ошибка |
| VAL-DEC-003 | Максимум 2 редкие карты в стартовой колоде | Предупреждение |
| VAL-DEC-004 | Максимум 1 эпическая карта в стартовой колоде | Предупреждение |

---

## 6. API контракт

### 6.1 Интерфейс загрузки

```swift
protocol InvestigatorPackLoader {
    func loadInvestigators(from url: URL) throws -> InvestigatorContent
    func validate(at url: URL) -> ValidationResult
}

struct InvestigatorContent {
    let heroes: [String: StandardHeroDefinition]
    let cards: [String: StandardCardDefinition]
}
```

### 6.2 Интерфейс провайдера героев

```swift
protocol HeroProvider {
    func getHero(id: String) -> StandardHeroDefinition?
    func getAllHeroes() -> [StandardHeroDefinition]
    func getHeroes(forClass: HeroClass) -> [StandardHeroDefinition]
    func getAvailableHeroes() -> [StandardHeroDefinition]
    func getStartingDeck(forHero: String) -> [StandardCardDefinition]
}
```

### 6.3 Интерфейс провайдера карт

```swift
protocol CardProvider {
    func getCard(id: String) -> StandardCardDefinition?
    func getAllCards() -> [StandardCardDefinition]
    func getCards(ofType: CardType) -> [StandardCardDefinition]
    func getCards(forClass: HeroClass) -> [StandardCardDefinition]
    func getCards(forHero: String) -> [StandardCardDefinition]
}
```

---

## 7. Точки расширения

### 7.1 Кастомные классы героев

Новые классы могут быть определены через расширение enum HeroClass. Движок должен быть обновлён для поддержки новых классов, но паки могут подготовить данные героев для будущих классов.

### 7.2 Кастомные типы карт

Типы карт могут быть расширены. Неизвестные типы обрабатываются как "skill" по умолчанию.

### 7.3 Кастомные способности

Кастомные эффекты способностей могут быть зарегистрированы:

```swift
AbilityRegistry.register("my_custom_effect") { context in
    // Реализация кастомного эффекта
}
```

---

## 8. Лучшие практики

### 8.1 Дизайн героя

1. **Чёткая идентичность**: Каждый герой должен иметь уникальный стиль игры
2. **Сбалансированные характеристики**: Суммарные очки характеристик должны быть схожими
3. **Тематические способности**: Способности должны соответствовать лору героя
4. **Синергия стартовой колоды**: Карты должны хорошо работать вместе

### 8.2 Дизайн карт

1. **Понятные эффекты**: Эффекты карт должны быть однозначными
2. **Бюджет силы**: Выше стоимость = сильнее эффект
3. **Классовая идентичность**: Классовые карты должны усиливать стиль игры
4. **Комбо-потенциал**: Некоторые карты должны синергировать

### 8.3 Соглашения об именовании

```
Герои:    {class}_{name}         например, warrior_ragnar
Карты:    {type}_{name}          например, strike_flame
Способности: {hero}_{ability}    например, ragnar_battle_cry
```

---

## 9. Примеры

### 9.1 Минимальный Investigator Pack

```json
// manifest.json
{
  "id": "new-hero-pack",
  "name": { "en": "New Hero Pack" },
  "version": "1.0.0",
  "type": "investigator",
  "core_version_min": "1.0.0",
  "heroes_path": "heroes.json"
}
```

### 9.2 Полное определение героя

```json
{
  "id": "warrior_ragnar",
  "name": "Ragnar the Bold",
  "name_ru": "Рагнар Смелый",
  "hero_class": "warrior",
  "description": "A fearless warrior from the northern lands.",
  "description_ru": "Бесстрашный воин с северных земель.",
  "icon": "shield.lefthalf.filled",
  "base_stats": {
    "health": 12,
    "faith": 3,
    "strength": 4,
    "agility": 2,
    "wisdom": 1
  },
  "special_ability": {
    "id": "ragnar_battle_cry",
    "name": "Battle Cry",
    "name_ru": "Боевой Клич",
    "description": "Boost attack power by 50% for 2 turns.",
    "description_ru": "Увеличивает силу атаки на 50% на 2 хода.",
    "ability_type": "active",
    "cooldown": 3,
    "effect": {
      "effect_type": "buff",
      "target": "self",
      "value": 50,
      "duration": 2,
      "modifier_type": "attack_percent"
    }
  },
  "starting_deck": [
    "strike_basic",
    "strike_basic",
    "strike_basic",
    "defend_basic",
    "defend_basic",
    "rage_strike"
  ],
  "availability": {
    "type": "always"
  }
}
```

---

## 10. Связанные документы

- [CONTENT_PACK_GUIDE.md](./CONTENT_PACK_GUIDE.md) - Общий гайд по пакам
- [SPEC_CAMPAIGN_PACK.md](./SPEC_CAMPAIGN_PACK.md) - Спецификация Campaign Pack
- [SPEC_BALANCE_PACK.md](./SPEC_BALANCE_PACK.md) - Спецификация Balance Pack
- [ENGINE_ARCHITECTURE.md](./ENGINE_ARCHITECTURE.md) - Архитектура движка

---

**Контроль документа**

| Версия | Дата | Автор | Изменения |
|--------|------|-------|-----------|
| 1.0 | 2026-01-20 | Claude | Начальная спецификация |
| 1.0-RU | 2026-01-20 | Claude | Перевод на русский |
