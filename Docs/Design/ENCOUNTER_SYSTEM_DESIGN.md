# Encounter System ‚Äî Design Document (DRAFT)

**–ü—Ä–æ–µ–∫—Ç:** –°—É–º—Ä–∞—á–Ω—ã–µ –ü—Ä–µ–¥–µ–ª—ã (Twilight Marches)
**–í–µ—Ä—Å–∏—è:** 0.1 (Draft ‚Äî –º–µ—Ö–∞–Ω–∏–∫–∏ –∏ UI –º–æ–≥—É—Ç –∏–∑–º–µ–Ω–∏—Ç—å—Å—è)
**–î–∞—Ç–∞:** 29 —è–Ω–≤–∞—Ä—è 2026
**–°—Ç–∞—Ç—É—Å:** DRAFT ‚Äî –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –∫–∞–Ω–æ–Ω–æ–º –¥–æ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è

> **üìú PROJECT_BIBLE.md ‚Äî –∫–æ–Ω—Å—Ç–∏—Ç—É—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞ (Source of Truth).**
> ENGINE_ARCHITECTURE.md ‚Äî SoT –¥–ª—è –∫–æ–¥–∞/–∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤.

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
- [COMBAT_DIPLOMACY_SPEC.md](./COMBAT_DIPLOMACY_SPEC.md) ‚Äî —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –±–æ–µ–≤–æ–π –∏ –¥–∏–ø–ª–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–∏—Å—Ç–µ–º—ã
- [ENGINE_ARCHITECTURE.md](../Technical/ENGINE_ARCHITECTURE.md) ‚Äî –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–≤–∏–∂–∫–∞
- [GAME_DESIGN_DOCUMENT.md](./GAME_DESIGN_DOCUMENT.md) ‚Äî –∏–≥—Ä–æ–≤–æ–π –¥–∏–∑–∞–π–Ω (–£—Ä–æ–≤–µ–Ω—å 8, —Å–µ–∫—Ü–∏—è 9)

---

## 1. –û–±–∑–æ—Ä

Encounter System ‚Äî –º–æ–¥—É–ª—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤. –†–µ–∞–ª–∏–∑—É–µ—Ç **Unified Encounter** ‚Äî –ª—é–±–∞—è –≤—Å—Ç—Ä–µ—á–∞ —Å —Å—É—â–Ω–æ—Å—Ç—å—é (–≤—Ä–∞–≥, NPC, –¥—É—Ö) —Ä–∞–∑—Ä–µ—à–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –µ–¥–∏–Ω—ã–π –¥–≤–∏–∂–æ–∫ —Å –¥–≤—É–º—è —à–∫–∞–ª–∞–º–∏ (Body/Spirit) –∏ –º–Ω–æ–∂–µ—Å—Ç–≤–æ–º –ø—É—Ç–µ–π (Kill, Pacify, Flee, Custom).

–≠—Ç–æ **–Ω–µ "–±–æ–µ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞"**, –∞ **—Å–∏—Å—Ç–µ–º–∞ –≤—Å—Ç—Ä–µ—á**, –≥–¥–µ –±–æ–π ‚Äî –ª–∏—à—å –æ–¥–∏–Ω –∏–∑ –ø—É—Ç–µ–π —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è.

### –ê–Ω–∞–ª–æ–≥–∏—è

Encounter System ‚Äî —ç—Ç–æ **—Å–∏—Å—Ç–µ–º–∞ –ø—Ä–∞–≤–∏–ª** (–∫–∞–∫ D&D, Call of Cthulhu, Arkham Horror LCG), –∞ –Ω–µ –∏–≥—Ä–æ–≤–æ–π –¥–≤–∏–∂–æ–∫. –û–Ω–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç:
- –ö–∞–∫ —Ä–∞–∑—Ä–µ—à–∞—é—Ç—Å—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã (Fate Deck, Dual Track)
- –ö–∞–∫–∏–µ —Å—É—â–Ω–æ—Å—Ç–∏ —É—á–∞—Å—Ç–≤—É—é—Ç (–≥–µ—Ä–æ–π, –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫, –∫–æ–ª–æ–¥–∞, —à–∫–∞–ª—ã)
- –ö–∞–∫ —Å—É—â–Ω–æ—Å—Ç–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—é—Ç (Intent ‚Üí Action ‚Üí Resolution)

–ù–æ –æ–Ω–∞ **–Ω–µ –∑–Ω–∞–µ—Ç** –ø—Ä–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π, –∫–∞—Ä—Ç—É –º–∏—Ä–∞ –∏–ª–∏ —Å—é–∂–µ—Ç.

---

## 2. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Å–ª–æ–∏

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Content Layer (–ö–æ–Ω—Ç–µ–Ω—Ç-–ø–∞–∫–∏)               ‚îÇ
‚îÇ  JSON: –≤—Ä–∞–≥–∏, behaviors, encounter types,   ‚îÇ
‚îÇ  victory conditions, keywords, modifiers    ‚îÇ
‚îÇ  + –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ –≤—Å—Ç—Ä–µ—á  ‚îÇ
‚îÇ                                             ‚îÇ
‚îÇ  –ê–≤—Ç–æ—Ä–∏–Ω–≥: JSON ‚Üí Runtime: binary .pack     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Rule System (–°–∏—Å—Ç–µ–º–∞ –ø—Ä–∞–≤–∏–ª)               ‚îÇ
‚îÇ  FateDeckManager, ResonanceEngine,          ‚îÇ
‚îÇ  CurseSystem, DeckManager, CardEconomy      ‚îÇ
‚îÇ  ‚Äî –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –¥–ª—è –¥—Ä—É–≥–∏—Ö –∏–≥—Ä          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Encounter Engine (–î–≤–∏–∂–æ–∫ –≤—Å—Ç—Ä–µ—á)           ‚îÇ
‚îÇ  Turn loop, Intent resolution, Fate Tests,  ‚îÇ
‚îÇ  Dual Track (Body/Spirit), Action economy   ‚îÇ
‚îÇ  ‚Äî –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π, stateless per encounter   ‚îÇ
‚îÇ  ‚Äî —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã, –Ω–µ —á–µ—Ä–µ–∑       ‚îÇ
‚îÇ    –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∫–ª–∞—Å—Å—ã (generic)              ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Game Integration (–ë–æ–ª—å—à–∞—è –∏–≥—Ä–∞)            ‚îÇ
‚îÇ  Context Builder, Result Applier,           ‚îÇ
‚îÇ  World state, Campaign, Save/Load           ‚îÇ
‚îÇ  ‚Äî —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ –¥–ª—è "–°—É–º—Ä–∞—á–Ω—ã—Ö –ü—Ä–µ–¥–µ–ª–æ–≤"      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Encounter Engine –∏ Rule System ‚Äî –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ.** Game Integration –∏ Content ‚Äî —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã –¥–ª—è –∫–∞–∂–¥–æ–π –∏–≥—Ä—ã.

**–£—á–∞—Å—Ç–Ω–∏–∫–∏:** –°–µ–π—á–∞—Å 1 vs 1 –∏ 1 vs N. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –¥–æ Party vs N –±–µ–∑ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ (—É—á–∞—Å—Ç–Ω–∏–∫–∏ ‚Äî –º–∞—Å—Å–∏–≤, –Ω–µ –æ–¥–∏–Ω–æ—á–Ω–∞—è —Å—É—â–Ω–æ—Å—Ç—å).

---

## 3. –ö–æ–Ω—Ç—Ä–∞–∫—Ç Encounter System

Encounter System ‚Äî "—Å–ª–µ–ø–æ–π" –º–æ–¥—É–ª—å. –û–Ω –Ω–µ –∑–Ω–∞–µ—Ç –ø—Ä–æ —Ä–µ–≥–∏–æ–Ω—ã, —è–∫–æ—Ä—è –∏–ª–∏ –∫–≤–µ—Å—Ç—ã. –û–Ω –∑–Ω–∞–µ—Ç –º–∞—Ç–µ–º–∞—Ç–∏–∫—É –∏ —Ç–µ–≥–∏.

### 3.1 –í—Ö–æ–¥ (EncounterContext)

```
EncounterContext
‚îú‚îÄ‚îÄ participants: [Participant]       // –ì–µ—Ä–æ–π(–∏) + –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ stats                         // HP, WP, armor, will, strength...
‚îÇ   ‚îú‚îÄ‚îÄ intentTable                   // –¢–∞–±–ª–∏—Ü–∞ –Ω–∞–º–µ—Ä–µ–Ω–∏–π (–¥–ª—è NPC/–≤—Ä–∞–≥–æ–≤)
‚îÇ   ‚îî‚îÄ‚îÄ behaviors                     // –î–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –ø–æ–≤–µ–¥–µ–Ω–∏—è
‚îú‚îÄ‚îÄ playerDeck: DeckSnapshot          // –¢–µ–∫—É—â–∞—è –∫–æ–ª–æ–¥–∞ –∏–≥—Ä–æ–∫–∞
‚îú‚îÄ‚îÄ fateDeck: FateDeckSnapshot        // –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ Fate Deck
‚îú‚îÄ‚îÄ modifiers: [EncounterModifier]    // Generic –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã —Å—Ä–µ–¥—ã
‚îÇ   ‚îú‚îÄ‚îÄ id, target, effect, value     // –ß—Ç–æ –∏ –∫–∞–∫ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç
‚îÇ   ‚îî‚îÄ‚îÄ sourceUIName                  // –î–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ UI ("–ì–Ω–∏–ª—å")
‚îú‚îÄ‚îÄ encounterRules: EncounterRules    // –¢–∏–ø –≤—Å—Ç—Ä–µ—á–∏, –¥–æ—Å—Ç—É–ø–Ω—ã–µ –ø—É—Ç–∏
‚îÇ   ‚îú‚îÄ‚îÄ availablePaths                // [.kill, .pacify, .flee, .custom(...)]
‚îÇ   ‚îú‚îÄ‚îÄ victoryConditions             // [.killAll, .survive(rounds: 5)]
‚îÇ   ‚îú‚îÄ‚îÄ defeatConditions              // [.heroDeath, .resonanceThreshold(-80)]
‚îÇ   ‚îî‚îÄ‚îÄ escapePolicy                  // .allowed(cost:) / .forbidden / .requiresCheck
‚îî‚îÄ‚îÄ rngSeed: UInt64                   // –î–ª—è –¥–µ—Ç–µ—Ä–º–∏–Ω–∏–∑–º–∞
```

### 3.2 –í—ã—Ö–æ–¥ (EncounterResult)

```
EncounterResult
‚îú‚îÄ‚îÄ outcome: EncounterOutcome         // .victory(.kill), .victory(.pacify), .defeat, .escaped
‚îú‚îÄ‚îÄ transaction: Transaction          // –ê—Ç–æ–º–∞—Ä–Ω—ã–π –Ω–∞–±–æ—Ä —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ (–≤—Å—ë –∏–ª–∏ –Ω–∏—á–µ–≥–æ)
‚îÇ   ‚îú‚îÄ‚îÄ resourceChanges               // {hp: -5, faith: +10}
‚îÇ   ‚îú‚îÄ‚îÄ worldFlags                    // {killed_leshy: true}
‚îÇ   ‚îú‚îÄ‚îÄ resonanceShift                // -15
‚îÇ   ‚îî‚îÄ‚îÄ tensionShift                  // +2
‚îú‚îÄ‚îÄ updatedFateDeck: FateDeckSnapshot // –°–æ—Å—Ç–æ—è–Ω–∏–µ Fate Deck –ø–æ—Å–ª–µ –≤—Å—Ç—Ä–µ—á–∏
‚îú‚îÄ‚îÄ updatedPlayerDeck: DeckSnapshot   // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ–ª–æ–¥—ã –ø–æ—Å–ª–µ –≤—Å—Ç—Ä–µ—á–∏
‚îÇ   // –í–∫–ª—é—á–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (–¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ/—É–¥–∞–ª—ë–Ω–Ω—ã–µ –∫–∞—Ä—Ç—ã:
‚îÇ   // –ø—Ä–æ–∫–ª—è—Ç–∏—è, –ª—É—Ç) –∏ –ø–æ—Ä—è–¥–æ–∫ (draw/discard/hand) –¥–ª—è anti-save-scum
‚îú‚îÄ‚îÄ actionLog: [ActionLogEntry]       // –ü–æ–ª–Ω—ã–π –ª–æ–≥ –¥–ª—è replay/–∞–Ω–∞–ª–∏—Ç–∏–∫–∏
‚îî‚îÄ‚îÄ endParticipantStates              // –§–∏–Ω–∞–ª—å–Ω—ã–µ HP/WP –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
```

**–ü—Ä–∏–Ω—Ü–∏–ø:** Transaction –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∞—Ç–æ–º–∞—Ä–Ω–æ ‚Äî –≤—Å—ë –∏–ª–∏ –Ω–∏—á–µ–≥–æ. GameEngine (–±–æ–ª—å—à–∞—è –∏–≥—Ä–∞) —Ä–µ—à–∞–µ—Ç, –∫–∞–∫ transaction –º–∞–ø–ø–∏—Ç—Å—è –Ω–∞ –º–∏—Ä.

---

## 4. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–∞—É–Ω–¥–∞ (Strict Phases)

–ü–æ—Ä—è–¥–æ–∫ —Ñ–∞–∑ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω. –≠—Ç–æ –∫–∞–Ω–æ–Ω –∏–∑ [COMBAT_DIPLOMACY_SPEC.md ¬ß2](./COMBAT_DIPLOMACY_SPEC.md#2-—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-—Ä–∞—É–Ω–¥–∞-–∏–≥—Ä–æ–≤–æ–π-—Ü–∏–∫–ª).

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  –†–ê–£–ù–î N                                    ‚îÇ
‚îÇ                                             ‚îÇ
‚îÇ  Phase 1: INTENT (–ù–∞–º–µ—Ä–µ–Ω–∏–µ –≤—Ä–∞–≥–∞)          ‚îÇ
‚îÇ  ‚Üí –ö–∞–∂–¥—ã–π –≤—Ä–∞–≥ —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç –Ω–∞–º–µ—Ä–µ–Ω–∏–µ          ‚îÇ
‚îÇ  ‚Üí –ò–≥—Ä–æ–∫ –≤–∏–¥–∏—Ç: –∞—Ç–∞–∫–∞ 8, –∑–∞—â–∏—Ç–∞, —Å–ø–µ—Ü–ø—Ä–∏—ë–º  ‚îÇ
‚îÇ                                             ‚îÇ
‚îÇ  Phase 2: PLAYER ACTION (–•–æ–¥ –∏–≥—Ä–æ–∫–∞)        ‚îÇ
‚îÇ  ‚Üí –ò–≥—Ä–∞—Ç—å –∫–∞—Ä—Ç—ã –∏–∑ —Ä—É–∫–∏                      ‚îÇ
‚îÇ  ‚Üí –í—ã–±–∏—Ä–∞—Ç—å —Ü–µ–ª—å (–ø—Ä–∏ 1 vs N)               ‚îÇ
‚îÇ  ‚Üí Fate Test –¥–ª—è –æ—Å–æ–±—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π             ‚îÇ
‚îÇ  ‚Üí –ü—É—Ç—å: Attack (Body) / Influence (Spirit)  ‚îÇ
‚îÇ  ‚Üí –û–¥–∏–Ω Finish Action –∑–∞ —Ä–∞—É–Ω–¥               ‚îÇ
‚îÇ    (–ê—Ç–∞–∫–∞ / –í–ª–∏—è–Ω–∏–µ / –û–∂–∏–¥–∞–Ω–∏–µ).             ‚îÇ
‚îÇ    –°—ã–≥—Ä–∞—Ç—å –∫–∞—Ä—Ç –º–æ–∂–Ω–æ –º–Ω–æ–≥–æ,                 ‚îÇ
‚îÇ    –Ω–æ –∑–∞–≤–µ—Ä—à–∞—é—â–µ–µ –¥–µ–π—Å—Ç–≤–∏–µ ‚Äî –æ–¥–Ω–æ.           ‚îÇ
‚îÇ                                             ‚îÇ
‚îÇ  Phase 3: ENEMY RESOLUTION (–•–æ–¥ –≤—Ä–∞–≥–∞)      ‚îÇ
‚îÇ  ‚Üí –í—Ä–∞–≥ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –æ–±—ä—è–≤–ª–µ–Ω–Ω—ã–π Intent         ‚îÇ
‚îÇ  ‚Üí –£—Ä–æ–Ω / —ç—Ñ—Ñ–µ–∫—Ç—ã –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∫ –∏–≥—Ä–æ–∫—É       ‚îÇ
‚îÇ                                             ‚îÇ
‚îÇ  Phase 4: END OF ROUND (–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ)         ‚îÇ
‚îÇ  ‚Üí –°–±—Ä–æ—Å –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤                  ‚îÇ
‚îÇ  ‚Üí –ü—Ä–æ–≤–µ—Ä–∫–∞ victory/defeat conditions        ‚îÇ
‚îÇ  ‚Üí Draw hand –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ä–∞—É–Ω–¥–∞           ‚îÇ
‚îÇ  ‚Üí –ù–æ–≤—ã–π Intent –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ä–∞—É–Ω–¥–∞        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Turn Order: Strict Phases (Enemy Intent ‚Üí Player Action ‚Üí Enemy Resolution).** Fixed structure ensuring tactical visibility.

### 4.1 –ü–æ—á–µ–º—É Strict Phases ‚Äî –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –ø—É—Ç—å

| –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ | –ü–æ—á–µ–º—É –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç |
|-------------|-------------------|
| **–ò–Ω–∏—Ü–∏–∞—Ç–∏–≤–∞** | –ò–≥—Ä–æ–∫ –º–æ–∂–µ—Ç —É–±–∏—Ç—å –≤—Ä–∞–≥–∞ –¥–æ Intent. –¢–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –≥–ª—É–±–∏–Ω–∞ "—â–∏—Ç –∏–ª–∏ –∞—Ç–∞–∫–∞?" –∏—Å—á–µ–∑–∞–µ—Ç |
| **–û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è** | –ò–≥—Ä–æ–∫ –¥–µ–π—Å—Ç–≤—É–µ—Ç –≤—Å–ª–µ–ø—É—é ‚Üí —É–≥–∞–¥–∞–π–∫–∞ ("–∫–∞–º–µ–Ω—å-–Ω–æ–∂–Ω–∏—Ü—ã-–±—É–º–∞–≥–∞") |
| **–†–∞–∑–Ω—ã–µ flow –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤** | –î–≤–∞ –¥–≤–∏–∂–∫–∞, –¥–≤–∞ UI, –¥–≤–∞ –Ω–∞–±–æ—Ä–∞ –ø—Ä–∞–≤–∏–ª ‚Üí –¥–æ—Ä–æ–≥–æ –∏ –ø—É—Ç–∞–µ—Ç |

**–ü—Ä–∏–Ω—Ü–∏–ø Active Defense:** –í—Ä–∞–≥ —Å–æ–∑–¥–∞—ë—Ç –ø—Ä–æ–±–ª–µ–º—É (Intent) ‚Üí –ò–≥—Ä–æ–∫ –∏—â–µ—Ç —Ä–µ—à–µ–Ω–∏–µ. –≠—Ç–æ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã.

### 4.2 –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Keywords (–Ω–µ —á–µ—Ä–µ–∑ —Å–º–µ–Ω—É flow)

–í–∞—Ä–∏–∞—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–æ—Å—Ç–∏–≥–∞–µ—Ç—Å—è –∫–ª—é—á–µ–≤—ã–º–∏ —Å–ª–æ–≤–∞–º–∏ –Ω–∞ –∫–∞—Ä—Ç–∞—Ö –∏ —Å–≤–æ–π—Å—Ç–≤–∞–º–∏ –≤—Ä–∞–≥–æ–≤:

| Keyword | –≠—Ñ—Ñ–µ–∫—Ç | –§–∞–∑–∞ |
|---------|--------|------|
| **Ambush** | –°–≤–æ–π—Å—Ç–≤–æ –≤—Ä–∞–≥–∞. 1-–π —Ä–∞—É–Ω–¥: Phase 1 —Å–∫—Ä—ã—Ç–∞, –≤—Ä–∞–≥ –±—å—ë—Ç "–≤—Å–ª–µ–ø—É—é" | Phase 1 |
| **Interrupt** | –ö–∞—Ä—Ç–∞ –∏–≥—Ä–æ–∫–∞. –ú–æ–∂–Ω–æ —Å—ã–≥—Ä–∞—Ç—å –≤–æ –≤—Ä–µ–º—è Phase 3 (–º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π —â–∏—Ç) | Phase 3 |
| **Stance** | –°–≤–æ–π—Å—Ç–≤–æ –≤—Ä–∞–≥–∞. –ü—Ä–∏ –∞—Ç–∞–∫–µ –∏–≥—Ä–æ–∫–æ–º ‚Äî –∫–æ–Ω—Ç—Ä—É–¥–∞—Ä –≤ Phase 2 | Phase 2 |
| **Surge** | Keyword Fate Card. –ü—Ä–∏ Match Bonus ‚Äî –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ | Phase 2 |

**–ü—Ä–∏–Ω—Ü–∏–ø:** –§–∞–∑—ã –Ω–µ–∏–∑–º–µ–Ω–Ω—ã. Keywords –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É—é—Ç –ø–æ–≤–µ–¥–µ–Ω–∏–µ *–≤–Ω—É—Ç—Ä–∏* —Ñ–∞–∑. –ù–æ–≤—ã–µ keywords –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ –∫–æ–Ω—Ç–µ–Ω—Ç-–ø–∞–∫–∏ (–¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ).

---

## 5. Fate Deck ‚Äî Shared Rule System Module

Fate Deck –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç Rule System, –∞ –Ω–µ Encounter System –∏ –Ω–µ Game Engine. –≠—Ç–æ "–∫—É–±–∏–∫–∏ –∫–∞–º–ø–∞–Ω–∏–∏" ‚Äî –µ–¥–∏–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä –Ω–∞ –≤—Å—é –∏–≥—Ä—É.

### 5.1 –ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

| –ö–æ–Ω—Ç–µ–∫—Å—Ç | –ü—Ä–∏–º–µ—Ä | –ö—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç |
|----------|--------|--------------|
| **Encounter** | Fate Test –ø—Ä–∏ –∞—Ç–∞–∫–µ/–∑–∞—â–∏—Ç–µ | Encounter Engine |
| **World Map** | Skill Check (–≤–∑–ª–æ–º, —Å–∫—Ä—ã—Ç–Ω–æ—Å—Ç—å) | Game Engine |
| **Dialogue** | –£–±–µ–∂–¥–µ–Ω–∏–µ NPC | Game Engine |
| **Camp** | –ì–∞–¥–∞–ª–∫–∞ ‚Äî peek 3 –≤–µ—Ä—Ö–Ω–∏–µ –∫–∞—Ä—Ç—ã | Game Engine |
| **Meta** | –ü—Ä–æ–∫–ª—è—Ç–∏–µ –¥–æ–±–∞–≤–ª—è–µ—Ç sticky-–∫–∞—Ä—Ç—É | CurseSystem |

### 5.2 –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞: Data + Logic + Snapshot

```
FateDeckData (Codable, —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è)
‚îú‚îÄ‚îÄ drawPile: [FateCard]
‚îú‚îÄ‚îÄ discardPile: [FateCard]
‚îî‚îÄ‚îÄ removedPile: [FateCard]     // One-time –∫–∞—Ä—Ç—ã

FateDeckManager (Logic, Rule System)
‚îú‚îÄ‚îÄ draw() ‚Üí FateCard
‚îú‚îÄ‚îÄ peek(count:) ‚Üí [FateCard]
‚îú‚îÄ‚îÄ reorder(top:)               // –ì–∞–¥–∞–ª–∫–∞, —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ addSticky(card:)            // –ü—Ä–æ–∫–ª—è—Ç–∏—è
‚îú‚îÄ‚îÄ removeSticky(id:)           // –°–Ω—è—Ç–∏–µ –ø—Ä–æ–∫–ª—è—Ç–∏–π
‚îú‚îÄ‚îÄ reshuffle()                 // –°–±—Ä–æ—Å ‚Üí draw pile
‚îú‚îÄ‚îÄ makeSnapshot() ‚Üí FateDeckSnapshot
‚îÇ   // –ü–∞—Ä–∞–º–µ—Ç—Ä shuffleIfEmpty: Bool
‚îÇ   // –í –±–æ—é: true (–∞–≤—Ç–æ-—à–∞—Ñ—Ñ–ª –ø—Ä–∏ –ø—É—Å—Ç–æ–π –∫–æ–ª–æ–¥–µ)
‚îÇ   // –ü—Ä–∏ peek: false (–≤–∏–¥–∏–º —Ä–æ–≤–Ω–æ —Ç–æ, —á—Ç–æ –µ—Å—Ç—å)
‚îî‚îÄ‚îÄ apply(snapshot:)            // –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—Å–ª–µ –±–æ—è

FateDeckSnapshot (Immutable, –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ Encounter)
‚îî‚îÄ‚îÄ –ü–æ–ª–Ω–∞—è –∫–æ–ø–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–ª—è –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å–∏–º—É–ª—è—Ü–∏–∏
```

### 5.3 –û–±–º–µ–Ω —Å Encounter System

```
Game Engine                    Encounter Engine
     ‚îÇ                              ‚îÇ
     ‚îÇ  fateDeck.makeSnapshot()     ‚îÇ
     ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ
     ‚îÇ                              ‚îÇ  (—Å–∏–º—É–ª–∏—Ä—É–µ—Ç draw/peek
     ‚îÇ                              ‚îÇ   –≤–Ω—É—Ç—Ä–∏ snapshot-–∫–æ–ø–∏–∏)
     ‚îÇ  result.updatedFateDeck      ‚îÇ
     ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
     ‚îÇ                              ‚îÇ
     ‚îÇ  fateDeck.apply(snapshot)    ‚îÇ
     ‚îÇ  // –†–µ–∞–ª—å–Ω–∞—è –∫–æ–ª–æ–¥–∞          ‚îÇ
     ‚îÇ  // –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ       ‚îÇ
     ‚îÇ  // –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –±–æ—è     ‚îÇ
```

**–î–µ—Ç–µ—Ä–º–∏–Ω–∏–∑–º:** `FateDeckManager` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `WorldRNG` (seeded). –û–¥–∏–Ω seed ‚Üí –æ–¥–∏–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç. Snapshot-–ø–æ–¥—Ö–æ–¥ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–æ–≥–Ω–∞—Ç—å 100 —Å–∏–º—É–ª—è—Ü–∏–π –¥–ª—è AI/–±–∞–ª–∞–Ω—Å–∞ –±–µ–∑ –ø–æ—Ä—á–∏ —Ä–µ–∞–ª—å–Ω–æ–π –∫–æ–ª–æ–¥—ã.

**–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å —á–µ—Ä–µ–∑ –ø–∞–∫–∏:** –ö–æ–Ω—Ç–µ–Ω—Ç-–ø–∞–∫ –º–æ–∂–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –Ω–æ–≤—ã–µ Fate Cards —Å –Ω–æ–≤—ã–º–∏ keywords –∏ intensity-–∑–Ω–∞—á–µ–Ω–∏—è–º–∏. –õ–æ–≥–∏–∫–∞ `FateDeckManager` –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è ‚Äî –æ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç —Å generic `FateCard` —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π.

---

## 6. –†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å —á–µ—Ä–µ–∑ –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞

–ö–æ–Ω—Ç–µ–Ω—Ç-–ø–∞–∫–∏ –º–æ–≥—É—Ç –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å **–Ω–æ–≤—ã–µ —Ç–∏–ø—ã –≤—Å—Ç—Ä–µ—á** –∏ **–Ω–æ–≤—ã–µ –ø–æ–≤–µ–¥–µ–Ω–∏—è** –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞ –¥–≤–∏–∂–∫–∞.

### 6.1 –ß—Ç–æ –ø–∞–∫ –º–æ–∂–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å

| –£—Ä–æ–≤–µ–Ω—å | –ü—Ä–∏–º–µ—Ä | –§–æ—Ä–º–∞—Ç |
|---------|--------|--------|
| **–î–∞–Ω–Ω—ã–µ** | –ù–æ–≤—ã–π –≤—Ä–∞–≥, –∫–∞—Ä—Ç–∞, Fate Card | JSON: stats, keywords, art |
| **–ü–æ–≤–µ–¥–µ–Ω–∏–µ** | Intent-—Ç–∞–±–ª–∏—Ü–∞ –≤—Ä–∞–≥–∞ —Å —É—Å–ª–æ–≤–∏—è–º–∏ | JSON: conditions ‚Üí actions |
| **–¢–∏–ø –≤—Å—Ç—Ä–µ—á–∏** | "–ó–∞–≥–∞–¥–∫–∞", "–¢–æ—Ä–≥", "–†–∏—Ç—É–∞–ª" | JSON: phases, victory/defeat conditions, available actions |
| **Keyword** | –ù–æ–≤–æ–µ –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ —Å —ç—Ñ—Ñ–µ–∫—Ç–æ–º | JSON: trigger, target, effect, value |

### 6.2 –î–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã–µ —É—Å–ª–æ–≤–∏—è (Condition DSL)

Behaviors –∏ –ø—Ä–∞–≤–∏–ª–∞ –æ–ø–∏—Å—ã–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ —É—Å–ª–æ–≤–∏—è, –≤—ã—á–∏—Å–ª—è–µ–º—ã–µ –¥–≤–∏–∂–∫–æ–º:

```json
{
  "intent_table": [
    {
      "id": "desperate_strike",
      "conditions": [
        {"type": "hp_below_percent", "value": 30},
        {"type": "round_greater_than", "value": 2}
      ],
      "priority": 10,
      "action": {"type": "attack", "power": 12, "tag": "desperate"}
    },
    {
      "id": "default_attack",
      "conditions": [],
      "priority": 1,
      "action": {"type": "attack", "power": 6}
    }
  ]
}
```

**Encounter Engine** —Å–æ–¥–µ—Ä–∂–∏—Ç `ConditionEvaluator` ‚Äî –∫–æ–Ω–µ—á–Ω—ã–π –Ω–∞–±–æ—Ä –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö —Ç–∏–ø–æ–≤ —É—Å–ª–æ–≤–∏–π:
- `hp_below_percent`, `wp_below_percent`
- `round_greater_than`, `round_less_than`
- `player_has_tag`, `player_missing_tag`
- `resonance_zone` (deep_nav, nav, yav, prav, deep_prav)
- `has_fate_card_suit` (–ø—Ä–æ–≤–µ—Ä–∫–∞ –º–∞—Å—Ç–∏ –≤ —Ä—É–∫–µ/–∫–æ–ª–æ–¥–µ)
- `last_player_action` (—Ç–∏–ø –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è –∏–≥—Ä–æ–∫–∞)
- `participant_count_greater_than`

–ü–∞–∫ **–Ω–µ –º–æ–∂–µ—Ç** –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ç–∏–ø —É—Å–ª–æ–≤–∏—è ‚Äî —Ç–æ–ª—å–∫–æ –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ. –ù–æ–≤—ã–µ —Ç–∏–ø—ã —É—Å–ª–æ–≤–∏–π –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–≤–∏–∂–∫–∞.

### 6.3 –ì—Ä–∞–Ω–∏—Ü—ã —Ä–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç–∏

```
–ü–∞–∫ –ú–û–ñ–ï–¢:                         –ü–∞–∫ –ù–ï –ú–û–ñ–ï–¢:
‚úÖ –ù–æ–≤—ã–µ –≤—Ä–∞–≥–∏/–∫–∞—Ä—Ç—ã/keywords       ‚ùå –ù–æ–≤—ã–µ —Ç–∏–ø—ã —É—Å–ª–æ–≤–∏–π
‚úÖ –ù–æ–≤—ã–µ intent-—Ç–∞–±–ª–∏—Ü—ã             ‚ùå –ò–∑–º–µ–Ω–∏—Ç—å —Ñ–æ—Ä–º—É–ª—É —É—Ä–æ–Ω–∞
‚úÖ –ù–æ–≤—ã–µ victory conditions         ‚ùå –ò–∑–º–µ–Ω–∏—Ç—å –ø–æ—Ä—è–¥–æ–∫ —Ñ–∞–∑
‚úÖ –ù–æ–≤—ã–µ encounter types            ‚ùå –î–æ–±–∞–≤–∏—Ç—å –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–π –∫–æ–¥
   (–∏–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø—Ä–∏–º–∏—Ç–∏–≤–æ–≤)     ‚ùå –û–±–æ–π—Ç–∏ Transaction atomicity
```

**–ü—Ä–∏–Ω—Ü–∏–ø:** –ü–∞–∫–∏ ‚Äî –∞–≤—Ç–æ—Ä—ã —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤, –Ω–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç—ã. –û–Ω–∏ –∫–æ–º–±–∏–Ω–∏—Ä—É—é—Ç –∫–∏—Ä–ø–∏—á–∏, –Ω–æ –Ω–µ –ª–µ–ø—è—Ç –Ω–æ–≤—ã–µ.

---

## 7. Game Integration Layer

Encounter Engine —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã. "–ë–æ–ª—å—à–∞—è –∏–≥—Ä–∞" —Ä–µ–∞–ª–∏–∑—É–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∞–¥–∞–ø—Ç–µ—Ä—ã.

### 7.1 –ü—Ä–æ—Ç–æ–∫–æ–ª—ã Encounter Engine

```swift
// Encounter Engine –∑–Ω–∞–µ—Ç –¢–û–õ–¨–ö–û —ç—Ç–∏ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã:

protocol EncounterParticipant {
    var id: String { get }
    var stats: ParticipantStats { get }
    var behaviors: [BehaviorRule] { get }
}

protocol EncounterEnvironment {
    var modifiers: [EncounterModifier] { get }
    var rules: EncounterRules { get }
}

protocol FateDeckProvider {
    func makeSnapshot() -> FateDeckSnapshot
}

protocol EncounterResultHandler {
    func apply(result: EncounterResult)
}
```

### 7.2 Context Builder –∏ Result Applier

```
Context Builder (–í—Ö–æ–¥)                Result Applier (–í—ã—Ö–æ–¥)
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Region ‚Üí modifiers   ‚îÇ              ‚îÇ transaction          ‚îÇ
‚îÇ  "–ë–æ–ª–æ—Ç–æ" ‚Üí          ‚îÇ              ‚îÇ  ‚Üí Player.hp         ‚îÇ
‚îÇ  {heal_mult: 0.5}    ‚îÇ              ‚îÇ  ‚Üí World.resonance   ‚îÇ
‚îÇ                      ‚îÇ              ‚îÇ  ‚Üí World.tension     ‚îÇ
‚îÇ Curses ‚Üí modifiers   ‚îÇ              ‚îÇ  ‚Üí World.flags       ‚îÇ
‚îÇ  "–°–ª–∞–±–æ—Å—Ç—å" ‚Üí        ‚îÇ              ‚îÇ  ‚Üí FateDeck.apply()  ‚îÇ
‚îÇ  {damage_add: -1}    ‚îÇ              ‚îÇ  ‚Üí PlayerDeck.apply() ‚îÇ
‚îÇ                      ‚îÇ              ‚îÇ  ‚Üí Quest.checkFlags() ‚îÇ
‚îÇ WorldResonance ‚Üí     ‚îÇ              ‚îÇ  ‚Üí Analytics.log()   ‚îÇ
‚îÇ  modifiers           ‚îÇ              ‚îÇ  ‚Üí Save/Load         ‚îÇ
‚îÇ  {zone: "deep_nav",  ‚îÇ              ‚îÇ                      ‚îÇ
‚îÇ   enemy_dmg: +1}     ‚îÇ              ‚îÇ –í—Å—ë —á–µ—Ä–µ–∑             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò              ‚îÇ Engine.performAction() ‚îÇ
                                      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Save/Load:** Game Integration –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ Persistency. Encounter Engine –Ω–µ —É–º–µ–µ—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –∏–≥—Ä—É –Ω–∞ –¥–∏—Å–∫ ‚Äî –æ–Ω –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –∞ Game Integration —Ä–µ—à–∞–µ—Ç, –∫–æ–≥–¥–∞ –∏ –∫–∞–∫ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å.

### 7.3 –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ—Å—Ç—å –¥–ª—è –¥—Ä—É–≥–æ–π –∏–≥—Ä—ã

| –°–ª–æ–π | –ß—Ç–æ –º–µ–Ω—è–µ—Ç—Å—è |
|------|-------------|
| **Content** | –ù–æ–≤—ã–µ –ø–∞–∫–∏: –≤—Ä–∞–≥–∏, –∫–∞—Ä—Ç—ã, encounter types |
| **Rules** | –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (—Ñ–æ—Ä–º—É–ª—ã, –ª–∏–º–∏—Ç—ã). –°–∞–º Rule System —Ç–æ—Ç –∂–µ |
| **Encounter Engine** | –ù–∏—á–µ–≥–æ. –†–∞–±–æ—Ç–∞–µ—Ç as-is |
| **Game Integration** | –ù–æ–≤—ã–π Context Builder, Result Applier, Save/Load |
| **UI** | –ù–æ–≤—ã–π –≤–∏–∑—É–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª—å |

---

## 8. Presentation Bridge (–°–≤—è–∑—å —Å UI)

### 8.1 –ü—Ä–æ–±–ª–µ–º–∞

Encounter Engine —Ä–∞–±–æ—Ç–∞–µ—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ (—Ä–∞—Å—á—ë—Ç –∑–∞ ~0.01—Å). –ò–≥—Ä–æ–∫ –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ (–∞–Ω–∏–º–∞—Ü–∏—è –∞—Ç–∞–∫–∏ ‚Üí —Ü–∏—Ñ—Ä—ã —É—Ä–æ–Ω–∞ ‚Üí –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ HP –±–∞—Ä–∞ ‚Üí —Å–º–µ—Ä—Ç—å –≤—Ä–∞–≥–∞ = 3‚Äì4 —Å–µ–∫—É–Ω–¥—ã).

### 8.2 –†–µ—à–µ–Ω–∏–µ: Event Queue Pattern

Game Integration –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞–ø—Ä—è–º—É—é –≤ UI. –û–Ω –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç Transaction –≤ –æ—á–µ—Ä–µ–¥—å –≤–∏–∑—É–∞–ª—å–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π.

```
Engine                    ViewModel                   View
  ‚îÇ                          ‚îÇ                          ‚îÇ
  ‚îÇ  Transaction             ‚îÇ                          ‚îÇ
  ‚îÇ  (HP: 10‚Üí5, Dead)       ‚îÇ                          ‚îÇ
  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ                          ‚îÇ
  ‚îÇ                          ‚îÇ  queue.add:              ‚îÇ
  ‚îÇ                          ‚îÇ  1. playAnimation(       ‚îÇ
  ‚îÇ                          ‚îÇ     "attack_heavy")      ‚îÇ
  ‚îÇ                          ‚îÇ  2. showDamageText("-5") ‚îÇ
  ‚îÇ                          ‚îÇ  3. updateHP(to: 5)     ‚îÇ
  ‚îÇ                          ‚îÇ  4. playDeathSequence() ‚îÇ
  ‚îÇ                          ‚îÇ                          ‚îÇ
  ‚îÇ                          ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ
  ‚îÇ                          ‚îÇ  Serial Playback         ‚îÇ
  ‚îÇ                          ‚îÇ  (–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ)       ‚îÇ
```

### 8.3 –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ

- **State** (–≤ –¥–≤–∏–∂–∫–µ) –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è **–º–≥–Ω–æ–≤–µ–Ω–Ω–æ** ‚Äî –¥–ª—è –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–π
- **View** (–Ω–∞ —ç–∫—Ä–∞–Ω–µ) **"–¥–æ–≥–æ–Ω—è–µ—Ç"** State —á–µ—Ä–µ–∑ –∞–Ω–∏–º–∞—Ü–∏–∏
- **UI –∑–∞–ø—Ä–µ—â–µ–Ω–æ** —á–∏—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –Ω–∞–ø—Ä—è–º—É—é –∏–∑ Engine –≤–æ –≤—Ä–µ–º—è –ø—Ä–æ–∏–≥—Ä—ã–≤–∞–Ω–∏—è –æ—á–µ—Ä–µ–¥–∏ (—á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –≥–ª–∏—Ç—á–µ–π: –±–∞—Ä —É–∂–µ –ø—É—Å—Ç–æ–π, –∞ –º–æ–Ω—Å—Ç—Ä –µ—â—ë –ø–∞–¥–∞–µ—Ç)

---

## 9. –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –±—É–¥—É—â–∏–º–∏ —Ñ–æ—Ä–º–∞—Ç–∞–º–∏

### 9.1 –ö–æ–æ–ø–µ—Ä–∞—Ç–∏–≤ (Party vs N)

–ß—Ç–æ —É–∂–µ –∑–∞–ª–æ–∂–µ–Ω–æ:
- `participants: [Participant]` ‚Äî –º–∞—Å—Å–∏–≤, –Ω–µ –æ–¥–∏–Ω–æ—á–Ω–∞—è —Å—É—â–Ω–æ—Å—Ç—å
- `EncounterResult.endParticipantStates` ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
- `Transaction` ‚Äî generic, –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω –∫ "–æ–¥–Ω–æ–º—É –∏–≥—Ä–æ–∫—É"

–ß—Ç–æ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å:
- **Turn Order –≤–Ω—É—Ç—Ä–∏ Party** ‚Äî –∫—Ç–æ —Ö–æ–¥–∏—Ç –ø–µ—Ä–≤—ã–º –∏–∑ –≥–µ—Ä–æ–µ–≤ (–∫–æ–æ–ø-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ, –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ `EncounterRules`)
- **Shared vs Personal Fate Deck** ‚Äî –æ–¥–Ω–∞ –∫–æ–ª–æ–¥–∞ –Ω–∞ –ø–∞—Ä—Ç–∏—é –∏–ª–∏ —É –∫–∞–∂–¥–æ–≥–æ —Å–≤–æ—è (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `EncounterContext`)
- **Multi-Transaction** ‚Äî –∫–∞–∂–¥—ã–π –∏–≥—Ä–æ–∫ –ø–æ–ª—É—á–∞–µ—Ç —Å–≤–æ–π –Ω–∞–±–æ—Ä —ç—Ñ—Ñ–µ–∫—Ç–æ–≤

**–ü—Ä–∏–Ω—Ü–∏–ø:** Strict Phases –Ω–µ –º–µ–Ω—è—é—Ç—Å—è. Phase 2 (Player Action) —Ä–∞—Å—à–∏—Ä—è–µ—Ç—Å—è –¥–æ Phase 2a, 2b, 2c (–ø–æ —á–∏—Å–ª—É –≥–µ—Ä–æ–µ–≤). –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–∞—É–Ω–¥–∞ —Ç–∞ –∂–µ.

### 9.2 –ù–∞—Å—Ç–æ–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è

| –†–µ—à–µ–Ω–∏–µ | –ü–æ—á–µ–º—É –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –Ω–∞—Å—Ç–æ–ª–∫–∏ |
|---------|------------------------------|
| Strict Phases | –ò–≥—Ä–æ–∫–∏ –∑–∞ —Å—Ç–æ–ª–æ–º –ª–µ–≥–∫–æ —Å–ª–µ–¥—É—é—Ç —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–º—É –ø–æ—Ä—è–¥–∫—É |
| Fate Deck –≤–º–µ—Å—Ç–æ RNG | –§–∏–∑–∏—á–µ—Å–∫–∞—è –∫–æ–ª–æ–¥–∞ –∫–∞—Ä—Ç –≤–º–µ—Å—Ç–æ –∫—É–±–∏–∫–æ–≤ |
| –î–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã–µ behaviors | Intent –≤—Ä–∞–≥–∞ –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è –ø–æ —Ç–∞–±–ª–∏—Ü–µ ‚Äî –º–æ–∂–Ω–æ –Ω–∞–ø–µ—á–∞—Ç–∞—Ç—å –Ω–∞ –∫–∞—Ä—Ç–µ |
| Generic modifiers | –ñ–µ—Ç–æ–Ω—ã –º–µ—Å—Ç–Ω–æ—Å—Ç–∏ –≤–º–µ—Å—Ç–æ digital-–∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ |
| Transaction as result | –ö–∞—Ä—Ç–æ—á–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞: "–ü—Ä–∏–º–µ–Ω–∏—Ç–µ —ç—Ç–∏ —ç—Ñ—Ñ–µ–∫—Ç—ã" |

**–ß—Ç–æ –ù–ï –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é:**
- `ConditionEvaluator` —Å –≤–ª–æ–∂–µ–Ω–Ω—ã–º–∏ —É—Å–ª–æ–≤–∏—è–º–∏ ‚Äî –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è —É–ø—Ä–æ—â–µ–Ω–∏–µ –¥–ª—è —Ä—É—á–Ω–æ–≥–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
- –°–ª–æ–∂–Ω—ã–µ multi-condition behaviors ‚Äî —Ç–∞–±–ª–∏—á–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–ª—è –Ω–∞—Å—Ç–æ–ª–∫–∏

**–ü—Ä–∏–Ω—Ü–∏–ø:** Digital-–≤–µ—Ä—Å–∏—è ‚Äî —ç—Ç–æ **–∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è** –Ω–∞—Å—Ç–æ–ª–∫–∞, –∞ –Ω–µ –Ω–∞–æ–±–æ—Ä–æ—Ç. –ï—Å–ª–∏ –ø—Ä–∞–≤–∏–ª–æ –Ω–µ–ª—å–∑—è –æ–±—ä—è—Å–Ω–∏—Ç—å –∑–∞ —Å—Ç–æ–ª–æ–º ‚Äî –æ–Ω–æ —Å–ª–∏—à–∫–æ–º —Å–ª–æ–∂–Ω–æ–µ.

---

## Sequence Diagram: –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª –≤—Å—Ç—Ä–µ—á–∏

```
sequenceDiagram
    participant GameEngine as –ë–æ–ª—å—à–∞—è –ò–≥—Ä–∞
    participant Encounter as Encounter System
    participant ViewModel as Presentation Bridge

    Note over GameEngine: –ò–≥—Ä–æ–∫ –≤—Å—Ç—Ä–µ—á–∞–µ—Ç –≤—Ä–∞–≥–∞

    GameEngine->>GameEngine: 1. –°–±–æ—Ä –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (Context Builder)
    Note right of GameEngine: Hero Stats + Enemy Def +
    Note right of GameEngine: Environment Modifiers +
    Note right of GameEngine: Fate Deck Snapshot

    GameEngine->>Encounter: 2. startEncounter(context)

    rect rgb(30, 30, 30)
        Note over Encounter: –¶–ò–ö–õ –í–°–¢–†–ï–ß–ò (–∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω)
        Encounter->>Encounter: Intent ‚Üí Action ‚Üí Resolution
        Encounter->>Encounter: –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ HP/WP
        Encounter->>Encounter: –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ–π Fate Deck
    end

    Encounter-->>GameEngine: 3. return EncounterResult

    GameEngine->>GameEngine: 4. State update (–º–≥–Ω–æ–≤–µ–Ω–Ω–æ)
    GameEngine->>ViewModel: 5. Transaction ‚Üí Event Queue
    ViewModel->>ViewModel: 6. Serial Playback (–∞–Ω–∏–º–∞—Ü–∏–∏)
```

---

**–°—Ç–∞—Ç—É—Å –¥–æ–∫—É–º–µ–Ω—Ç–∞:** DRAFT
**–í–µ—Ä—Å–∏—è:** 0.1
**–î–∞—Ç–∞:** 29 —è–Ω–≤–∞—Ä—è 2026
**–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:**
- –£—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –¥–∏–∑–∞–π–Ω–∞ ‚Üí —Å—Ç–∞—Ç—É—Å APPROVED
- –ê–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤–æ–π –º–æ–¥–µ–ª–∏
- –†–µ–∞–ª–∏–∑–∞—Ü–∏—è
