# Encounter System ‚Äî Design Document

**–ü—Ä–æ–µ–∫—Ç:** –°—É–º—Ä–∞—á–Ω—ã–µ –ü—Ä–µ–¥–µ–ª—ã (Twilight Marches)
**–í–µ—Ä—Å–∏—è:** 1.0
**–î–∞—Ç–∞:** 29 —è–Ω–≤–∞—Ä—è 2026
**–°—Ç–∞—Ç—É—Å:** APPROVED

> **üìú PROJECT_BIBLE.md ‚Äî –∫–æ–Ω—Å—Ç–∏—Ç—É—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞ (Source of Truth).**
> ENGINE_ARCHITECTURE.md ‚Äî SoT –¥–ª—è –∫–æ–¥–∞/–∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤.

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
- [COMBAT_DIPLOMACY_SPEC.md](./COMBAT_DIPLOMACY_SPEC.md) ‚Äî —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –±–æ–µ–≤–æ–π –∏ –¥–∏–ø–ª–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–∏—Å—Ç–µ–º—ã
- [ENGINE_ARCHITECTURE.md](../Technical/ENGINE_ARCHITECTURE.md) ‚Äî –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –¥–≤–∏–∂–∫–∞
- [GAME_DESIGN_DOCUMENT.md](./GAME_DESIGN_DOCUMENT.md) ‚Äî –∏–≥—Ä–æ–≤–æ–π –¥–∏–∑–∞–π–Ω (–£—Ä–æ–≤–µ–Ω—å 8, —Å–µ–∫—Ü–∏—è 9)

---

## 1. –û–±–∑–æ—Ä

Encounter System ‚Äî –º–æ–¥—É–ª—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤. –†–µ–∞–ª–∏–∑—É–µ—Ç **Unified Encounter** ‚Äî –ª—é–±–∞—è –≤—Å—Ç—Ä–µ—á–∞ —Å —Å—É—â–Ω–æ—Å—Ç—å—é (–≤—Ä–∞–≥, NPC, –¥—É—Ö) —Ä–∞–∑—Ä–µ—à–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –µ–¥–∏–Ω—ã–π –¥–≤–∏–∂–æ–∫ —Å –¥–≤—É–º—è —à–∫–∞–ª–∞–º–∏ (Body/Spirit) –∏ –º–Ω–æ–∂–µ—Å—Ç–≤–æ–º –ø—É—Ç–µ–π (Kill, Pacify, Flee, Custom).

–≠—Ç–æ **–Ω–µ "–±–æ–µ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞"**, –∞ **—Å–∏—Å—Ç–µ–º–∞ –≤—Å—Ç—Ä–µ—á**, –≥–¥–µ –±–æ–π ‚Äî –ª–∏—à—å –æ–¥–∏–Ω –∏–∑ –ø—É—Ç–µ–π —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è.

### –ê–Ω–∞–ª–æ–≥–∏—è

Encounter System ‚Äî —ç—Ç–æ **—Å–∏—Å—Ç–µ–º–∞ –ø—Ä–∞–≤–∏–ª** (–∫–∞–∫ D&D, Call of Cthulhu, Arkham Horror LCG), –∞ –Ω–µ –∏–≥—Ä–æ–≤–æ–π –¥–≤–∏–∂–æ–∫. –û–Ω–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç:
- –ö–∞–∫ —Ä–∞–∑—Ä–µ—à–∞—é—Ç—Å—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã (Fate Deck, Dual Track)
- –ö–∞–∫–∏–µ —Å—É—â–Ω–æ—Å—Ç–∏ —É—á–∞—Å—Ç–≤—É—é—Ç (–≥–µ—Ä–æ–π, –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫, –∫–æ–ª–æ–¥–∞, —à–∫–∞–ª—ã)
- –ö–∞–∫ —Å—É—â–Ω–æ—Å—Ç–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—é—Ç (Intent ‚Üí Action ‚Üí Resolution)

–ù–æ –æ–Ω–∞ **–Ω–µ –∑–Ω–∞–µ—Ç** –ø—Ä–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π, –∫–∞—Ä—Ç—É –º–∏—Ä–∞ –∏–ª–∏ —Å—é–∂–µ—Ç.

---

## 2. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Å–ª–æ–∏

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Content Layer (–ö–æ–Ω—Ç–µ–Ω—Ç-–ø–∞–∫–∏)               ‚îÇ
‚îÇ  JSON: –≤—Ä–∞–≥–∏, behaviors, encounter types,   ‚îÇ
‚îÇ  victory conditions, keywords, modifiers    ‚îÇ
‚îÇ  + –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ –≤—Å—Ç—Ä–µ—á  ‚îÇ
‚îÇ                                             ‚îÇ
‚îÇ  –ê–≤—Ç–æ—Ä–∏–Ω–≥: JSON ‚Üí Runtime: binary .pack     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Rule System (–°–∏—Å—Ç–µ–º–∞ –ø—Ä–∞–≤–∏–ª)               ‚îÇ
‚îÇ  FateDeckManager, ResonanceEngine,          ‚îÇ
‚îÇ  CurseSystem, DeckManager, CardEconomy      ‚îÇ
‚îÇ  ‚Äî –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –¥–ª—è –¥—Ä—É–≥–∏—Ö –∏–≥—Ä          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Encounter Engine (–î–≤–∏–∂–æ–∫ –≤—Å—Ç—Ä–µ—á)           ‚îÇ
‚îÇ  Turn loop, Intent resolution, Fate Tests,  ‚îÇ
‚îÇ  Dual Track (Body/Spirit), Action economy   ‚îÇ
‚îÇ  ‚Äî –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π: –Ω–µ —á–∏—Ç–∞–µ—Ç/–ø–∏—à–µ—Ç –Ω–∏—á–µ–≥–æ    ‚îÇ
‚îÇ    –≤–Ω–µ EncounterContext/EncounterResult;     ‚îÇ
‚îÇ    –≤—Å—è –∏–∑–º–µ–Ω—è–µ–º–æ—Å—Ç—å –ª–æ–∫–∞–ª—å–Ω–∞ –∏ —Å–µ—Ä–∏–∞–ª–∏–∑—É–µ–º–∞  ‚îÇ
‚îÇ  ‚Äî —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã, –Ω–µ —á–µ—Ä–µ–∑       ‚îÇ
‚îÇ    –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∫–ª–∞—Å—Å—ã (generic)              ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Game Integration (–ë–æ–ª—å—à–∞—è –∏–≥—Ä–∞)            ‚îÇ
‚îÇ  Context Builder, Result Applier,           ‚îÇ
‚îÇ  World state, Campaign, Save/Load           ‚îÇ
‚îÇ  ‚Äî —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ –¥–ª—è "–°—É–º—Ä–∞—á–Ω—ã—Ö –ü—Ä–µ–¥–µ–ª–æ–≤"      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Encounter Engine –∏ Rule System ‚Äî –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ.** Game Integration –∏ Content ‚Äî —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã –¥–ª—è –∫–∞–∂–¥–æ–π –∏–≥—Ä—ã.

**–£—á–∞—Å—Ç–Ω–∏–∫–∏:** –°–µ–π—á–∞—Å 1 vs 1 –∏ 1 vs N. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –¥–æ Party vs N –±–µ–∑ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ (—É—á–∞—Å—Ç–Ω–∏–∫–∏ ‚Äî –º–∞—Å—Å–∏–≤, –Ω–µ –æ–¥–∏–Ω–æ—á–Ω–∞—è —Å—É—â–Ω–æ—Å—Ç—å).

---

## 3. –ö–æ–Ω—Ç—Ä–∞–∫—Ç Encounter System

Encounter System ‚Äî "—Å–ª–µ–ø–æ–π" –º–æ–¥—É–ª—å. –û–Ω –Ω–µ –∑–Ω–∞–µ—Ç –ø—Ä–æ —Ä–µ–≥–∏–æ–Ω—ã, —è–∫–æ—Ä—è –∏–ª–∏ –∫–≤–µ—Å—Ç—ã. –û–Ω –∑–Ω–∞–µ—Ç –º–∞—Ç–µ–º–∞—Ç–∏–∫—É –∏ —Ç–µ–≥–∏.

### 3.1 –í—Ö–æ–¥ (EncounterContext)

```
EncounterContext
‚îú‚îÄ‚îÄ hero: EncounterHero               // –°—Ç–∞—Ç—ã –≥–µ—Ä–æ—è (HP, strength, armor, wisdom...)
‚îú‚îÄ‚îÄ enemies: [EncounterEnemy]         // –ü—Ä–æ—Ç–∏–≤–Ω–∏–∫–∏ —Å dual-track (HP + WP)
‚îÇ   ‚îú‚îÄ‚îÄ stats                         // HP, WP, power, defense...
‚îÇ   ‚îî‚îÄ‚îÄ behaviorId                    // –°—Å—ã–ª–∫–∞ –Ω–∞ behaviors.json (–¥–ª—è AI)
‚îú‚îÄ‚îÄ playerDeck: DeckSnapshot          // –¢–µ–∫—É—â–∞—è –∫–æ–ª–æ–¥–∞ –∏–≥—Ä–æ–∫–∞
‚îú‚îÄ‚îÄ fateDeck: FateDeckSnapshot        // –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ Fate Deck
‚îú‚îÄ‚îÄ modifiers: [EncounterModifier]    // Generic –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã —Å—Ä–µ–¥—ã
‚îÇ   ‚îú‚îÄ‚îÄ id, target, effect, value     // –ß—Ç–æ –∏ –∫–∞–∫ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç
‚îÇ   ‚îî‚îÄ‚îÄ sourceUIName                  // –î–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ UI ("–ì–Ω–∏–ª—å")
‚îú‚îÄ‚îÄ encounterRules: EncounterRules    // –¢–∏–ø –≤—Å—Ç—Ä–µ—á–∏, –¥–æ—Å—Ç—É–ø–Ω—ã–µ –ø—É—Ç–∏
‚îÇ   ‚îú‚îÄ‚îÄ availablePaths                // [.kill, .pacify, .flee, .custom(...)]
‚îÇ   ‚îú‚îÄ‚îÄ victoryConditions             // [.killAll, .survive(rounds: 5)]
‚îÇ   ‚îú‚îÄ‚îÄ defeatConditions              // [.heroDeath, .resonanceThreshold(-80)]
‚îÇ   ‚îî‚îÄ‚îÄ escapePolicy                  // .allowed(cost:) / .forbidden / .requiresCheck
‚îú‚îÄ‚îÄ rngSeed: UInt64                   // Seed –¥–ª—è seeded RNG (weighted_random –∏ –¥—Ä.)
‚îî‚îÄ‚îÄ rngState: UInt64?                 // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ RNG (–¥–ª—è resume)
```

### 3.2 –í—ã—Ö–æ–¥ (EncounterResult)

```
EncounterResult
‚îú‚îÄ‚îÄ outcome: EncounterOutcome         // .victory(.kill), .victory(.pacify), .defeat, .escaped
‚îú‚îÄ‚îÄ transaction: Transaction          // –ê—Ç–æ–º–∞—Ä–Ω—ã–π –Ω–∞–±–æ—Ä —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ (–≤—Å—ë –∏–ª–∏ –Ω–∏—á–µ–≥–æ)
‚îÇ   ‚îú‚îÄ‚îÄ resourceChanges               // {hp: -5, faith: +10}
‚îÇ   ‚îú‚îÄ‚îÄ worldFlags                    // {killed_leshy: true}
‚îÇ   ‚îú‚îÄ‚îÄ resonanceShift                // -15
‚îÇ   ‚îî‚îÄ‚îÄ tensionShift                  // +2
‚îú‚îÄ‚îÄ updatedFateDeck: FateDeckSnapshot // –°–æ—Å—Ç–æ—è–Ω–∏–µ Fate Deck –ø–æ—Å–ª–µ –≤—Å—Ç—Ä–µ—á–∏
‚îú‚îÄ‚îÄ updatedPlayerDeck: DeckSnapshot   // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ–ª–æ–¥—ã –ø–æ—Å–ª–µ –≤—Å—Ç—Ä–µ—á–∏
‚îÇ   // –í–∫–ª—é—á–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (–¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ/—É–¥–∞–ª—ë–Ω–Ω—ã–µ –∫–∞—Ä—Ç—ã:
‚îÇ   // –ø—Ä–æ–∫–ª—è—Ç–∏—è, –ª—É—Ç) –∏ –ø–æ—Ä—è–¥–æ–∫ (draw/discard/hand) –¥–ª—è anti-save-scum
‚îú‚îÄ‚îÄ updatedRngState: UInt64           // –û–±–Ω–æ–≤–ª—ë–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ RNG –ø–æ—Å–ª–µ encounter
‚îú‚îÄ‚îÄ perEntityOutcomes: [ParticipantId: EntityOutcome]  // Per-entity: .killed/.pacified/.escaped/.alive
‚îú‚îÄ‚îÄ actionLog: [ActionLogEntry]       // –ü–æ–ª–Ω—ã–π –ª–æ–≥ –¥–ª—è replay/–∞–Ω–∞–ª–∏—Ç–∏–∫–∏
‚îî‚îÄ‚îÄ endParticipantStates              // –§–∏–Ω–∞–ª—å–Ω—ã–µ HP/WP –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
```

**–ü—Ä–∏–Ω—Ü–∏–ø:** Transaction –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∞—Ç–æ–º–∞—Ä–Ω–æ ‚Äî –≤—Å—ë –∏–ª–∏ –Ω–∏—á–µ–≥–æ. GameEngine (–±–æ–ª—å—à–∞—è –∏–≥—Ä–∞) —Ä–µ—à–∞–µ—Ç, –∫–∞–∫ transaction –º–∞–ø–ø–∏—Ç—Å—è –Ω–∞ –º–∏—Ä.

**Multi-enemy outcomes** (—Å–º. COMBAT_DIPLOMACY_SPEC.md ¬ß1.3): `perEntityOutcomes` —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç –∏—Å—Ö–æ–¥ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞. –ê–≥—Ä–µ–≥–∞—Ü–∏—è:
- –£–±–∏—Ç —Ö–æ—Ç—å –æ–¥–∏–Ω –≤—Ä–∞–≥ ‚Üí `violence: true` –≤ worldFlags
- –í—Å–µ –≤—Ä–∞–≥–∏ —É–º–∏—Ä–æ—Ç–≤–æ—Ä–µ–Ω—ã ‚Üí `nonviolent: true` –≤ worldFlags
- –°–º–µ—à–∞–Ω–Ω—ã–π –∏—Å—Ö–æ–¥ –¥–æ–ø—É—Å—Ç–∏–º; —Å—Ü–µ–Ω–∞—Ä–∏–π –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è

---

## 4. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–∞—É–Ω–¥–∞ (Strict Phases)

–ü–æ—Ä—è–¥–æ–∫ —Ñ–∞–∑ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω. –≠—Ç–æ –∫–∞–Ω–æ–Ω –∏–∑ [COMBAT_DIPLOMACY_SPEC.md ¬ß2](./COMBAT_DIPLOMACY_SPEC.md#2-—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-—Ä–∞—É–Ω–¥–∞-–∏–≥—Ä–æ–≤–æ–π-—Ü–∏–∫–ª).

### 4.0 –ò–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∞–∑—ã (–∫–æ–Ω—Ç—Ä–∞–∫—Ç–Ω—ã–π enum)

–§–∞–∑—ã –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä—É—é—Ç—Å—è **–ø–æ –∏–º–µ–Ω–∏**, –Ω–µ –ø–æ —á–∏—Å–ª—É. –ù—É–º–µ—Ä–∞—Ü–∏—è ‚Äî –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –¥–µ—Ç–∞–ª—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.

```swift
enum EncounterPhase: String, Codable {
    case intent          // –í—Ä–∞–≥ –æ–±—ä—è–≤–ª—è–µ—Ç –Ω–∞–º–µ—Ä–µ–Ω–∏–µ
    case playerAction    // –ò–≥—Ä–æ–∫ –¥–µ–π—Å—Ç–≤—É–µ—Ç
    case enemyResolution // –í—Ä–∞–≥ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –Ω–∞–º–µ—Ä–µ–Ω–∏–µ
    case roundEnd        // –°–±—Ä–æ—Å, –ø—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π, draw
}
```

**–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –º–µ–∂–¥—É –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏:**

| –ò–º—è (–∫–æ–Ω—Ç—Ä–∞–∫—Ç) | COMBAT_DIPLOMACY_SPEC ¬ß2 | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------------|--------------------------|----------|
| `intent` | –§–∞–∑–∞ 0: –ù–∞–º–µ—Ä–µ–Ω–∏–µ –≤—Ä–∞–≥–∞ | –í—Ä–∞–≥ —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç intent; –∏–≥—Ä–æ–∫ –≤–∏–¥–∏—Ç |
| `playerAction` | –§–∞–∑–∞ 1: –•–æ–¥ –∏–≥—Ä–æ–∫–∞ | –†–æ–∑—ã–≥—Ä—ã—à –∫–∞—Ä—Ç + –æ–¥–Ω–æ Finish Action |
| `enemyResolution` | –§–∞–∑–∞ 2: –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –≤—Ä–∞–≥–∞ | –í—Ä–∞–≥ –≤—ã–ø–æ–ª–Ω—è–µ—Ç intent; –∞–≤—Ç–æ–∑–∞—â–∏—Ç–∞ |
| `roundEnd` | (–Ω–µ—è–≤–Ω–∞—è) | –°–±—Ä–æ—Å —ç—Ñ—Ñ–µ–∫—Ç–æ–≤, victory/defeat check, draw |

> **–ü—Ä–∞–≤–∏–ª–æ:** –í –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏, —Ç–µ—Å—Ç–∞—Ö –∏ –∫–æ–¥–µ –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è **–∏–º–µ–Ω–∞ —Ñ–∞–∑** (`intent`, `playerAction`, `enemyResolution`, `roundEnd`). –ß–∏—Å–ª–æ–≤—ã–µ –∏–Ω–¥–µ–∫—Å—ã –¥–æ–ø—É—Å—Ç–∏–º—ã —Ç–æ–ª—å–∫–æ –≤ –ª–æ–≥–∞—Ö –∏ –æ—Ç–ª–∞–¥–∫–µ.

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  –†–ê–£–ù–î N                                    ‚îÇ
‚îÇ                                             ‚îÇ
‚îÇ  .intent (–ù–∞–º–µ—Ä–µ–Ω–∏–µ –≤—Ä–∞–≥–∞)                  ‚îÇ
‚îÇ  ‚Üí –ö–∞–∂–¥—ã–π –≤—Ä–∞–≥ —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç –Ω–∞–º–µ—Ä–µ–Ω–∏–µ          ‚îÇ
‚îÇ  ‚Üí –ò–≥—Ä–æ–∫ –≤–∏–¥–∏—Ç: –∞—Ç–∞–∫–∞ 8, –∑–∞—â–∏—Ç–∞, —Å–ø–µ—Ü–ø—Ä–∏—ë–º  ‚îÇ
‚îÇ                                             ‚îÇ
‚îÇ  .playerAction (–•–æ–¥ –∏–≥—Ä–æ–∫–∞)                 ‚îÇ
‚îÇ  ‚Üí –ò–≥—Ä–∞—Ç—å –∫–∞—Ä—Ç—ã –∏–∑ —Ä—É–∫–∏                      ‚îÇ
‚îÇ  ‚Üí –í—ã–±–∏—Ä–∞—Ç—å —Ü–µ–ª—å (–ø—Ä–∏ 1 vs N)               ‚îÇ
‚îÇ  ‚Üí Fate Test –¥–ª—è –æ—Å–æ–±—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π             ‚îÇ
‚îÇ  ‚Üí –ü—É—Ç—å: Attack (Body) / Influence (Spirit)  ‚îÇ
‚îÇ  ‚Üí –û–¥–∏–Ω Finish Action –∑–∞ —Ä–∞—É–Ω–¥               ‚îÇ
‚îÇ    (–ê—Ç–∞–∫–∞ / –í–ª–∏—è–Ω–∏–µ / –û–∂–∏–¥–∞–Ω–∏–µ).             ‚îÇ
‚îÇ    –°—ã–≥—Ä–∞—Ç—å –∫–∞—Ä—Ç –º–æ–∂–Ω–æ –º–Ω–æ–≥–æ,                 ‚îÇ
‚îÇ    –Ω–æ –∑–∞–≤–µ—Ä—à–∞—é—â–µ–µ –¥–µ–π—Å—Ç–≤–∏–µ ‚Äî –æ–¥–Ω–æ.           ‚îÇ
‚îÇ                                             ‚îÇ
‚îÇ  .enemyResolution (–•–æ–¥ –≤—Ä–∞–≥–∞)               ‚îÇ
‚îÇ  ‚Üí –í—Ä–∞–≥ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –æ–±—ä—è–≤–ª–µ–Ω–Ω—ã–π Intent         ‚îÇ
‚îÇ  ‚Üí –£—Ä–æ–Ω / —ç—Ñ—Ñ–µ–∫—Ç—ã –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∫ –∏–≥—Ä–æ–∫—É       ‚îÇ
‚îÇ                                             ‚îÇ
‚îÇ  .roundEnd (–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ)                     ‚îÇ
‚îÇ  ‚Üí –°–±—Ä–æ—Å –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤                  ‚îÇ
‚îÇ  ‚Üí –ü—Ä–æ–≤–µ—Ä–∫–∞ victory/defeat conditions        ‚îÇ
‚îÇ  ‚Üí Draw hand –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ä–∞—É–Ω–¥–∞           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Turn Order: Strict Phases (intent ‚Üí playerAction ‚Üí enemyResolution ‚Üí roundEnd).** Fixed structure ensuring tactical visibility.

### 4.1 –ü–æ—á–µ–º—É Strict Phases ‚Äî –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –ø—É—Ç—å

| –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ | –ü–æ—á–µ–º—É –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç |
|-------------|-------------------|
| **–ò–Ω–∏—Ü–∏–∞—Ç–∏–≤–∞** | –ò–≥—Ä–æ–∫ –º–æ–∂–µ—Ç —É–±–∏—Ç—å –≤—Ä–∞–≥–∞ –¥–æ Intent. –¢–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –≥–ª—É–±–∏–Ω–∞ "—â–∏—Ç –∏–ª–∏ –∞—Ç–∞–∫–∞?" –∏—Å—á–µ–∑–∞–µ—Ç |
| **–û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è** | –ò–≥—Ä–æ–∫ –¥–µ–π—Å—Ç–≤—É–µ—Ç –≤—Å–ª–µ–ø—É—é ‚Üí —É–≥–∞–¥–∞–π–∫–∞ ("–∫–∞–º–µ–Ω—å-–Ω–æ–∂–Ω–∏—Ü—ã-–±—É–º–∞–≥–∞") |
| **–†–∞–∑–Ω—ã–µ flow –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤** | –î–≤–∞ –¥–≤–∏–∂–∫–∞, –¥–≤–∞ UI, –¥–≤–∞ –Ω–∞–±–æ—Ä–∞ –ø—Ä–∞–≤–∏–ª ‚Üí –¥–æ—Ä–æ–≥–æ –∏ –ø—É—Ç–∞–µ—Ç |

**–ü—Ä–∏–Ω—Ü–∏–ø Active Defense:** –í—Ä–∞–≥ —Å–æ–∑–¥–∞—ë—Ç –ø—Ä–æ–±–ª–µ–º—É (Intent) ‚Üí –ò–≥—Ä–æ–∫ –∏—â–µ—Ç —Ä–µ—à–µ–Ω–∏–µ. –≠—Ç–æ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã.

### 4.2 –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Keywords (–Ω–µ —á–µ—Ä–µ–∑ —Å–º–µ–Ω—É flow)

–í–∞—Ä–∏–∞—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–æ—Å—Ç–∏–≥–∞–µ—Ç—Å—è –∫–ª—é—á–µ–≤—ã–º–∏ —Å–ª–æ–≤–∞–º–∏ –Ω–∞ –∫–∞—Ä—Ç–∞—Ö –∏ —Å–≤–æ–π—Å—Ç–≤–∞–º–∏ –≤—Ä–∞–≥–æ–≤:

| Keyword | –≠—Ñ—Ñ–µ–∫—Ç | –§–∞–∑–∞ |
|---------|--------|------|
| **Ambush** | –°–≤–æ–π—Å—Ç–≤–æ –≤—Ä–∞–≥–∞. 1-–π —Ä–∞—É–Ω–¥: intent —Å–∫—Ä—ã—Ç, –≤—Ä–∞–≥ –±—å—ë—Ç "–≤—Å–ª–µ–ø—É—é" | `intent` |
| **Interrupt** | –ö–∞—Ä—Ç–∞ –∏–≥—Ä–æ–∫–∞. –ú–æ–∂–Ω–æ —Å—ã–≥—Ä–∞—Ç—å –≤–æ –≤—Ä–µ–º—è enemyResolution (–º–≥–Ω–æ–≤–µ–Ω–Ω—ã–π —â–∏—Ç) | `enemyResolution` |
| **Stance** | –°–≤–æ–π—Å—Ç–≤–æ –≤—Ä–∞–≥–∞. –ü—Ä–∏ –∞—Ç–∞–∫–µ –∏–≥—Ä–æ–∫–æ–º ‚Äî –∫–æ–Ω—Ç—Ä—É–¥–∞—Ä | `playerAction` |
| **Surge** | Keyword Fate Card. –ü—Ä–∏ Match Bonus ‚Äî –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ | `playerAction` |

**–ü—Ä–∏–Ω—Ü–∏–ø:** –§–∞–∑—ã –Ω–µ–∏–∑–º–µ–Ω–Ω—ã. Keywords –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É—é—Ç –ø–æ–≤–µ–¥–µ–Ω–∏–µ *–≤–Ω—É—Ç—Ä–∏* —Ñ–∞–∑. –ù–æ–≤—ã–µ keywords –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ –∫–æ–Ω—Ç–µ–Ω—Ç-–ø–∞–∫–∏ (–¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ).

---

## 5. Fate Deck ‚Äî Shared Rule System Module

Fate Deck –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç Rule System, –∞ –Ω–µ Encounter System –∏ –Ω–µ Game Engine. –≠—Ç–æ "–∫—É–±–∏–∫–∏ –∫–∞–º–ø–∞–Ω–∏–∏" ‚Äî –µ–¥–∏–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä –Ω–∞ –≤—Å—é –∏–≥—Ä—É.

### 5.1 –ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

| –ö–æ–Ω—Ç–µ–∫—Å—Ç | –ü—Ä–∏–º–µ—Ä | –ö—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç |
|----------|--------|--------------|
| **Encounter** | Fate Test –ø—Ä–∏ –∞—Ç–∞–∫–µ/–∑–∞—â–∏—Ç–µ | Encounter Engine |
| **World Map** | Skill Check (–≤–∑–ª–æ–º, —Å–∫—Ä—ã—Ç–Ω–æ—Å—Ç—å) | Game Engine |
| **Dialogue** | –£–±–µ–∂–¥–µ–Ω–∏–µ NPC | Game Engine |
| **Camp** | –ì–∞–¥–∞–ª–∫–∞ ‚Äî peek 3 –≤–µ—Ä—Ö–Ω–∏–µ –∫–∞—Ä—Ç—ã | Game Engine |
| **Meta** | –ü—Ä–æ–∫–ª—è—Ç–∏–µ –¥–æ–±–∞–≤–ª—è–µ—Ç sticky-–∫–∞—Ä—Ç—É | CurseSystem |

### 5.2 –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞: Data + Logic + Snapshot

```
FateDeckData (Codable, —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è)
‚îú‚îÄ‚îÄ drawPile: [FateCard]
‚îú‚îÄ‚îÄ discardPile: [FateCard]
‚îî‚îÄ‚îÄ removedPile: [FateCard]     // One-time –∫–∞—Ä—Ç—ã

FateDeckManager (Logic, Rule System)
‚îú‚îÄ‚îÄ draw() ‚Üí FateCard
‚îú‚îÄ‚îÄ peek(count:) ‚Üí [FateCard]
‚îú‚îÄ‚îÄ reorder(top:)               // –ì–∞–¥–∞–ª–∫–∞, —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ addSticky(card:)            // –ü—Ä–æ–∫–ª—è—Ç–∏—è
‚îú‚îÄ‚îÄ removeSticky(id:)           // –°–Ω—è—Ç–∏–µ –ø—Ä–æ–∫–ª—è—Ç–∏–π
‚îú‚îÄ‚îÄ reshuffle()                 // –°–±—Ä–æ—Å ‚Üí draw pile
‚îú‚îÄ‚îÄ makeSnapshot() ‚Üí FateDeckSnapshot
‚îÇ   // –ü–∞—Ä–∞–º–µ—Ç—Ä shuffleIfEmpty: Bool
‚îÇ   // –í –±–æ—é: true (–∞–≤—Ç–æ-—à–∞—Ñ—Ñ–ª –ø—Ä–∏ –ø—É—Å—Ç–æ–π –∫–æ–ª–æ–¥–µ)
‚îÇ   // –ü—Ä–∏ peek: false (–≤–∏–¥–∏–º —Ä–æ–≤–Ω–æ —Ç–æ, —á—Ç–æ –µ—Å—Ç—å)
‚îî‚îÄ‚îÄ apply(snapshot:)            // –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—Å–ª–µ –±–æ—è

FateDeckSnapshot (Immutable, –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –≤ Encounter)
‚îî‚îÄ‚îÄ –ü–æ–ª–Ω–∞—è –∫–æ–ø–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–ª—è –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å–∏–º—É–ª—è—Ü–∏–∏
```

### 5.3 –û–±–º–µ–Ω —Å Encounter System

```
Game Engine                    Encounter Engine
     ‚îÇ                              ‚îÇ
     ‚îÇ  fateDeck.makeSnapshot()     ‚îÇ
     ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ
     ‚îÇ                              ‚îÇ  (—Å–∏–º—É–ª–∏—Ä—É–µ—Ç draw/peek
     ‚îÇ                              ‚îÇ   –≤–Ω—É—Ç—Ä–∏ snapshot-–∫–æ–ø–∏–∏)
     ‚îÇ  result.updatedFateDeck      ‚îÇ
     ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
     ‚îÇ                              ‚îÇ
     ‚îÇ  fateDeck.apply(snapshot)    ‚îÇ
     ‚îÇ  // –†–µ–∞–ª—å–Ω–∞—è –∫–æ–ª–æ–¥–∞          ‚îÇ
     ‚îÇ  // –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ       ‚îÇ
     ‚îÇ  // –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –±–æ—è     ‚îÇ
```

**–î–µ—Ç–µ—Ä–º–∏–Ω–∏–∑–º:** `FateDeckManager` –ø—Ä–∏–Ω–∏–º–∞–µ—Ç seeded RNG (—á–µ—Ä–µ–∑ `rngSeed`/`rngState` –∏–∑ EncounterContext). –û–¥–∏–Ω seed ‚Üí –æ–¥–∏–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç. Encounter Engine **–Ω–µ –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ –≥–ª–æ–±–∞–ª—å–Ω—ã–º —Å–∏–Ω–≥–ª—Ç–æ–Ω–∞–º** (WorldRNG.shared –∏ —Ç.–ø.); –≤–µ—Å—å RNG-—Å—Ç–µ–π—Ç –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è —á–µ—Ä–µ–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ. Snapshot-–ø–æ–¥—Ö–æ–¥ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–æ–≥–Ω–∞—Ç—å 100 —Å–∏–º—É–ª—è—Ü–∏–π –¥–ª—è AI/–±–∞–ª–∞–Ω—Å–∞ –±–µ–∑ –ø–æ—Ä—á–∏ —Ä–µ–∞–ª—å–Ω–æ–π –∫–æ–ª–æ–¥—ã.

**–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å —á–µ—Ä–µ–∑ –ø–∞–∫–∏:** –ö–æ–Ω—Ç–µ–Ω—Ç-–ø–∞–∫ –º–æ–∂–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –Ω–æ–≤—ã–µ Fate Cards, –∏—Å–ø–æ–ª—å–∑—É—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ `FateKeyword` (–∑–∞–∫—Ä—ã—Ç—ã–π –Ω–∞–±–æ—Ä –∏–∑ 5 –∑–Ω–∞—á–µ–Ω–∏–π, —Å–º. COMBAT_DIPLOMACY_SPEC.md ¬ß6.4) –∏ –Ω–æ–≤—ã–µ intensity-–∑–Ω–∞—á–µ–Ω–∏—è. –õ–æ–≥–∏–∫–∞ `FateDeckManager` –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è ‚Äî –æ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç —Å generic `FateCard` —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π.

---

## 6. –†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å —á–µ—Ä–µ–∑ –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞

–ö–æ–Ω—Ç–µ–Ω—Ç-–ø–∞–∫–∏ –º–æ–≥—É—Ç –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å **–Ω–æ–≤—ã–µ —Ç–∏–ø—ã –≤—Å—Ç—Ä–µ—á** –∏ **–Ω–æ–≤—ã–µ –ø–æ–≤–µ–¥–µ–Ω–∏—è** –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞ –¥–≤–∏–∂–∫–∞.

### 6.1 –ß—Ç–æ –ø–∞–∫ –º–æ–∂–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å

| –£—Ä–æ–≤–µ–Ω—å | –ü—Ä–∏–º–µ—Ä | –§–æ—Ä–º–∞—Ç |
|---------|--------|--------|
| **–î–∞–Ω–Ω—ã–µ** | –ù–æ–≤—ã–π –≤—Ä–∞–≥, –∫–∞—Ä—Ç–∞, Fate Card | JSON: stats, keywords, art |
| **–ü–æ–≤–µ–¥–µ–Ω–∏–µ** | Intent-—Ç–∞–±–ª–∏—Ü–∞ –≤—Ä–∞–≥–∞ —Å —É—Å–ª–æ–≤–∏—è–º–∏ | JSON: conditions ‚Üí actions |
| **–¢–∏–ø –≤—Å—Ç—Ä–µ—á–∏** | "–ó–∞–≥–∞–¥–∫–∞", "–¢–æ—Ä–≥", "–†–∏—Ç—É–∞–ª" | JSON: –ø—Ä–∞–≤–∏–ª–∞ –≤–Ω—É—Ç—Ä–∏ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∞–∑, victory/defeat conditions, available actions. **EncounterType –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –ø—Ä–∞–≤–∏–ª–∞ –≤–Ω—É—Ç—Ä–∏ —Ñ–∞–∑, –Ω–æ –Ω–µ –º–µ–Ω—è–µ—Ç —Ñ–∞–∑–æ–≤—ã–π –ø–æ—Ä—è–¥–æ–∫.** |
| **Tags** | –†–∞—Å—à–∏—Ä—è–µ–º—ã–µ —Ç–µ–≥–∏ –¥–ª—è —Å–∏–Ω–µ—Ä–≥–∏–π/—É—Å–ª–æ–≤–∏–π | JSON: —Å—Ç—Ä–æ–∫–æ–≤—ã–µ –º–µ—Ç–∫–∏ –±–µ–∑ –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–π —Å–µ–º–∞–Ω—Ç–∏–∫–∏ –¥–≤–∏–∂–∫–∞ |

### 6.2 –î–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã–µ —É—Å–ª–æ–≤–∏—è (Condition DSL)

> **SoT –¥–ª—è Condition DSL:** [COMBAT_DIPLOMACY_SPEC.md ¬ß6.2](./COMBAT_DIPLOMACY_SPEC.md). –≠—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–∏–º–µ—Ä –¥–ª—è –∏–ª–ª—é—Å—Ç—Ä–∞—Ü–∏–∏; –∫–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∏–µ –∏–º–µ–Ω–∞ —Ç–∏–ø–æ–≤, –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã –∏ —Ñ–æ—Ä–º–∞—Ç ‚Äî –≤ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏.

Behaviors –æ–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ `behaviors.json` –∏–∑ COMBAT_DIPLOMACY_SPEC.md ¬ß6.2:

```json
{
  "id": "behavior_forest_guardian",
  "default_intent": "attack_normal",
  "rules": [
    {
      "priority": 100,
      "condition": {"type": "hp_percent", "operator": "<", "value": 30},
      "intent": "heal_roots"
    },
    {
      "priority": 90,
      "condition": {"type": "player_attacking_wp", "value": true},
      "intent": "argument_restore"
    },
    {
      "priority": 50,
      "type": "weighted_random",
      "pool": [
        {"intent": "attack_normal", "weight": 3},
        {"intent": "attack_heavy", "weight": 1}
      ]
    }
  ],
  "intents": {
    "attack_normal": {"type": "attack", "value_formula": "power"},
    "attack_heavy": {"type": "attack", "value_formula": "power * heavyAttackMultiplier"},
    "heal_roots": {"type": "heal", "value": 5},
    "argument_restore": {"type": "restore_wp", "value": 3}
  }
}
```

**–ö–ª—é—á–µ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Ñ–æ—Ä–º–∞—Ç–∞:**
- `default_intent` ‚Äî –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π fallback (–∫–ª—é—á –≤ `intents`). –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –µ—Å–ª–∏ –Ω–∏ –æ–¥–Ω–æ –ø—Ä–∞–≤–∏–ª–æ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–æ
- `rules[]` ‚Äî –º–∞—Å—Å–∏–≤ —Å `priority` + `condition` (–æ–¥–∏–Ω–æ—á–Ω–æ–µ —É—Å–ª–æ–≤–∏–µ). Tie-break –ø—Ä–∏ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–º priority: –ø–æ—Ä—è–¥–æ–∫ –≤ –º–∞—Å—Å–∏–≤–µ (–ø–µ—Ä–≤—ã–π –ø–æ–±–µ–∂–¥–∞–µ—Ç)
- `weighted_random` ‚Äî —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Ç–∏–ø –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è –ø—É–ª–∞ —Å –≤–µ—Å–∞–º–∏. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç seeded RNG –∏–∑ EncounterContext
- `intents{}` ‚Äî —Å–ª–æ–≤–∞—Ä—å intent-–æ–≤ —Å type/value_formula/description

**Encounter Engine** —Å–æ–¥–µ—Ä–∂–∏—Ç `ConditionEvaluator` ‚Äî –∫–æ–Ω–µ—á–Ω—ã–π –Ω–∞–±–æ—Ä –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö —Ç–∏–ø–æ–≤ —É—Å–ª–æ–≤–∏–π (–∫–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∏–π —Å–ø–∏—Å–æ–∫: COMBAT_DIPLOMACY_SPEC.md ¬ß6.2).

–ü–∞–∫ **–Ω–µ –º–æ–∂–µ—Ç** –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ç–∏–ø —É—Å–ª–æ–≤–∏—è ‚Äî —Ç–æ–ª—å–∫–æ –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ. –ù–æ–≤—ã–µ —Ç–∏–ø—ã —É—Å–ª–æ–≤–∏–π –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–≤–∏–∂–∫–∞.

### 6.3 –ì—Ä–∞–Ω–∏—Ü—ã —Ä–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç–∏

```
–ü–∞–∫ –ú–û–ñ–ï–¢:                         –ü–∞–∫ –ù–ï –ú–û–ñ–ï–¢:
‚úÖ –ù–æ–≤—ã–µ –≤—Ä–∞–≥–∏/–∫–∞—Ä—Ç—ã/—Ç–µ–≥–∏           ‚ùå –ù–æ–≤—ã–µ FateKeyword (–∑–∞–∫—Ä—ã—Ç—ã–π enum)
‚úÖ –ù–æ–≤—ã–µ behaviors (default_intent  ‚ùå –ù–æ–≤—ã–µ —Ç–∏–ø—ã —É—Å–ª–æ–≤–∏–π
   + rules + intents)               ‚ùå –ò–∑–º–µ–Ω–∏—Ç—å —Ñ–æ—Ä–º—É–ª—É —É—Ä–æ–Ω–∞
‚úÖ –ù–æ–≤—ã–µ victory conditions         ‚ùå –ò–∑–º–µ–Ω–∏—Ç—å –ø–æ—Ä—è–¥–æ–∫ —Ñ–∞–∑
‚úÖ –ù–æ–≤—ã–µ encounter types            ‚ùå –î–æ–±–∞–≤–∏—Ç—å –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–π –∫–æ–¥
   (–∏–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø—Ä–∏–º–∏—Ç–∏–≤–æ–≤)     ‚ùå –û–±–æ–π—Ç–∏ Transaction atomicity
‚úÖ –ù–æ–≤—ã–µ Fate Cards (—Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ FateKeyword)
```

> **FateKeyword vs Tags:** `FateKeyword` ‚Äî –∑–∞–∫—Ä—ã—Ç—ã–π –Ω–∞–±–æ—Ä –∏–∑ 5 –∑–Ω–∞—á–µ–Ω–∏–π (surge, focus, echo, shadow, ward), –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π –≤ COMBAT_DIPLOMACY_SPEC.md ¬ß6.4. –ü–∞–∫ **–Ω–µ –º–æ–∂–µ—Ç** –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π FateKeyword. –î–ª—è —Ä–∞—Å—à–∏—Ä—è–µ–º—ã—Ö –º–µ—Ç–æ–∫ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è **Tags** ‚Äî —Å—Ç—Ä–æ–∫–æ–≤—ã–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –±–µ–∑ –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–π —Å–µ–º–∞–Ω—Ç–∏–∫–∏ –¥–≤–∏–∂–∫–∞ (–¥–ª—è —Å–∏–Ω–µ—Ä–≥–∏–π, —É—Å–ª–æ–≤–∏–π, UI).

**–ü—Ä–∏–Ω—Ü–∏–ø:** –ü–∞–∫–∏ ‚Äî –∞–≤—Ç–æ—Ä—ã —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤, –Ω–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç—ã. –û–Ω–∏ –∫–æ–º–±–∏–Ω–∏—Ä—É—é—Ç –∫–∏—Ä–ø–∏—á–∏, –Ω–æ –Ω–µ –ª–µ–ø—è—Ç –Ω–æ–≤—ã–µ.

---

## 7. Game Integration Layer

Encounter Engine —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã. "–ë–æ–ª—å—à–∞—è –∏–≥—Ä–∞" —Ä–µ–∞–ª–∏–∑—É–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∞–¥–∞–ø—Ç–µ—Ä—ã.

### 7.1 –ü—Ä–æ—Ç–æ–∫–æ–ª—ã Encounter Engine

```swift
// Encounter Engine –∑–Ω–∞–µ—Ç –¢–û–õ–¨–ö–û —ç—Ç–∏ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã:

protocol EncounterParticipant {
    var id: String { get }
    var stats: ParticipantStats { get }
    var behaviors: [BehaviorRule] { get }
}

protocol EncounterEnvironment {
    var modifiers: [EncounterModifier] { get }
    var rules: EncounterRules { get }
}

protocol FateDeckProvider {
    func makeSnapshot() -> FateDeckSnapshot
}

protocol EncounterResultHandler {
    func apply(result: EncounterResult)
}
```

### 7.2 Context Builder –∏ Result Applier

```
Context Builder (–í—Ö–æ–¥)                Result Applier (–í—ã—Ö–æ–¥)
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê              ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Region ‚Üí modifiers   ‚îÇ              ‚îÇ transaction          ‚îÇ
‚îÇ  "–ë–æ–ª–æ—Ç–æ" ‚Üí          ‚îÇ              ‚îÇ  ‚Üí Player.hp         ‚îÇ
‚îÇ  {heal_mult: 0.5}    ‚îÇ              ‚îÇ  ‚Üí World.resonance   ‚îÇ
‚îÇ                      ‚îÇ              ‚îÇ  ‚Üí World.tension     ‚îÇ
‚îÇ Curses ‚Üí modifiers   ‚îÇ              ‚îÇ  ‚Üí World.flags       ‚îÇ
‚îÇ  "–°–ª–∞–±–æ—Å—Ç—å" ‚Üí        ‚îÇ              ‚îÇ  ‚Üí FateDeck.apply()  ‚îÇ
‚îÇ  {damage_add: -1}    ‚îÇ              ‚îÇ  ‚Üí PlayerDeck.apply() ‚îÇ
‚îÇ                      ‚îÇ              ‚îÇ  ‚Üí Quest.checkFlags() ‚îÇ
‚îÇ WorldResonance ‚Üí     ‚îÇ              ‚îÇ  ‚Üí Analytics.log()   ‚îÇ
‚îÇ  modifiers           ‚îÇ              ‚îÇ  ‚Üí Save/Load         ‚îÇ
‚îÇ  {zone: "deepNav",  ‚îÇ              ‚îÇ                      ‚îÇ
‚îÇ   enemy_dmg: +1}     ‚îÇ              ‚îÇ –í—Å—ë —á–µ—Ä–µ–∑             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò              ‚îÇ Engine.performAction() ‚îÇ
                                      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Save/Load:** Game Integration –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ Persistency. Encounter Engine –Ω–µ —É–º–µ–µ—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –∏–≥—Ä—É –Ω–∞ –¥–∏—Å–∫ ‚Äî –æ–Ω –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –∞ Game Integration —Ä–µ—à–∞–µ—Ç, –∫–æ–≥–¥–∞ –∏ –∫–∞–∫ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å.

### 7.3 –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ—Å—Ç—å –¥–ª—è –¥—Ä—É–≥–æ–π –∏–≥—Ä—ã

| –°–ª–æ–π | –ß—Ç–æ –º–µ–Ω—è–µ—Ç—Å—è |
|------|-------------|
| **Content** | –ù–æ–≤—ã–µ –ø–∞–∫–∏: –≤—Ä–∞–≥–∏, –∫–∞—Ä—Ç—ã, encounter types |
| **Rules** | –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (—Ñ–æ—Ä–º—É–ª—ã, –ª–∏–º–∏—Ç—ã). –°–∞–º Rule System —Ç–æ—Ç –∂–µ |
| **Encounter Engine** | –ù–∏—á–µ–≥–æ. –†–∞–±–æ—Ç–∞–µ—Ç as-is |
| **Game Integration** | –ù–æ–≤—ã–π Context Builder, Result Applier, Save/Load |
| **UI** | –ù–æ–≤—ã–π –≤–∏–∑—É–∞–ª—å–Ω—ã–π —Å—Ç–∏–ª—å |

---

## 8. Presentation Bridge (–°–≤—è–∑—å —Å UI)

### 8.1 –ü—Ä–æ–±–ª–µ–º–∞

Encounter Engine —Ä–∞–±–æ—Ç–∞–µ—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ (—Ä–∞—Å—á—ë—Ç –∑–∞ ~0.01—Å). –ò–≥—Ä–æ–∫ –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ (–∞–Ω–∏–º–∞—Ü–∏—è –∞—Ç–∞–∫–∏ ‚Üí —Ü–∏—Ñ—Ä—ã —É—Ä–æ–Ω–∞ ‚Üí –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ HP –±–∞—Ä–∞ ‚Üí —Å–º–µ—Ä—Ç—å –≤—Ä–∞–≥–∞ = 3‚Äì4 —Å–µ–∫—É–Ω–¥—ã).

### 8.2 –†–µ—à–µ–Ω–∏–µ: Event Queue Pattern

Game Integration –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞–ø—Ä—è–º—É—é –≤ UI. –û–Ω –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç Transaction –≤ –æ—á–µ—Ä–µ–¥—å –≤–∏–∑—É–∞–ª—å–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π.

```
Engine                    ViewModel                   View
  ‚îÇ                          ‚îÇ                          ‚îÇ
  ‚îÇ  Transaction             ‚îÇ                          ‚îÇ
  ‚îÇ  (HP: 10‚Üí5, Dead)       ‚îÇ                          ‚îÇ
  ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ                          ‚îÇ
  ‚îÇ                          ‚îÇ  queue.add:              ‚îÇ
  ‚îÇ                          ‚îÇ  1. playAnimation(       ‚îÇ
  ‚îÇ                          ‚îÇ     "attack_heavy")      ‚îÇ
  ‚îÇ                          ‚îÇ  2. showDamageText("-5") ‚îÇ
  ‚îÇ                          ‚îÇ  3. updateHP(to: 5)     ‚îÇ
  ‚îÇ                          ‚îÇ  4. playDeathSequence() ‚îÇ
  ‚îÇ                          ‚îÇ                          ‚îÇ
  ‚îÇ                          ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ
  ‚îÇ                          ‚îÇ  Serial Playback         ‚îÇ
  ‚îÇ                          ‚îÇ  (–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ)       ‚îÇ
```

### 8.3 –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ

- **State** (–≤ –¥–≤–∏–∂–∫–µ) –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è **–º–≥–Ω–æ–≤–µ–Ω–Ω–æ** ‚Äî –¥–ª—è –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–π
- **View** (–Ω–∞ —ç–∫—Ä–∞–Ω–µ) **"–¥–æ–≥–æ–Ω—è–µ—Ç"** State —á–µ—Ä–µ–∑ –∞–Ω–∏–º–∞—Ü–∏–∏
- **UI –∑–∞–ø—Ä–µ—â–µ–Ω–æ** —á–∏—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –Ω–∞–ø—Ä—è–º—É—é –∏–∑ Engine –≤–æ –≤—Ä–µ–º—è –ø—Ä–æ–∏–≥—Ä—ã–≤–∞–Ω–∏—è –æ—á–µ—Ä–µ–¥–∏ (—á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –≥–ª–∏—Ç—á–µ–π: –±–∞—Ä —É–∂–µ –ø—É—Å—Ç–æ–π, –∞ –º–æ–Ω—Å—Ç—Ä –µ—â—ë –ø–∞–¥–∞–µ—Ç)

---

## 9. –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –±—É–¥—É—â–∏–º–∏ —Ñ–æ—Ä–º–∞—Ç–∞–º–∏

### 9.1 –ö–æ–æ–ø–µ—Ä–∞—Ç–∏–≤ (Party vs N)

–ß—Ç–æ —É–∂–µ –∑–∞–ª–æ–∂–µ–Ω–æ:
- `participants: [Participant]` ‚Äî –º–∞—Å—Å–∏–≤, –Ω–µ –æ–¥–∏–Ω–æ—á–Ω–∞—è —Å—É—â–Ω–æ—Å—Ç—å
- `EncounterResult.endParticipantStates` ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
- `Transaction` ‚Äî generic, –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω –∫ "–æ–¥–Ω–æ–º—É –∏–≥—Ä–æ–∫—É"

–ß—Ç–æ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å:
- **Turn Order –≤–Ω—É—Ç—Ä–∏ Party** ‚Äî –∫—Ç–æ —Ö–æ–¥–∏—Ç –ø–µ—Ä–≤—ã–º –∏–∑ –≥–µ—Ä–æ–µ–≤ (–∫–æ–æ–ø-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ, –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ `EncounterRules`)
- **Shared vs Personal Fate Deck** ‚Äî –æ–¥–Ω–∞ –∫–æ–ª–æ–¥–∞ –Ω–∞ –ø–∞—Ä—Ç–∏—é –∏–ª–∏ —É –∫–∞–∂–¥–æ–≥–æ —Å–≤–æ—è (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `EncounterContext`)
- **Multi-Transaction** ‚Äî –∫–∞–∂–¥—ã–π –∏–≥—Ä–æ–∫ –ø–æ–ª—É—á–∞–µ—Ç —Å–≤–æ–π –Ω–∞–±–æ—Ä —ç—Ñ—Ñ–µ–∫—Ç–æ–≤

**–ü—Ä–∏–Ω—Ü–∏–ø:** Strict Phases –Ω–µ –º–µ–Ω—è—é—Ç—Å—è. –§–∞–∑–∞ `playerAction` –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ –∏—Ç–µ—Ä–∏—Ä—É–µ—Ç—Å—è –ø–æ –≥–µ—Ä–æ—è–º (turn order –≤–Ω—É—Ç—Ä–∏ —Ñ–∞–∑—ã), –Ω–æ –¥–ª—è –¥–≤–∏–∂–∫–∞ —ç—Ç–æ **–æ–¥–Ω–∞ —Ñ–∞–∑–∞** `playerAction`. –ü–æ–¥-–∏—Ç–µ—Ä–∞—Ü–∏–∏ ‚Äî –ø—Ä–∞–≤–∏–ª–æ –≤–Ω—É—Ç—Ä–∏ —Ñ–∞–∑—ã, –Ω–µ –Ω–æ–≤—ã–µ —Ñ–∞–∑—ã (INV-ENC-001 –Ω–µ –Ω–∞—Ä—É—à–∞–µ—Ç—Å—è).

### 9.2 –ù–∞—Å—Ç–æ–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è

| –†–µ—à–µ–Ω–∏–µ | –ü–æ—á–µ–º—É –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –Ω–∞—Å—Ç–æ–ª–∫–∏ |
|---------|------------------------------|
| Strict Phases | –ò–≥—Ä–æ–∫–∏ –∑–∞ —Å—Ç–æ–ª–æ–º –ª–µ–≥–∫–æ —Å–ª–µ–¥—É—é—Ç —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–º—É –ø–æ—Ä—è–¥–∫—É |
| Fate Deck –≤–º–µ—Å—Ç–æ RNG | –§–∏–∑–∏—á–µ—Å–∫–∞—è –∫–æ–ª–æ–¥–∞ –∫–∞—Ä—Ç –≤–º–µ—Å—Ç–æ –∫—É–±–∏–∫–æ–≤ |
| –î–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã–µ behaviors | Intent –≤—Ä–∞–≥–∞ –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è –ø–æ —Ç–∞–±–ª–∏—Ü–µ ‚Äî –º–æ–∂–Ω–æ –Ω–∞–ø–µ—á–∞—Ç–∞—Ç—å –Ω–∞ –∫–∞—Ä—Ç–µ |
| Generic modifiers | –ñ–µ—Ç–æ–Ω—ã –º–µ—Å—Ç–Ω–æ—Å—Ç–∏ –≤–º–µ—Å—Ç–æ digital-–∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ |
| Transaction as result | –ö–∞—Ä—Ç–æ—á–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞: "–ü—Ä–∏–º–µ–Ω–∏—Ç–µ —ç—Ç–∏ —ç—Ñ—Ñ–µ–∫—Ç—ã" |

**–ß—Ç–æ –ù–ï –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é:**
- `ConditionEvaluator` —Å –≤–ª–æ–∂–µ–Ω–Ω—ã–º–∏ —É—Å–ª–æ–≤–∏—è–º–∏ ‚Äî –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è —É–ø—Ä–æ—â–µ–Ω–∏–µ –¥–ª—è —Ä—É—á–Ω–æ–≥–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
- –°–ª–æ–∂–Ω—ã–µ multi-condition behaviors ‚Äî —Ç–∞–±–ª–∏—á–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–ª—è –Ω–∞—Å—Ç–æ–ª–∫–∏

**–ü—Ä–∏–Ω—Ü–∏–ø:** Digital-–≤–µ—Ä—Å–∏—è ‚Äî —ç—Ç–æ **–∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è** –Ω–∞—Å—Ç–æ–ª–∫–∞, –∞ –Ω–µ –Ω–∞–æ–±–æ—Ä–æ—Ç. –ï—Å–ª–∏ –ø—Ä–∞–≤–∏–ª–æ –Ω–µ–ª—å–∑—è –æ–±—ä—è—Å–Ω–∏—Ç—å –∑–∞ —Å—Ç–æ–ª–æ–º ‚Äî –æ–Ω–æ —Å–ª–∏—à–∫–æ–º —Å–ª–æ–∂–Ω–æ–µ.

---

## Sequence Diagram: –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª –≤—Å—Ç—Ä–µ—á–∏

```
sequenceDiagram
    participant GameEngine as –ë–æ–ª—å—à–∞—è –ò–≥—Ä–∞
    participant Encounter as Encounter System
    participant ViewModel as Presentation Bridge

    Note over GameEngine: –ò–≥—Ä–æ–∫ –≤—Å—Ç—Ä–µ—á–∞–µ—Ç –≤—Ä–∞–≥–∞

    GameEngine->>GameEngine: 1. –°–±–æ—Ä –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (Context Builder)
    Note right of GameEngine: Hero Stats + Enemy Def +
    Note right of GameEngine: Environment Modifiers +
    Note right of GameEngine: Fate Deck Snapshot

    GameEngine->>Encounter: 2. EncounterEngine(context:)

    rect rgb(30, 30, 30)
        Note over Encounter: STEP-BASED –¶–ò–ö–õ (–∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω)
        Encounter->>Encounter: generateIntent(for:)
        Encounter->>Encounter: performAction(.attack / .spiritAttack / ...)
        Encounter->>Encounter: resolveEnemyAction(enemyId:)
        Encounter->>Encounter: advancePhase()
        Note over Encounter: –ü–æ–≤—Ç–æ—Ä –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
    end

    Encounter-->>GameEngine: 3. finishEncounter() ‚Üí EncounterResult

    GameEngine->>GameEngine: 4. State update (–º–≥–Ω–æ–≤–µ–Ω–Ω–æ)
    GameEngine->>ViewModel: 5. Transaction ‚Üí Event Queue
    ViewModel->>ViewModel: 6. Serial Playback (–∞–Ω–∏–º–∞—Ü–∏–∏)
```

---

**–°—Ç–∞—Ç—É—Å –¥–æ–∫—É–º–µ–Ω—Ç–∞:** APPROVED
**–í–µ—Ä—Å–∏—è:** 1.0
**–î–∞—Ç–∞:** 29 —è–Ω–≤–∞—Ä—è 2026
**Changelog:**
- v1.0 (2026-01-29): Initial APPROVED. P0 audit fixes: named phases, SoT behaviors.json, RNG contract, perEntityOutcomes, FateKeyword/Tags split
