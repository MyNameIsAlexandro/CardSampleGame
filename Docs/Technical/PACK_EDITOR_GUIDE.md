# PackEditor: Руководство пользователя

PackEditor — это macOS приложение на SwiftUI для редактирования контент-паков игры ECHO: Legends of the Veil. Приложение использует трёхколончный интерфейс NavigationSplitView для удобной навигации и редактирования сущностей.

---

## 1. Начало работы

### Открытие пака
1. Нажмите **Cmd+O** или выберите File > Open Pack
2. В диалоговом окне выберите папку, содержащую **manifest.json**
3. PackEditor загрузит все файлы пака и отобразит их структуру

### Интерфейс приложения
PackEditor состоит из трёх основных колонок:

- **Левая колонка (Sidebar):** Категории контента (Enemies, Cards, Events, и т.д.)
- **Средняя колонка (Entity List):** Список сущностей выбранной категории
- **Правая колонка (Editor):** Детальный редактор для выбранной сущности

```
┌─────────────────────────────────────────┐
│ Sidebar       │ Entity List  │ Editor  │
├───────────────┼──────────────┼─────────┤
│ • Enemies     │ • Goblin     │ Form    │
│ • Cards       │ • Orc        │ Fields  │
│ • Events      │ • Dragon     │ Preview │
│ • Regions     └──────────────┘         │
│ • Heroes      │                       │
│ • FateCards   │                       │
│ • Quests      │                       │
│ • Behaviors   │                       │
│ • Anchors     │                       │
│ • Balance     │                       │
└───────────────┴────────────────────────┘
```

---

## 2. Навигация

### По категориям
1. Нажмите на название категории в левой колонке (Sidebar)
2. Список сущностей в средней колонке обновится
3. Средняя и правая колонки покажут доступные сущности

### По сущностям
1. Выберите категорию
2. Нажмите на сущность в списке (средняя колонка)
3. Детали сущности откроются в правой колонке

### Глобальный поиск
- Нажмите **Cmd+F** для открытия поля поиска
- Поиск работает по всем категориям и полям сущностей
- Результаты фильтруют средню колонку

### Просмотр метаданных пака
- Нажмите на **Manifest** в sidebar или оставьте среднюю колонку пустой
- Откроется редактор метаданных пака (ID, версия, автор и т.д.)

---

## 3. Редактирование сущностей

### Типы полей редактора
Каждая сущность имеет специализированную форму с различными типами полей:

| Тип | Описание | Пример |
|---|---|---|
| **Text** | Простое текстовое поле | Имя сущности |
| **Localized Text** | Текст на нескольких языках (EN/RU) | Описание, диалоги |
| **Number** | Числовые значения | HP, урон, стоимость |
| **Enum (Picker)** | Выпадающий список | Тип врага, класс карты |
| **Boolean** | Флажок вкл/выкл | Активная сущность |
| **List** | Список элементов | Навыки, эффекты |
| **JSON** | Полный JSON объект | Сложные конфигурации |

### Отслеживание изменений
- Поле "isDirty" указывает на несохранённые изменения
- Заголовок окна показывает точку (•) для файлов с изменениями
- Сохраняйте регулярно: **Cmd+S**

### Отмена действий
- **Cmd+Z** для отмены последнего действия
- **Cmd+Y** для повтора действия (если доступно)

### Валидация в реальном времени
- Некорректные значения подсвечиваются красным
- Подсказки появляются при наведении мыши
- Обязательные поля отмечены звёздочкой (*)

---

## 4. Манифест пака

Манифест содержит метаинформацию о паке. Откройте его кликом на **Manifest** в sidebar.

### Основные свойства
- **ID:** Уникальный идентификатор пака (только буквы и подчёркивание)
- **Name:** Локализованное имя пака
- **Version:** Версия пака (семантическое версионирование)
- **Type:** Тип пака (CharacterPack, StoryPack, ContentPack)
- **Author:** Автор пака

### Совместимость
- **Core Version:** Требуемая минимальная версия движка
- **Supported Locales:** Поддерживаемые языки (EN, RU и т.д.)

### Параметры сюжета (Story Settings)
- **Entry Points:** Точки входа в сюжет (если это StoryPack)
- **Difficulty:** Сложность (Easy, Normal, Hard)
- **Estimated Playtime:** Примерное время прохождения в минутах

### Сохранение манифеста
- Нажмите **Cmd+S** для сохранения
- Манифест автоматически синхронизируется с manifest.json

---

## 5. CRUD операции

### Создание (Create)
**Добавить новую сущность:**
1. Выберите категорию в sidebar
2. Нажмите кнопку **"+"** в toolbar или **Cmd+N**
3. Если доступны шаблоны, выберите тип:
   - **Враги:** Beast (зверь), Undead (нежить), Boss (босс)
   - **Карты:** Attack (атака), Defense (защита), Spell (заклинание), Item (предмет)
   - **Регионы:** Settlement (поселение), Wilderness (дикая местность), Dungeon (подземелье)
4. Введите имя сущности
5. Начните редактирование в правой колонке

### Дублирование (Duplicate)
**Копировать существующую сущность:**
1. Выберите сущность в списке
2. Нажмите кнопку **"doc.on.doc"** (два документа) или **Cmd+D**
3. Создастся копия с добавкой "_copy" в имени
4. Отредактируйте копию по необходимости

### Удаление (Delete)
**Удалить сущность:**
1. Выберите сущность в списке
2. Нажмите кнопку **"-"** в toolbar
3. Подтвердите удаление в диалоговом окне
4. Сущность будет удалена из пака

### Подтверждение действий
- Все операции удаления требуют подтверждения
- Используйте "Cancel" или "Delete" в диалоговом окне

---

## 6. Импорт / Экспорт

### Экспорт в буфер обмена
**Копировать сущность как JSON:**
1. Выберите сущность
2. В левом toolbar нажмите **"Copy"** или используйте контекстное меню
3. JSON сущности скопируется в буфер обмена
4. Используйте в других паках или документации

### Импорт из буфера обмена
**Вставить JSON сущность:**
1. Скопируйте JSON сущности в буфер обмена
2. Выберите соответствующую категорию
3. Нажмите **Cmd+V** или используйте File > Paste from Clipboard
4. JSON будет распарсен и создана новая сущность
5. Редактируйте при необходимости

### Импорт из файла
**Загрузить сущности из .json файла:**
1. Выберите File > Import from File
2. В диалоговом окне выберите .json файл
3. PackEditor загрузит все сущности из файла
4. Дублирующиеся ID будут заменены или пропущены (по настройке)

### Экспорт в файл
**Сохранить сущности в .json файл:**
1. Выберите одну или несколько сущностей (Cmd+Click для множественного выбора)
2. File > Export Selected to File
3. Выберите место сохранения
4. PackEditor создаст .json файл с выбранными сущностями

---

## 7. Перетаскивание и переупорядочивание

### Изменение порядка сущностей
- **Левой кнопкой мыши** перетащите сущность в списке на новую позицию
- Порядок автоматически сохраняется в **_editor_order.json**
- Каждая категория имеет свой порядок

### Перемещение между категориями
- Перетащите сущность между категориями (если это поддерживается)
- Некоторые категории не поддерживают перемещение между собой

### Отмена переупорядочивания
- **Cmd+Z** отменит последнее изменение порядка
- Порядок вернётся к предыдущему состоянию

---

## 8. Валидация

### Кнопка валидации
- Нажмите **✓ (checkmark)** в toolbar для полной валидации пака
- PackEditor проверит все сущности на ошибки и предупреждения

### Индикаторы ошибок
- **Красный значок** около категории: критическая ошибка
- **Оранжевый значок** около категории: предупреждение
- **Зелёный значок:** всё в порядке

### Типы ошибок и предупреждений
| Тип | Описание |
|---|---|
| **Missing ID** | Отсутствует обязательный ID |
| **Duplicate ID** | ID уже существует в паке |
| **Missing Localized Text** | Нет перевода на нужный язык |
| **Invalid Reference** | Ссылка на несуществующую сущность |
| **Out of Range** | Числовое значение вне допустимого диапазона |

### Встроенная валидация
- Валидация в реальном времени при редактировании
- Подсказки выводятся под полями с ошибками
- Сохранение невозможно при критических ошибках

---

## 9. JSON Preview

### Просмотр JSON сущности
1. Выберите сущность в списке
2. Нажмите **"{}"** (Curly Braces) в toolbar
3. Откроется sheet с полным JSON сущности

### Функции preview
- **Read-only mode:** JSON нельзя редактировать напрямую
- **Copy button:** Скопировать JSON в буфер обмена
- **Search in JSON:** Поиск по содержимому JSON

### Структура JSON
Пример структуры врага:

```json
{
  "id": "goblin_scout",
  "nameEN": "Goblin Scout",
  "nameRU": "Гоблин-разведчик",
  "hp": 15,
  "damage": 3,
  "type": "Beast",
  "skills": ["stealth", "evasion"],
  "loot": {
    "gold": 25,
    "experience": 50
  }
}
```

---

## 10. Компиляция

### Компиляция пака
1. Убедитесь, что все сущности валидны (✓)
2. Нажмите **Compile** в toolbar
3. PackEditor скомпилирует пак в оптимизированный .pack файл
4. Файл сохранится рядом с manifest.json

### Формат .pack
- Бинарный формат для оптимизации размера и скорости загрузки
- Сжатая версия всех JSON сущностей
- Используется движком во время игры

### Ошибки компиляции
- Если пак содержит ошибки, компиляция будет отменена
- Исправьте ошибки валидации перед повторной компиляцией

---

## 11. Горячие клавиши

| Сочетание | Действие |
|---|---|
| **Cmd+O** | Открыть пак (выбрать папку с manifest.json) |
| **Cmd+S** | Сохранить все изменения |
| **Cmd+N** | Создать новую сущность в выбранной категории |
| **Cmd+D** | Дублировать выбранную сущность |
| **Cmd+Z** | Отмена последнего действия |
| **Cmd+Y** | Повтор действия |
| **Cmd+V** | Импортировать JSON из буфера обмена |
| **Cmd+F** | Открыть глобальный поиск |
| **Cmd+C** | Копировать выбранную сущность в JSON |
| **Cmd+X** | Вырезать сущность (удалить и скопировать) |
| **Cmd+L** | Перейти на следующую категорию |
| **Cmd+K** | Перейти на предыдущую категорию |
| **Delete** | Удалить выбранную сущность (с подтверждением) |
| **Enter** | Начать редактирование имени сущности |
| **Escape** | Закрыть модальное окно или отменить редактирование |

---

## 12. Типы контента и их особенности

### Враги (Enemies)
- **Поля:** ID, имя (EN/RU), HP, урон, тип (Beast/Undead/Boss), навыки, добыча
- **Шаблоны:** Beast (зверь), Undead (нежить), Boss (босс)
- **Валидация:** HP и урон должны быть положительными числами

### Карты (Cards)
- **Поля:** ID, имя (EN/RU), описание (EN/RU), стоимость, тип (Attack/Defense/Spell/Item)
- **Шаблоны:** Attack (атака), Defense (защита), Spell (заклинание), Item (предмет)
- **Локализация:** Полная поддержка EN и RU

### События (Events)
- **Поля:** ID, описание, триггер, последствия, флаги
- **Условия:** Могут зависеть от состояния игры
- **Действия:** Определяют изменения в состоянии

### Регионы (Regions)
- **Поля:** ID, имя (EN/RU), описание (EN/RU), враги, события, тип (Settlement/Wilderness/Dungeon)
- **Шаблоны:** Settlement (поселение), Wilderness (дикая местность), Dungeon (подземелье)
- **Связи:** Могут ссылаться на врагов и события

### Герои (Heroes)
- **Поля:** ID, имя (EN/RU), класс, стартовые карты, способности
- **Настройка:** Каждый герой имеет уникальный набор карт
- **Баланс:** Герои должны быть сбалансированы по мощности

### Карты судьбы (FateCards)
- **Поля:** ID, описание (EN/RU), эффект, редкость
- **Специальные эффекты:** Влияют на ход боя
- **Редкость:** Common, Uncommon, Rare, Legendary

### Квесты (Quests)
- **Поля:** ID, название (EN/RU), описание (EN/RU), цель, награда
- **Прогресс:** Отслеживают выполнение задач игроком
- **Награды:** Золото, опыт, предметы

### Поведение (Behaviors)
- **Поля:** ID, описание, условия, действия
- **AI:** Определяют поведение врагов в бою
- **Скрипты:** Комбинируют условия и действия

### Якоря (Anchors)
- **Поля:** ID, координаты, метаданные
- **Использование:** Точки спауна, триггеры, ориентиры
- **Расположение:** На картах и в регионах

### Баланс (Balance)
- **Поля:** Коэффициенты, множители, пороги
- **Настройка:** Сложность, экономика, прогрессия
- **Тестирование:** Изменяйте для балансировки игры

---

## 13. Советы и рекомендации

### Организация пака
- Используйте консистентное именование (snake_case для ID)
- Группируйте связанные сущности по категориям
- Регулярно проверяйте валидацию

### Локализация
- Всегда заполняйте оба языка (EN и RU)
- Проверяйте перевод на натуральность и читаемость
- Используйте глоссарий для консистентной терминологии

### Производительность
- Большие паки (100+ врагов) могут замедлить интерфейс
- Рассмотрите разделение на несколько паков
- Используйте импорт/экспорт для работы с подсетами

### Версионирование
- Следуйте семантическому версионированию (MAJOR.MINOR.PATCH)
- MAJOR: Несовместимые изменения
- MINOR: Новый функционал, совместимый
- PATCH: Исправления ошибок

### Резервные копии
- Регулярно коммитьте в систему контроля версий (git)
- Используйте .pack файлы для резервного копирования
- Экспортируйте критичные данные в JSON перед крупными изменениями

### Совместная работа
- Редактируйте разные категории одновременно
- Разрешайте конфликты слияния вручную
- Используйте системы контроля версий для отслеживания

---

## 14. Решение проблем

### PackEditor не открывает пак
**Проблема:** Выбранная папка не распознана как пак
**Решение:** Убедитесь, что папка содержит файл manifest.json

### Сущность не сохраняется
**Проблема:** Изменения теряются при закрытии
**Решение:** Нажимайте Cmd+S регулярно; проверьте права доступа к файлам

### Валидация показывает ошибки
**Проблема:** Ошибки ID, ссылок или данных
**Решение:** Прочитайте сообщение об ошибке; исправьте указанные поля

### JSON импорт не работает
**Проблема:** JSON не распознан
**Решение:** Убедитесь, что JSON валиден (используйте jsonlint.com)

### Компиляция завершилась с ошибкой
**Проблема:** Невозможно создать .pack файл
**Решение:** Запустите полную валидацию; исправьте все ошибки

### Интерфейс зависает при открытии большого пака
**Проблема:** PackEditor не отзывается
**Решение:** Закройте и переоткройте приложение; разделите пак на несколько

---

## Приложение A: Быстрый старт

1. Откройте PackEditor
2. Нажмите Cmd+O и выберите папку пака
3. В sidebar выберите категорию (например, "Enemies")
4. Нажмите Cmd+N или "+", выберите шаблон
5. Заполните обязательные поля (ID, имена, параметры)
6. Нажимайте Cmd+S после каждого изменения
7. Нажмите ✓ для валидации
8. Нажмите "Compile" для создания .pack файла

---

## Приложение B: Справочная информация

### Структура папки пака
```
MyPack/
├── manifest.json          # Метаинформация пака
├── enemies.json           # Враги (опционально)
├── cards.json             # Карты (опционально)
├── events.json            # События (опционально)
├── regions.json           # Регионы (опционально)
├── heroes.json            # Герои (опционально)
├── fatecards.json         # Карты судьбы (опционально)
├── quests.json            # Квесты (опционально)
├── behaviors.json         # Поведение (опционально)
├── anchors.json           # Якоря (опционально)
├── balance.json           # Баланс (опционально)
├── MyPack.pack            # Скомпилированный пак (создаётся)
└── _editor_order.json     # Порядок сущностей (создаётся)
```

### Типы данных в JSON
```json
{
  "stringField": "текст",
  "numberField": 42,
  "booleanField": true,
  "arrayField": ["item1", "item2"],
  "objectField": {
    "nestedKey": "nestedValue"
  },
  "localizedText": {
    "EN": "English text",
    "RU": "Русский текст"
  }
}
```

---

Версия документа: 1.0
Дата обновления: 31 января 2026
Язык: Русский
