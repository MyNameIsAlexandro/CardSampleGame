# Ritual Combat โ Design Document (Project "Ritual")

**ะะฐัะฐ:** 2026-02-13
**ะกัะฐััั:** ะะตะฒะธะทะธั v1.2 (ะฟะพ ะทะฐะผะตัะฐะฝะธัะผ ะฐัะดะธัะพัะพะฒ)
**Epic:** Combat Visual Overhaul
**ะฆะตะปั:** ะะฐะผะตะฝะธัั ััะตะผะฐัะธัะฝัะน UI ะฑะพั ะฝะฐ ะฐัะผะพััะตัะฝัั ััะตะฝั ะฒ ััะธะปะต "Inscryption / Slavic Dark Fantasy", ะพะฑัะตะดะธะฝะธะฒ ะดะฒะฐ ะฑะพะตะฒัั ัะบัะฐะฝะฐ (SwiftUI campaign + SpriteKit arena) ะฒ ะตะดะธะฝัั SpriteKit-ััะตะฝั.

---

## 1. ะกะตะฒะตัะฝะฐั ะทะฒะตะทะดะฐ

ะะพะน โ ะฝะต ะพัะฝะพะฒะฝะพะน ะบะพะฝัะตะฝั, ะฐ ะฟะพะดัะธััะตะผะฐ ะดะปั ัะฐะทัะตัะตะฝะธั ะบะพะฝัะปะธะบัะพะฒ, "ัะตะฝะฐ ะทะฐ ะฝะฐะณัะฐะดั" ะธ ะธััะพัะฝะธะบ ัะธัะบะฐ. Encounter System โ ัะธััะตะผะฐ ะฒัััะตั, ะณะดะต ะฑะพะน โ ะปะธัั ะพะดะธะฝ ะธะท ะฟััะตะน.

"ะฆะตะฟะปัััะธะน ะฑะพะน" ะดะปั ััะพะณะพ ะฟัะพะตะบัะฐ โ ััะพ:

1. **ะัะฐะผะฐ ะพะดะฝะพะณะพ Fate-ัะตััะฐ** (ะบะฐะบ ะฒ Arkham/Call of Cthulhu): ะธะณัะพะบ ะณะพัะพะฒะธััั โ ะบะพะผะผะธัะธั โ ะฒัะบััะฒะฐะตั ััะดัะฑั โ ะฟะพะปััะฐะตั ะฟะพัะปะตะดััะฒะธั.
2. **ะัะฑะพั ะฟััะธ:** Kill vs Pacify โ ะฝะต ะบะพัะผะตัะธะบะฐ, ะฐ ัะฐะทะฝัะต ะฟะพัะปะตะดััะฒะธั ะธ ััะธะปั ะธะณัั (ะธ ััะพ ะดะพะปะถะฝะพ ััะฒััะฒะพะฒะฐัััั ะฒ UX).
3. **ะขะตะปะตะณัะฐัะธัะพะฒะฐะฝะธะต ัะณัะพะทั** ัะตัะตะท Intent โ ัะฐะบัะธะบะฐ "ะฟัะพัะธัะฐะป, ะพัะฒะตัะธะป".
4. **ะะตะทะพะฝะฐะฝั ะบะฐะบ ัะธะทะธะบะฐ ััะตะฝั**, ะฐ ะฝะต ะฟะพะปะพัะบะฐ ะฒ UI (ัะฒะตั, ะทะฒัะบ, ัะฐััะธัั, ะฟะพะฒะตะดะตะฝะธะต Fate-ะบะฐััั, "ะดััะฐะฝะธะต" ะผะธัะฐ).
5. **ะะพัะพัะบะธะต, ะฟะปะพัะฝัะต ะฟะพ ัะตัะตะฝะธัะผ ััะฒะฐัะบะธ**, ะฑะตะท "ะบะฝะพะฟะบะธ Attack ัะฐะดะธ ะบะฝะพะฟะบะธ Attack".

### ะกะฐะฝะธัะฐัะฝัะน ัะตัั ะบะพะฝัะตะฟัะฐ

ะัะปะธ ัะตะทะพะฝะฐะฝั ะฝะต ะฒะปะธัะตั ะฝะฐ ะฑะพะน/ะบะพะฝัะตะฝั ะธะปะธ Fate Deck ะฝะต ะดะฐัั ะฟะปะฐะฝะธััะตะผะพะณะพ ัะธัะบะฐ โ ะบะพะฝัะตะฟั ัะตััะตััั. ะะธะทัะฐะปัะฝะฐั ะฟะพะดะฐัะฐ ะดะพะปะถะฝะฐ ะฟะพะดะดะตัะถะธะฒะฐัั ััะธ ััะพะปะฟั, ะฐ ะฝะต ัััะตััะฒะพะฒะฐัั "ะดะปั ะบัะฐัะพัั".

---

## 2. ะะธะฐะณะฝะพััะธะบะฐ ัะตะบััะตะณะพ ัะพััะพัะฝะธั

### 2.1 ะขะฐะบัะธะปัะฝะพััั ะธ "ะฝะฐััะพะปัะฝะพััั" ะพััััััะฒััั

Encounter ะฟะพะทะธัะธะพะฝะธััะตััั ะบะฐะบ "ะฐะฒัะพะผะฐัะธะทะธัะพะฒะฐะฝะฝะฐั ะฝะฐััะพะปะบะฐ" (ะฟัะฐะฒะธะปะฐ/ัะฐะทั/ััะฐะฝะทะฐะบัะธะธ), ะฝะพ ัะตะบััะธะน UX โ "ัะพัะผะพัะบะฐ": ะฒัะฑัะฐะป โ ะฝะฐะถะฐะป ะบะฝะพะฟะบั โ ัะธััั ะฟะพะผะตะฝัะปะธัั. ะญัะพ ัะฑะธะฒะฐะตั ะณะปะฐะฒะฝัะน ะบะฐะนั Fate-ัะธััะตะผั: ะผะพะผะตะฝั ะฒัะบัััะธั ะธ ััะฐะฒะบะธ.

### 2.2 ะะฒะพะนะฝะฐั ัะบะฐะปะฐ Kill/Pacify ะฝะต ะพัััะฐะตััั

Kill/Pacify โ ะบะปััะตะฒะพะน ะฒัะฑะพั. ะะพ ะตัะปะธ ะฒัะฐะณ โ ะบััะถะพะบ ั ัะตะบััะพะผ, ะฐ ะธััะพะด โ ะดะฒะต ะฟะพะปะพัะบะธ, ะธะณัะพะบ ะฝะต ะพัััะฐะตั ะผะพัะฐะปัะฝะพะน ัะฐะทะฒะธะปะบะธ. "ะฃะฑะธัั" ะดะพะปะถะฝะพ ะพัััะฐัััั ะธะฝะฐัะต, ัะตะผ "ัะปะพะผะธัั ะฒะพะปั".

### 2.3 Intent โ "ะปะตะนะฑะป", ะฐ ะฝะต "ัะณัะพะทะฐ"

Intent ะดะพะปะถะตะฝ ะฑััั ัะตะปะตะณัะฐัะพะผ ัะณัะพะทั ะฟะตัะตะด ะดะตะนััะฒะธะตะผ ะธะณัะพะบะฐ. ะะตะท ะฟะพััะฐะฝะพะฒะบะธ (ะฒัะฟััะบะฐ, ะถะตัั, ััะฝะฐ, ะทะฒัะบ) ะธะณัะพะบ ะฝะต ััะฒััะฒัะตั ะดะฐะฒะปะตะฝะธั.

### 2.4 ะะตะทะพะฝะฐะฝั ะฝะต "ะถะธะฒัั" ะฒ ะฑะพั

ะะพ ะบะพะฝัะตะฟัั: ะฒ ะะฐะฒะธ ะผะธั ัะตะผะฝะตะตั/ัะตะฟัะตั/ัะพะปะพะดะธั, ะฒ ะัะฐะฒะธ โ ััะฝะพััั/ะผะพะปัะฐะฝะธะต/ะฟะพััะดะพะบ, ะฒ ะฏะฒะธ โ ะดัะผ/ัะตะฟะปะพ/ะฟัะพััะฐั ะถะธะทะฝั. ะัะปะธ ะฑะพะน ะฒัะณะปัะดะธั ะพะดะธะฝะฐะบะพะฒะพ ะฟัะธ -80 ะธ +80, ัะฐะฝะธัะฐัะฝัะน ัะตัั ะฟัะพะฒะฐะปะตะฝ ะฝะฐ ััะพะฒะฝะต ะพัััะตะฝะธั.

### 2.5 ะะฒะฐ ะฟะฐัะฐะปะปะตะปัะฝัั ะฑะพะตะฒัั ัะบัะฐะฝะฐ

- **SwiftUI** (EncounterViewModel) โ ะบะฐะผะฟะฐะฝะธั/ัะพะฑััะธั, tap-select + ะบะฝะพะฟะบะธ
- **SpriteKit** (CombatScene/EchoScenes) โ Arena sandbox, ECS + ะฐะฝะธะผะฐัะธะธ

ะะฒะฐ ะฟััะธ = ัะดะฒะพะตะฝะธะต ะฟะพะดะดะตัะถะบะธ, ัะฐััะพะถะดะตะฝะธะต UX.

---

## 3. Combat Loop 2.0 โ "ะะธััะฐะป ะฝะฐ ััะพะปะต"

### 3.1 ะะปะฐะฒะฝะฐั ะผััะปั

ะะฐะถะดัะน ัะฐัะฝะด ะพัััะฐะตััั ะบะฐะบ ะผะธะฝะธ-ััะตะฝะฐ:

```
(1) ะัะฐะณ ะฟะพะบะฐะทัะฒะฐะตั ะฝะฐะผะตัะตะฝะธะต โ
(2) ะขั "ะณะพัะพะฒะธัั ะฟัะพะฒะตัะบั" ะบะฐััะฐะผะธ โ
(3) ะขั "ะทะฐะฟะตัะฐััะฒะฐะตัั ะดะตะนััะฒะธะต" โ
(4) ะกัะดัะฑะฐ ะฒัะบััะฒะฐะตััั โ
(5) ะัะฐะณ ัะตะฐะปะธะทัะตั ัะณัะพะทั, ะฐ ัั ะทะฐัะธัะฐะตัััั.
```

### 3.2 ะััั ัะฐะบัะพะฒ ัะฐัะฝะดะฐ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 1. ะฃะะะะะ (Intent)                               โ
โ    ะัะฐะณ-ะธะดะพะป "ะพะถะธะฒะฐะตั": intent-ัะพะบะตะฝ             โ
โ    ะฒะฑะธะฒะฐะตััั ัะฒะตััั ะบะฐะบ ะฟะตัะฐัั.                   โ
โ    ะะฒัะบ/ัะพัะพั ะทะฐะฒะธัะธั ะพั ัะตะทะพะฝะฐะฝัะฐ.              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ 2. ะะะะะะขะะะะ (Ritual)                           โ
โ    1. Drag ะบะฐััั ะดะตะนััะฒะธั ะฒ ะะธััะฐะปัะฝัะน ะััะณ       โ
โ       โ selectCard() โ ัะฝะตัะณะธั ะทะฐัะตะทะตัะฒะธัะพะฒะฐะฝะฐ    โ
โ    2. (ะะฟั.) Drag ะดะพะฟ. ะบะฐััั ะฒ ะะพัััั            โ
โ       โ burnForEffort() โ ะบะฐััะฐ ัะณะพัะฐะตั,          โ
โ         +1 ะบ ะฑัะดััะตะน Fate-ะฟัะพะฒะตัะบะต               โ
โ    ะััะณ ัะฐะทะณะพัะฐะตััั ะฟัะพะฟะพััะธะพะฝะฐะปัะฝะพ Effort.       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ 3. ะะะะะงะะขะซะะะะะ (Execution)                     โ
โ    Drag ะขะพัะตะผ ะะตัะฐัะธ (โ/๐ฌ/โณ) ะฝะฐ ะฒัะฐะณะฐ/ะฐะปัะฐัั   โ
โ    โ commitAttack(effortBonus) / commitInfluence  โ
โ      / skipTurn                                   โ
โ    ะะฒัะบ ัะดะฐัะฐ ะบะฐะผะฝั. ะะฐะผะตัะฐ ัััััััั.             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ 4. ะกะฃะะฌะะ (Fate)                                 โ
โ    ะะฐััะฐ ะกัะดัะฑั ะฒัะบััะฒะฐะตััั.                     โ
โ    ะะพะผะตะฝั ะดัะฐะผั: flip โ value โ keyword.          โ
โ    Match bonus ะตัะปะธ ะผะฐััั ัะพะฒะฟะฐะปะฐ.                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ 5. ะะะกะะะะกะขะะะฏ (Consequences)                    โ
โ    ะฃัะพะฝ/ัััะตะบั ะฟัะธะผะตะฝัะตััั.                      โ
โ    ะัะฐะณ ัะตะฐะปะธะทัะตั ัะฒะพั ัะณัะพะทั.                   โ
โ    ะะฐัะธัะฝะฐั Fate-ะบะฐััะฐ ะฒัะบััะฒะฐะตััั.              โ
โ    ะะฐัะฝะด ะทะฐะฒะตััะฐะตััั.                            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### 3.3 ะะฐะฟะฟะธะฝะณ ะฝะฐ CombatSimulation (ECS ะฝะต ะปะพะผะฐะตะผ)

| ะขะฐะบั ะฟะตัะปะธ | ะคะฐะทะฐ (ะบะฐะฝะพะฝ: `EncounterPhase`) | ะงัะพ ะฟัะพะธััะพะดะธั ะฒ ัะธะผัะปััะธะธ |
|---|---|---|
| 1. ะฃะณัะพะทะฐ | `intent` | `AISystem.update()` ะณะตะฝะตัะธััะตั intent |
| 2. ะะพะดะณะพัะพะฒะบะฐ | `playerAction` | `selectCard()` / `burnForEffort()` โ ัะตะทะตัะฒะธัะพะฒะฐะฝะธะต |
| 3. ะะฐะฟะตัะฐััะฒะฐะฝะธะต | `playerAction` โ commit | `commitAttack()` / `commitInfluence()` / `skipTurn()` (effort ะธะท internal state) |
| 4. ะกัะดัะฑะฐ | ะฒะฝัััะธ commit | `fateService.resolve()` โ ะฒะฝัััะธ ะฐัะฐะบะธ/ะฒะปะธัะฝะธั |
| 5. ะะพัะปะตะดััะฒะธั | `enemyResolution` โ `roundEnd` | `resolveEnemyTurn()` + ะฟัะพะฒะตัะบะฐ ะบะพะฝัะฐ ะฑะพั |

**ะะปััะตะฒะพะน ะฟัะธะฝัะธะฟ:** UI ัะพะทะดะฐัั ะฟะพััะฐะฝะพะฒะบั ะฟะพะฒะตัั ัะพะน ะถะต ะปะพะณะธะบะธ. `CombatSimulation` ะฝะต ะทะฝะฐะตั ะฟัะพ ัะธััะฐะปัะฝัะน ะบััะณ, ะฟะตัะฐัะธ ะธ ััะผะฐะฝ โ ะพะฝ ะฒะธะดะธั ัะพะปัะบะพ `selectCard`, `commitAttack`, `resolveEnemyTurn`.

### 3.4 ะะตัะฐะฝะธะบะฐ "ะะตัะฐัั" (The Seal Object)

ะะผะตััะพ ะบะฝะพะฟะพะบ Attack/Influence/Wait โ ััะธ ัะธะทะธัะตัะบะธั ะพะฑัะตะบัะฐ ะฝะฐ ััะพะปะต (ัะพัะตะผั/ะบะฐะผะฝะธ ั ััะฝะฐะผะธ):

- **โ ะฃะดะฐั** (Body/HP) โ ะบะฐะผะตะฝั ั ััะฝะพะน ะผะตัะฐ
- **๐ฌ ะกะปะพะฒะพ** (Spirit/WP) โ ะบะฐะผะตะฝั ั ััะฝะพะน ะณะปะฐะทะฐ
- **โณ ะัะถะดะฐัั** (ัะบะพะฝะพะผะธั ััะดัะฑั) โ ะบะฐะผะตะฝั ั ััะฝะพะน ัะฐัะพะฒ, ะฒัะตะณะดะฐ ะดะพัััะฟะตะฝ

**ะะพะฒะตะดะตะฝะธะต:**
- ะะตัะฐัะธ **ัะบัััั/ะฝะตะฐะบัะธะฒะฝั** (ะฟะพััััะธะต ััะฝั, alpha 0.15), ะฟะพะบะฐ ะบะฐััะฐ ะฝะต ะฒ ะบััะณะต
- ะะพะณะดะฐ ะบะฐััะฐ ะฒ ะบััะณะต โ ะฟะตัะฐัะธ "ะทะฐะณะพัะฐัััั" (fade in + scale pulse), ััะฐะฝะพะฒัััั draggable
- โณ ะัะถะดะฐัั ะฒัะตะณะดะฐ ะดะพัััะฟะตะฝ (ะดะฐะถะต ะฑะตะท ะบะฐััั โ ะพัะพะทะฝะฐะฝะฝัะน ะฟัะพะฟััะบ), ะฝะพ ัััะบะปะตะต ะฑะตะท ะบะฐััั
- Drag ะฟะตัะฐัะธ ะฝะฐ ะฒัะฐะณะฐ โ commitAttack/commitInfluence
- Drag ะฟะตัะฐัะธ ะฝะฐ ะฐะปัะฐัั/ัะตะฝัั โ skipTurn (ะธะปะธ self-target)

### 3.5 ะะตัะฐะฝะธะบะฐ "ะฃัะธะปะธะต" (Effort) โ Source of Truth

> **ะะฐะฝะพะฝะธัะตัะบะฐั ัะพัะผัะปะฐ** (PROJECT_BIBLE, GDD ยง9.2):
> `Fate Test = Stat + FateCard + Effort >= Difficulty`
>
> **ะะฐะฝะพะฝะธัะตัะบะพะต ะพะฟัะตะดะตะปะตะฝะธะต** (GDD ยง9.2, EXPLORATION_CORE_DESIGN):
> "Effort โ ะธะณัะพะบ ะผะพะถะตั ัะฑัะพัะธัั ะบะฐััั ั ััะบะธ, ะบะฐะถะดะฐั ะดะฐัั +1 ะบ ะฟัะพะฒะตัะบะต"
>
> **ะขะตะบััะฐั ัะตะฐะปะธะทะฐัะธั:** `CombatCalculator.calculateAttackWithFate(effortCards:)` ัะถะต ะฟัะธะฝะธะผะฐะตั ะฟะฐัะฐะผะตัั ะธ ะฒะบะปััะฐะตั ะฒ ัะพัะผัะปั. `CombatSimulation` ะฟะพะบะฐ ะฝะต ะฟัะตะดะพััะฐะฒะปัะตั UI-ะฟััั ะดะปั ัะฑัะพัะฐ ะบะฐัั.

#### 3.5.1 ะะฟัะตะดะตะปะตะฝะธะต

**Effort** โ ะดะพะฑัะพะฒะพะปัะฝัะน ัะฑัะพั ะบะฐัั ะธะท ััะบะธ ะดะปั ััะธะปะตะฝะธั Fate-ะฟัะพะฒะตัะบะธ. ะะฐะถะดะฐั ัะฑัะพัะตะฝะฝะฐั ะบะฐััะฐ ะดะฐัั **+1 ะบ ะธัะพะณะพะฒะพะผั ะทะฝะฐัะตะฝะธั ัะตััะฐ**. ะญัะพ ะบะฐะฝะพะฝะธัะตัะบะฐั ัะฐััั ัะพัะผัะปั Fate Test, ะทะฐะดะพะบัะผะตะฝัะธัะพะฒะฐะฝะฝะฐั ะฒ PROJECT_BIBLE.

**ะกััะฐัะตะณะธัะตัะบะพะต ัะตัะตะฝะธะต:** "ะะพััะฐัะธัั ะบะฐััั ัะตะนัะฐั (ะณะฐัะฐะฝัะธัะพะฒะฐัั ััะฟะตั) ะธะปะธ ัะธัะบะฝััั (ัะพััะฐะฝะธัั ะพะฟัะธะธ ะฝะฐ ัะปะตะดัััะธะน ัะฐัะฝะด)?"

#### 3.5.2 ะัะฐะฒะธะปะฐ

| ะัะฐะฒะธะปะพ | ะะฝะฐัะตะฝะธะต |
|---|---|
| **ะะพะณะดะฐ** | ะคะฐะทะฐ `playerAction`, ะฟะพะดัะฐะทะฐ ะะพะดะณะพัะพะฒะบะฐ (ะดะพ ะะฐะฟะตัะฐััะฒะฐะฝะธั) |
| **ะัะพ** | ะขะพะปัะบะพ ะธะณัะพะบ (ะพัะพะทะฝะฐะฝะฝะพะต ะดะตะนััะฒะธะต) |
| **ะงัะพ ะผะพะถะฝะพ ัะฑัะพัะธัั** | ะัะฑะฐั ะบะฐััะฐ ะธะท ััะบะธ, **ะบัะพะผะต** ะบะฐััั ะฒ ะะธััะฐะปัะฝะพะผ ะััะณะต |
| **ะะพะฝัั** | +1 ะทะฐ ะบะฐััั (ะปะธะฝะตะนะฝะพ) |
| **ะัััะบะธะน ะปะธะผะธั** | **Max 2 ะบะฐััั ะทะฐ commit** (default; `HeroDefinition.maxEffort` ะผะพะถะตั ะฟะตัะตะพะฟัะตะดะตะปะธัั) |
| **ะกัะพะธะผะพััั ัะฝะตัะณะธะธ** | ะะตั โ Effort ะฝะต ััะฐัะธั Faith |
| **ะัะดะฐ ััะพะดะธั ะบะฐััะฐ** | `discardPile` (ะฝะต `exhaustPile`; Effort โ "ัะพะทัะณััั") |
| **ะะฐะบัะธะผัะผ** | `min(maxEffort, hand.count - selectedCards.count)` |
| **ะะธะฝะธะผัะผ** | 0 (Effort ะฟะพะปะฝะพัััั ะพะฟัะธะพะฝะฐะปะตะฝ) |
| **ะัะผะตะฝะฐ** | ะะพ ะะฐะฟะตัะฐััะฒะฐะฝะธั โ ะบะฐััั ะผะพะถะฝะพ ะฒะตัะฝััั ะธะท ะะพัััะฐ ะฒ ััะบั |

**Scope ะฟัะธะผะตะฝะธะผะพััะธ Effort:**

| ะขะธะฟ Fate Test | Effort ะฟัะธะผะตะฝัะตััั | ะัะธะผะตัะฐะฝะธะต |
|---|---|---|
| Attack (`commitAttack`) | ะะฐ | ะคะธะทะธัะตัะบะธะน ะฟััั (Kill) |
| Influence (`commitInfluence`) | ะะฐ | ะััะพะฒะฝัะน ะฟััั (Pacify) |
| Defense (ะฐะฒัะพะผะฐัะธัะตัะบะฐั) | ะะตั | ะะณัะพะบ ะฝะต ัะฟัะฐะฒะปัะตั |
| Wait/Skip | ะะตั | ะะตั Fate-ะฟัะพะฒะตัะบะธ |
| Exploration/Investigation | ะะฝะต scope ััะพะณะพ ัะฟะธะบะฐ | ะะฐะฝะพะฝะธัะตัะบะธ ะฟัะตะดััะผะพััะตะฝ, ัะตะฐะปะธะทะฐัะธั ะพัะดะตะปัะฝะพ |

**Exhaust-ะฒะทะฐะธะผะพะดะตะนััะฒะธะต:** ะะฐััะฐ ั `exhaust: true` ะฟัะธ Effort ััะพะดะธั ะฒ `discardPile`, ะฐ ะฝะต ะฒ `exhaustPile`. Exhaust ััะฐะฑะฐััะฒะฐะตั ัะพะปัะบะพ ะฟัะธ "ัะพะทัะณัััะต" (`playCard`), ะฐ Effort โ ััะพ "ัะฑัะพั". Exhaust-ะบะฐััั ะฒัะณะพะดะฝะพ ะถะตัั ัะตัะตะท Effort (ะพะฝะฐ ะฒะตัะฝัััั ะฒ ะบะพะปะพะดั ะฟัะธ ะฟะตัะตัะฐัะพะฒะบะต ะฒะผะตััะพ ัะดะฐะปะตะฝะธั ะฝะฐะฒัะตะณะดะฐ).

#### 3.5.3 ะคะพัะผัะปะฐ (ัััะตััะฒัััะฐั ัะตะฐะปะธะทะฐัะธั ะฒ CombatCalculator)

```
Attack Value    = Hero.Strength + Card.Power + Effort + FateCard.Modifier
Influence Value = Hero.Will     + Card.Power + Effort + FateCard.Modifier
Success: Value >= Difficulty
```

ะะพะด (`CombatCalculator.swift`, ัะถะต ัะฐะฑะพัะฐะตั):
```swift
let effortBonus = max(0, effortCards)
let totalAttack = baseStrength + effortBonus + fateValue + bonusDamage
```

**Gap:** `CombatSimulation` ะฝะต ะฟัะตะดะพััะฐะฒะปัะตั `burnForEffort()`. ะะฐััะธัะตะฝะธะต API โ ยง11.2.

#### 3.5.4 ะะตัะตัะผะธะฝะธะทะผ ะธ Save/Load

- `effortBonus` โ ัะธััะพะต ัะตะปะพะต ัะธัะปะพ, **ะฝะต ะทะฐะดะตะนััะฒัะตั RNG**
- ะกะฑัะพั ะบะฐัั ะดะปั Effort **ะฝะต ะฒะปะธัะตั ะฝะฐ Fate Deck** (Hand Deck ะธ Fate Deck โ ัะฐะทะฝัะต ะบะพะปะพะดั)
- **Replay-ะดะตัะตัะผะธะฝะธะทะผ:** ะฟัะธ ะพะดะธะฝะฐะบะพะฒะพะผ seed + ะพะดะธะฝะฐะบะพะฒัั ะดะตะนััะฒะธัั โ ะธะดะตะฝัะธัะฝัะน ัะตะทัะปััะฐั (Effort ะฝะต ะฒะฒะพะดะธั ะฝะพะฒัั ะธััะพัะฝะธะบะพะฒ ะฝะตะดะตัะตัะผะธะฝะธะทะผะฐ)

**Snapshot-ะบะพะฝััะฐะบั (ะพะฑัะทะฐัะตะปะตะฝ ะดะปั mid-combat save):**

Snapshot `CombatSimulation` ะพะฑัะทะฐะฝ ััะฐะฝะธัั:

| ะะพะปะต | ะขะธะฟ | ะะฐะทะฝะฐัะตะฝะธะต |
|---|---|---|
| `effortCardIds` | `[String]` | ID ัะพะถะถัะฝะฝัั ะบะฐัั (ะดะปั undo ะธ ะฒะธะทัะฐะปะฐ ะะพัััะฐ) |
| `effortBonus` | `Int` | ะขะตะบััะธะน accumulated bonus |
| `selectedCardIds` | `[String]` | ะะฐััั ะฒ ะะธััะฐะปัะฝะพะผ ะััะณะต |
| `phase` | `EchoCombatPhase` | ะขะตะบััะฐั ัะฐะทะฐ ัะฐัะฝะดะฐ |

**Restore-ะบะพะฝััะฐะบั ะดะปั RitualCombatScene (presentation layer):**

`RitualCombatScene` ะพะฑัะทะฐะฝะฐ ะฒะพัััะฐะฝะฐะฒะปะธะฒะฐัั ะฒะธะทัะฐะปัะฝะพะต ัะพััะพัะฝะธะต **ะธะท snapshot**, ะฐ ะฝะต ะธะท runtime state:

- **ะะพัััั:** ะตัะปะธ `effortCardIds.count > 0` โ ะะพัััั ะณะพัะธั, ะััะณ ะฟะพะดัะฒะตัะตะฝ ะฟัะพะฟะพััะธะพะฝะฐะปัะฝะพ `effortBonus`
- **ะะธััะฐะปัะฝัะน ะััะณ:** ะตัะปะธ `selectedCardIds` ะฝะต ะฟััั โ ะบะฐััะฐ ะฒ ะััะณะต, ะะตัะฐัะธ ะฒะธะดะธะผั
- **ะัะบะฐ:** ะพัะพะฑัะฐะถะฐะตั `hand` ะฑะตะท `effortCardIds` ะธ `selectedCardIds`
- **ะะตัะฐัะธ:** ะฒะธะดะธะผะพััั ะฟะพ ัะพััะพัะฝะธั `selectedCardIds` (ะตััั ะบะฐััะฐ ะฒ ะััะณะต โ ะฟะตัะฐัะธ ะฐะบัะธะฒะฝั)
- **ะคะฐะทะฐ:** HUD ะฟะพะบะฐะทัะฒะฐะตั ัะตะบัััั ัะฐะทั ะธะท snapshot

**ะัะฐะฒะธะปะพ:** ะฝะธะบะฐะบะพะณะพ "replay from start" ะดะปั ะฒะพัััะฐะฝะพะฒะปะตะฝะธั UI. Snapshot โ state โ visual. ะะดะธะฝ ะฟััั.

#### 3.5.5 ะะพะฝัะตะฝั-ะฟะพัะปะตะดััะฒะธั ะธ ะฑะฐะปะฐะฝั

**ะญะบะพะฝะพะผะธะบะฐ ะบะพะปะพะดั (ั ะปะธะผะธัะพะผ max 2):**
- ะขะธะฟะธัะฝะฐั ััะบะฐ: 5 ะบะฐัั. ะะฐะบัะธะผะฐะปัะฝัะน Effort = 2 (ะถัััะบะธะน cap)
- +2 ะบ Fate Test โ ะดะพััะฐัะพัะฝะพ ะดะปั "ะฟัะพัะฐะปะบะธะฒะฐะฝะธั" ะผะฐัะณะธะฝะฐะปัะฝะพะน ะฟัะพะฒะตัะบะธ, ะฝะพ ะฝะต ะณะฐัะฐะฝัะธััะตั ััะฟะตั
- ะฆะตะฝะฐ: 2 ะบะฐััั ะธะท ััะบะธ = 3 ะบะฐััั ะฝะฐ ัะปะตะดัััะธะน ัะฐัะฝะด (ะดะพ draw) โ ะทะฐะผะตัะฝะฐั ะฟะพัะตัั, ะฝะพ ะธะณัะฐะฑะตะปัะฝะพ
- ะะตั boom-bust: ะธะณัะพะบ ะฝะต ะผะพะถะตั ะฒะปะพะถะธัั "ะฒัั ะฒ ะพะดะธะฝ ัะดะฐั"

**ะัะธะผะผะตััะธั Kill vs Pacify:**
- Kill-path: +2 ะบ ะพะดะฝะพะผั ัะธะปัะฝะพะผั ัะดะฐัั โ ะทะฐะผะตัะฝัะน HP-ััะพะฝ ("ะฑัะผ-ัะดะฐั")
- Pacify-path: +2 ะบ influence โ ะฟะพะปะตะทะฝะพ, ะฝะพ WP ัะฝะธะผะฐะตััั ัะตัะธะนะฝะพ โ Effort ะฟะพะผะพะณะฐะตั ะผะตะฝััะต

> **โ๏ธ ะกััะฐัะตะณะธัะตัะบะธะน ัะธัะบ (2โ3 ะผะตัััะฐ):** Effort ะพัััะฐะตััั ะบะฐะบ "ะผะตัะฐะฝะธะบะฐ ะดะปั Kill". ะงะตัะตะท 1โ2 ะธัะตัะฐัะธะธ ะบะพะฝัะตะฝัะฐ Pacify-ะฟััั ัะธัะบัะตั ััะฐัั ะผะตะฝะตะต ะฟัะธะฒะปะตะบะฐัะตะปัะฝัะผ. Pacify ััะตะฑัะตั **ัะตะผะฟะฐ**, ะฐ ะฝะต burst. ะะพะผะฟะตะฝัะฐัะธั ัะตัะตะท ะบะพะฝัะตะฝั-ะดะธะทะฐะนะฝ (ะฟะพะดัะพะฑะฝะพ โ ะัะธะปะพะถะตะฝะธะต A.2):
> - ะะพะปััะต draw/recovery ะบะฐัั ะดะปั Pacify-ะณะตัะพะตะฒ
> - Control-ัััะตะบัั (stun/disarm) ะดะปั ะฑะตะทะพะฟะฐัะฝะพะณะพ ะฝะฐะฑะพัะฐ WP-ััะพะฝะฐ
> - Intent windows ั ะฒัะฐะณะพะฒ (intent "prepare/ritual" = ะฑะตะทะพะฟะฐัะฝัะน ัะฐัะฝะด ะดะปั influence)
> - Spirit scaling (WP-ััะพะฝ ะผะฐัััะฐะฑะธััะตััั ะปัััะต ะฟัะธ ะดะปะธะฝะฝัั ัะตัะธัั)
>
> ะญัะพ **ะฝะต ะฑะปะพะบะตั** ัะตะบััะตะณะพ ัะฟะธะบะฐ, ะฝะพ ะพะฑัะทะฐัะตะปัะฝัะน ัะตะบะปะธัั ะฟัะธ ะฟะตัะฒะพะผ ะบะพะฝัะตะฝั-ัะตะฒัั ะฟะพัะปะต ะฒะตััะธะบะฐะปัะฝะพะณะพ ััะตะทะฐ.

**Design space ะดะปั ะฑัะดััะตะณะพ ะผะฐัััะฐะฑะธัะพะฒะฐะฝะธั:**
- `HeroDefinition.maxEffort: Int` (default = 2) ะฟะพะทะฒะพะปัะตั ะณะตัะพัะผ-ัะฟะตัะธะฐะปะธััะฐะผ ะฟะพะฒััะฐัั ะปะธะผะธั
- ะัะธะผะตั: "ะะตััะตัะบ: max effort 4 ะฟัะธ HP < 25%" โ ัะธััะฐัะธะฒะฝะพะต ัะฐััะธัะตะฝะธะต ะฑะตะท ะณะปะพะฑะฐะปัะฝะพะณะพ ะดะธัะฑะฐะปะฐะฝัะฐ
- ะญัะพ **ะฝะต ัะฐััั ัะตะบััะตะณะพ ัะฟะธะบะฐ**, ะฝะพ ะฐััะธัะตะบัััะฝะพ ะฟัะตะดััะผะพััะตะฝะพ

**ะะฐะปะฐะฝัะฝัะต ะพะณัะฐะฝะธัะตะฝะธั ะดะปั ะบะพะฝัะตะฝั-ะดะธะทะฐะนะฝะฐ:**
- Draw-ะบะฐััั ะฝะต ะดะพะปะถะฝั ะดะตะปะฐัั Effort ะฑะตัะฟะปะฐัะฝัะผ (ะตัะปะธ ััะบะฐ ะฟะพััะพัะฝะฝะพ ะฟะพะปะฝะฐั โ Effort ะฑะตะท ัะตะฝั)
- Exhaust-ะบะฐััั ัะตัะตะท Effort ะฒะพะทะฒัะฐัะฐัััั ะฒ ะบะพะปะพะดั โ ััะพ content-aware interaction, ะฝะต ะฑะฐะณ

#### 3.5.6 ะะธะทัะฐะปัะฝะฐั ะฟะพะดะฐัะฐ (ะะพัััั)

- Drag ะบะฐััั ะธะท ััะบะธ ะฒ **ะะพัััั** (ะทะพะฝะฐ ัะฑะพะบั ะพั ะะธััะฐะปัะฝะพะณะพ ะััะณะฐ)
- ะะฐััะฐ ัะณะพัะฐะตั (particles: ะธัะบัั + ะฟะตะฟะตะป), `burnForEffort(cardId)`
- ะะธััะฐะปัะฝัะน ะััะณ ัััะต ั ะบะฐะถะดะพะน ัะพะถะถัะฝะฝะพะน ะบะฐััะพะน (glow intensity โ effortBonus)
- ะะพ ะะฐะฟะตัะฐััะฒะฐะฝะธั: drag ะบะฐััั ะพะฑัะฐัะฝะพ ะธะท ะะพัััะฐ โ `undoBurnForEffort(cardId)`, ะััะณ ัััะบะฝะตะตั

---

## 4. ะัะธะตะฝัะฐัะธั ะธ ะฒะธะทัะฐะปัะฝัะน ะบะพะฝัะตะฟั

### 4.1 ะัะธะตะฝัะฐัะธั: ะะพัััะตัะฝะฐั (Portrait)

ะะตัะตะฝะธะต: ะััะฐะฒะปัะตะผ **ะฒะตััะธะบะฐะปัะฝัั** (390ร700, ะบะฐะบ ัะตะนัะฐั).

ะะฑะพัะฝะพะฒะฐะฝะธะต:
- **ะญััะตัะธะบะฐ ะขะฐัะพ:** ะกะปะฐะฒัะฝัะบะฐั ะผะธัะพะปะพะณะธั ะธ ัะตะผะฐ "ะกัะดัะฑั" ะปะพะถะฐััั ะฝะฐ ัะพัะผะฐั ะฒััะพะบะธั ะบะฐัั
- **ะะพะฑะธะปัะฝัะน ะฟะฐััะตัะฝ:** Narrative RPG, ะธะณัะพะบ "ัะธัะฐะตั" ะธััะพัะธั ะพะดะฝะพะน ััะบะพะน. ะะตัะตะฒะพัะฐัะธะฒะฐัั ัะตะปะตัะพะฝ โ friction
- **ะฃะฝะธะบะฐะปัะฝะพััั:** ะะพะปััะธะฝััะฒะพ ะะะ ะณะพัะธะทะพะฝัะฐะปัะฝัะต. ะะตััะธะบะฐะปั ะฒัะดะตะปัะตั (ะบะฐะบ Marvel Snap, Solitairica)

> **Scope constraint:** ะัะธะตะฝัะฐัะธั (Portrait) ะฝะต ะผะตะฝัะตััั ะฒ ัะฐะผะบะฐั ััะพะณะพ ัะฟะธะบะฐ. Landscape-ัะตะถะธะผ ะฝะต ัะฐััะผะฐััะธะฒะฐะตััั.

### 4.2 ะะธะทัะฐะปัะฝัะน ะบะพะฝัะตะฟั: "ะกัะพะป ะะพะปัะฒะฐ"

**ะกัะธะปั: Grim Slavic Noir (ะัะฐัะฝัะน ะกะปะฐะฒัะฝัะบะธะน ะัะฐั)**
ะะตัะตัะตะฝัั: Inscryption (ะฐัะผะพััะตัะฐ), Gwent (ะฐัั ะบะฐัั), Black Book (ะบะพะปะพัะธั).

ะะณัะพะบ ัะผะพััะธั ัะฒะตััั ะฝะฐ ัะธััะฐะปัะฝัะน ััะพะป. ะะต "ัะบัะฐะฝ ะฑะพั", ะฐ ัะธะทะธัะตัะบะพะต ะฟัะพัััะฐะฝััะฒะพ ั ะผะฐัะตัะธะฐะปะฐะผะธ ะธ ัะฒะตัะพะผ.

### 4.3 ะะฐัะตัะธะฐะปั ะธ ัะฐะบัััั

- **ะกัะพะป/ะดะพัะบะฐ:** ััะผะฝะพะต ะดะตัะตะฒะพ, ะฟัะพะถะถัะฝะฝัะต ะบัะฐั, ัะปะตะดั ะฝะพะถะฐ, ัะผะพะปะฐ. ะัะฝั ะฝะฐ ััะพะปะต ัะฒะตััััั ัััะบะปัะผ ัะฒะตัะพะผ, ัะฒะตั ะทะฐะฒะธัะธั ะพั ัะตะทะพะฝะฐะฝัะฐ
- **ะะฐััั:** ะฑะตัะตััะฐ/ะฟะปะพัะฝะฐั ะฑัะผะฐะณะฐ ั ะฒะพััะพะผ, ะฝะตัะพะฒะฝัะต ะบัะฐั, "ะฟะตัะฐัะธ" ะฒะพัะบะพะผ
- **UI-ัะฐะผะบะธ:** ัะตะทัะฑะฐ/ะพะฑะตัะตะณะธ/ัะทะพัั (ะฝะต ััะบะฐั ะฒััะธะฒะบะฐ, ะฐ "ะฒัะตะทะฐะฝะฝัะต" ะผะพัะธะฒั)
- **ะัะฒะตัะตะฝะธะต:** ะฒะธะฝัะตัะบะฐ ะฟะพ ะบัะฐัะผ (ัะตะผะฝะพัะฐ). ะััะพัะฝะธะบ ัะฒะตัะฐ โ ะบะฐะบ ะพั ัะฒะตัะธ ะธะปะธ ะปััะธะฝั (ััะฟะปัะน, ะผะตััะฐััะธะน, ะดะปะธะฝะฝัะต ัะตะฝะธ ะพั ะบะฐัั)

---

## 5. ะัะพัััะฐะฝััะฒะตะฝะฝัะน layout ััะพะปะฐ

### 5.1 ะะพะฝั ััะตะฝั

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ          ะะะะ ะะะะะะ (Y โ 250)          โ
โ                                         โ
โ    โโโโโโโโ   โโโโโโโโ   โโโโโโโโ      โ
โ    โะะดะพะป 1โ   โะะดะพะป 2โ   โะะดะพะป 3โ      โ
โ    โโโโฌโโโโ   โโโโฌโโโโ   โโโโฌโโโโ      โ
โ       โIntent    โIntent    โIntent     โ
โ                                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ       ะะะขะฃะะะฌะะะฏ ะะะะ (Y โ 50..120)     โ
โ                                         โ
โ  โ       ๐ฅ    โโโโโโโโโโโโโ    ๐ฌ      โ
โ ะฃะดะฐั   ะะพัััั  โ   ะะะฃะ    โ   ะกะปะพะฒะพ   โ
โ(ัะบััั) Effort  โ  (ะบะฐััั)  โ  (ัะบััั)  โ
โ                โโโโโโโโโโโโโ            โ
โ                    โณ                    โ
โ                  ะัะถะดะฐัั                 โ
โ                  (ัะบััั)                 โ
โ                                         โ
โ  ะะตัะฐัะธ ะฟะพัะฒะปััััั ะบะพะณะดะฐ ะบะฐััะฐ ะฒ ะบััะณะต  โ
โ  Fate Deck ๐ โ ัะฟัะฐะฒะฐ ะพั ะบััะณะฐ         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ         ะะะคะ-ะะะะะะฌ (Y โ -60)           โ
โ                                         โ
โ    โฅ HP      โก Faith      โฏ Res        โ
โ           ะะฐัะฝะด ยท ะคะฐะทะฐ                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                         โ
โ         (ัะฒะพะฑะพะดะฝะฐั ะทะพะฝะฐ ะดะปั drag)        โ
โ                                         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ        ะะฃะะ ะะะะข (Y โ -250)             โ
โ                                         โ
โ    โโโโโ โโโโโ โโโโโ โโโโโ โโโโโ      โ
โ    โ   โ โ   โ โ   โ โ   โ โ   โ      โ
โ    โโโโโ โโโโโ โโโโโ โโโโโ โโโโโ      โ
โ              ะฒะตะตั, "ะดััะฐั"              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**UX-ัะตัะตะฝะธะต:** ะขะพัะตะผั ะฟะตัะฐัะตะน ัะฐัะฟะพะปะพะถะตะฝั **ะฟะพ ะฑะพะบะฐะผ ะพั ะะธััะฐะปัะฝะพะณะพ ะััะณะฐ** (ะฝะฐ ััะพะฒะฝะต Y โ 80), ะฐ ะฝะต ะฟะพะด ะฝะธะผ. ะญัะพ ะทะฐัะธัะฐะตั ะพั miss-click ะฟัะธ drag ะบะฐัั ะธะท ััะบะธ ะฒะฒะตัั.

**ะะพะฝัะตะบััะฝัะต ะฟะตัะฐัะธ (ะะฐัะธะฐะฝั ะ):**
- ะะตัะฐัะธ ัะบัััั/ะฝะตะฐะบัะธะฒะฝั, ะฟะพะบะฐ ะบะฐััะฐ ะฝะต ะฒ ะััะณะต
- ะะฐััะฐ ะฒ ะััะณะต โ ะฟะตัะฐัะธ "ะฒัะฟะปัะฒะฐัั" ั ะฐะฝะธะผะฐัะธะตะน (fade in + scale pulse)
- ะคะพะบััะธััะตั ะฒะฝะธะผะฐะฝะธะต: ัะฝะฐัะฐะปะฐ "ะงัะพ ั ะดะตะปะฐั" (ะะฐััะฐ), ะฟะพัะพะผ "ะะฐะบ ั ััะพ ะฟัะธะผะตะฝัั" (ะะตัะฐัั)

### 5.2 ะกะปะพะธ ััะตะฝั (zPosition)

| zPosition | ะกะปะพะน | ะกะพะดะตัะถะธะผะพะต |
|---|---|---|
| -10 | ะคะพะฝะพะฒะฐั ัะตะบััััะฐ | ะขัะผะฝะพะต ะดะตัะตะฒะพ, ััะฝั. ะะต ะณัะฐะดะธะตะฝั |
| -5 | ะัะผะพััะตัะฝัะน ัะปะพะน | SKEmitterNode: ะฟัะปั / ัะณะพะปัะบะธ / ัะฝะตะณ. ะขัะผะฐะฝ ะฟะพ ะฝะธะทั |
| 0 | ะะธะฝัะตัะบะฐ | ะขะตะผะฝะพัะฐ ะฟะพ ะบัะฐัะผ. ะะฝัะตะฝัะธะฒะฝะพััั ะทะฐะฒะธัะธั ะพั ัะตะทะพะฝะฐะฝัะฐ |
| 5 | ะะฑัะตะบัั ััะพะปะฐ | ะะดะพะปั, ะััะณ, ะะพัััั, ะขะพัะตะผั ะฟะตัะฐัะตะน |
| 10 | ะะฐััั ะฒ ััะบะต | ะะตะตั, "ะดััะฐั", ะพัะฑัะฐััะฒะฐัั ัะตะฝั |
| 15 | Drag-ัะปะพะน | ะะตัะตัะฐัะบะธะฒะฐะตะผะฐั ะบะฐััะฐ/ัะพัะตะผ, ัะฒะตะปะธัะตะฝะฐ, ั ัะตะฝัั |
| 20 | HUD | HP-ะฐะผัะปะตั, Faith-ะบะฐะผะตะฝั, Fate-ัััััะธะบ |
| 50 | Fate Reveal | ะะฐััะฐ ะกัะดัะฑั: flip, keyword, match |
| 90 | Overlays | Combat Over, Mulligan, Tooltips |

### 5.3 ะัะฒะตัะตะฝะธะต

- **SKLightNode** ะฒ ัะตะฝััะต ััะพะปะฐ โ ะธะผะธัะฐัะธั ัะฒะตัะธ/ะปััะธะฝั
- `falloff` ะผะตััะฐะตั (ัะธะฝััะพะธะดะฐ, 0.3Hz) โ ัะฒะตั "ะดััะธั"
- ะะฐััั ะธ ะธะดะพะปั ะธะผะตัั `shadowCastBitMask` โ ะดะปะธะฝะฝัะต ัะตะฝะธ ะฝะฐ ััะพะปะต
- ะฆะฒะตั ัะฒะตัะฐ ะทะฐะฒะธัะธั ะพั ัะตะทะพะฝะฐะฝัะฐ:
  - ะะฐะฒั: ัะพะปะพะดะฝัะน ัะธะพะปะตัะพะฒัะน (0.6, 0.4, 0.9)
  - ะัะฐะฒั: ัะธัััะน ะทะพะปะพัะพะน (0.9, 0.8, 0.3)
  - ะฏะฒั: ััะฟะปัะน ัะฝัะฐัะฝัะน (0.8, 0.6, 0.3)

---

## 6. ะัะฐะณะธ โ ะะดะพะปั ะฝะฐ ััะพะปะต

### 6.1 ะะพะฝัะตะฟั

ะัะฐะณะธ โ ะฝะต UI-ัะปะตะผะตะฝัั, ะฐ **ัะธะทะธัะตัะบะธะต ะพะฑัะตะบัั** ะฝะฐ ัะธััะฐะปัะฝะพะผ ััะพะปะต. ะััะตะทะฐะฝะฝัะต ะธะท ะดะตัะตะฒะฐ/ะบะพััะธ/ะบะฐะผะฝั ะฟะปะฐััะธะฝั-ะธะดะพะปั.

### 6.2 ะะฐะบะตั ะธะดะพะปะฐ (70ร100, ะฒะตััะธะบะฐะปัะฝัะน)

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ๐บ ะะพะปะบะพะปะฐะบ                       โ โ ะะผั + ัะพัะตะผ-ะธะบะพะฝะบะฐ ัะธะฟะฐ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ   (ะทะฒะตัั/ะดัั/ะฝะตะถะธัั/ัะตะปะพะฒะตะบ)
โ โ                              โ   โ
โ โ   โ โ โ โ โ  โ WP: ััะฝั    โ   โ โ WP: ะัะฝะฝะฐั ัะตะฟั
โ โ                              โ   โ   ะกะฒะตัััะธะตัั ัะธะผะฒะพะปั,
โ โ    [ ะณัะฐะฒััะฐ-ัะธะปััั ]        โ   โ   ะณะฐัะฝัั ะฟัะธ WP-ััะพะฝะต
โ โ    ( shader: threshold +     โ   โ
โ โ      noise + edge detect )   โ   โ โ ะฆะตะฝััะฐะปัะฝัะน ะฐัั
โ โ                              โ   โ   (ะฟัะพะณัะฐะผะผะฝัะน woodcut shader)
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                    โ
โ  โโโโโโโโโโ  โ HP: ะฝะฐัะตัะบะธ        โ โ HP: ะะฐัะตัะบะธ ะฝะฐ ะบะฐะผะฝะต
โ  (ะทะฐะฟะพะปะฝััััั ะบัะพะฒัั/ัะตัะฝะพัะพะน)     โ   ะะฐะฟะพะปะฝััััั ะฟัะธ ััะพะฝะต
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
         โโโโโโโโโโโ
         โ โ ะัะฐะบะฐ โ โ Intent-ัะพะบะตะฝ
         โ    6    โ    "ะฒะฑะธะฒะฐะตััั" ัะฒะตััั
         โโโโโโโโโโโ    ะบะฐะถะดัะน ัะฐัะฝะด
```

### 6.3 ะะธะตะณะตัะธัะตัะบะธะน UI (HP/WP ะฑะตะท ะฟัะพะณัะตัั-ะฑะฐัะพะฒ)

**HP (ะขะตะปะพ) โ ะะฐัะตัะบะธ (Notches):**
- ะััะตะทะฐะฝะฝัะต ะฝะฐ ะดะตัะตะฒะต/ะบะฐะผะฝะต ัะตััะพัะบะธ ะฒะฝะธะทั ะธะดะพะปะฐ
- ะัะธ ััะพะฝะต ะฝะฐัะตัะบะธ ะทะฐะฟะพะปะฝััััั ะบัะพะฒัั/ัะตัะฝะพัะพะน (shader fill)
- ะัะธ ะบัะธัะธัะตัะบะพะผ ััะพะฝะต โ ัะบะฐะปัะฒะฐัััั (path deformation)

**WP (ะะพะปั) โ ะัะฝะฝะฐั ัะตะฟั:**
- ะฆะตะฟะพัะบะฐ ัะฒะตัััะธััั ัะธะผะฒะพะปะพะฒ ะฝะฐะด ะฟะพัััะตัะพะผ
- ะัะธ ััะพะฝะต ะฟะพ ะฒะพะปะต ัะธะผะฒะพะปั ะณะฐัะฝัั ะฟะพ ะพะดะฝะพะน (fade out + ะผะธะฝะธ-ะฒัะฟััะบะฐ)
- ะะพัะปะตะดะฝัั ััะฝะฐ ะณะฐัะฝะตั ะผะตะดะปะตะฝะฝะตะต (ะดัะฐะผะฐ)

### 6.4 ะะธะทัะฐะปัะฝัะต ัะพััะพัะฝะธั ะธะดะพะปะฐ

| ะกะพััะพัะฝะธะต | ะะธะทัะฐะป |
|---|---|
| Idle | ะัะณะบะพะต "ะดััะฐะฝะธะต" (scale 1.0โ1.01, 2s ัะธะบะป) |
| Intent shown | ะขะพะบะตะฝ "ะฒะฑะธะฒะฐะตััั" ัะฒะตััั (drop + bounce, 200ms), ะทะฒัะบ |
| ะะพะปััะฐะตั HP-ััะพะฝ | ะขััััััั, ะบัะฐัะฝัะต ะฝะฐัะตัะบะธ ะทะฐะฟะพะปะฝััััั, ัะตะฟะบะธ-ะฟะฐััะธะบะปั |
| ะะพะปััะฐะตั WP-ััะพะฝ | ะัะฝะฐ ะณะฐัะฝะตั, ัะธะฝะตะต ัะฒะตัะตะฝะธะต ะฟัะปััะธััะตั, "ะดัั" ะพััะปะฐะธะฒะฐะตััั |
| HP = 0 (Kill) | ะะฐัะบะฐะปัะฒะฐะตััั: ััะตัะธะฝะฐ ะฟะพ ัะตะฝััั, ะฟะพะปะพะฒะธะฝะบะธ ัะฐะทะปะตัะฐัััั, ะดัะผ |
| WP = 0 (Pacify) | ะกะฒะตัะตะฝะธะต ะณะฐัะฝะตั ะผัะณะบะพ, ะธะดะพะป "ัะบะปะพะฝัะตััั" (rotation), ัะธัะธะฝะฐ |
| ะฆะตะปั drag-hover | ะะพะฝััั ะฟะพะดัะฒะตัะธะฒะฐะตััั (outline glow), "ะผะฐะณะธัะตัะบะฐั ะฝะธัั" ะพั ะบะฐััั |
| Anticipation (โ hover) | ะะถะธะผะฐะตััั (scaleY 0.95), HP-ะฝะฐัะตัะบะธ ะฟัะปััะธัััั ะบัะฐัะฝัะผ |
| Anticipation (๐ฌ hover) | "ะัะธัะปััะธะฒะฐะตััั" (scaleX 1.05), WP-ััะฝั ััะธะปะธะฒะฐัั ัะฒะตัะตะฝะธะต |

### 6.5 Kill vs Pacify โ ัะฐะทะฝะพะต ะพัััะตะฝะธะต

| | Kill (HP โ 0) | Pacify (WP โ 0) |
|---|---|---|
| ะะฒัะบ | ะฃะดะฐั, ััะตัะบ ะดะตัะตะฒะฐ | ะัะดะพั, ัะณะฐัะฐะฝะธะต |
| ะงะฐััะธัั | ะฉะตะฟะบะธ, ะธัะบัั | ะัะณะบะพะต ัะฒะตัะตะฝะธะต ัะฐััะตะธะฒะฐะตััั |
| ะะฐะผะตัะฐ | Screen shake (intensity 8) | ะะตั shake, ะปัะณะบะธะน zoom-out |
| ะะดะพะป | ะะฐัะบะฐะปัะฒะฐะตััั, ัะฐะทะปะตัะฐะตััั | ะกะบะปะพะฝัะตััั, ะทะฐัะธัะฐะตั |
| Haptic | `.heavy` | `.medium` + ะฟะฐัะทะฐ + `.light` |
| ะฆะฒะตั ะฒัะฟััะบะธ | ะัะฐัะฝัะน | ะะพะปัะฑะพะน โ ะฑะตะปัะน |
| ะะพัะปะตะดะตะนััะฒะธะต | ะะฑะปะพะผะบะธ ะฝะฐ ััะพะปะต (ะทะฐัััะฐัั) | ะะธะผะฑ/ััะฝะฐ ะพััะฐัััั (ะทะฐัััะฐะตั) |

### 6.6 Shader: SF Symbol ะบะฐะบ ะณัะฐะฒััะฐ (Woodcut Pipeline)

ะะปั ะฟัะพะณัะฐะผะผะฝะพะน ะณะตะฝะตัะฐัะธะธ ะฐััะฐ ะฒัะฐะณะพะฒ ะธะท SF Symbols:

1. **Threshold (ะะพัะพะณ):** ะะพะปััะพะฝะฐ SF Symbol โ ะถัััะบะธะน ั/ะฑ
2. **Noise Overlay:** ะขะตะบััััะฐ "ััะผะฐ ะฑัะผะฐะณะธ" (Multiply)
3. **Edge Detection:** ะัะณะบะธะน ะบะพะฝััั, ะธะผะธัะฐัะธั ะพััะธัะบะฐ ัะตัะฝะธะป
4. **Colorize:** ะงััะฝะพะต โ "ััะผะฝะพ-ะฑัััะน" (ัะตัะฝะธะปะฐ), ะฑะตะปะพะต โ alpha (ะฟัะพะทัะฐัะฝะพััั), ะฒะธะดะฝะฐ ัะตะบััััะฐ ะดะตัะตะฒะฐ

### 6.7 Multi-enemy (1vN)

- ะะพ 3 ะธะดะพะปะพะฒ ะฒ ััะด (70ร100 ะบะฐะถะดัะน, spacing 15)
- ะัะธ drag ะฝะฐ ะบะพะฝะบัะตัะฝะพะณะพ ะฒัะฐะณะฐ โ ะพััะฐะปัะฝัะต ะทะฐัะตะผะฝััััั
- Intent-ัะพะบะตะฝั ั ะบะฐะถะดะพะณะพ ัะฒะพะธ, staggered ะฝะฐ 100ms

---

## 7. ะะฐััั โ Drag & Drop ั ัะธะทะธะบะพะน

### 7.1 ะัะธะฝัะธะฟ

ะะฐััั โ ัะธะทะธัะตัะบะธะต ะพะฑัะตะบัั ะฝะฐ ััะพะปะต. ะะตัะตััะฐ, ะฝะตัะพะฒะฝัะต ะบัะฐั, ะฒะพัะบ. ะะฝะธ ะฝะต "ะฒัะฑะธัะฐัััั ะบะปะธะบะพะผ", ะฐ **ะฟะพะดะฝะธะผะฐัััั, ะฝะตััััั ะธ ะฑัะพัะฐัััั**.

### 7.2 ะะธะทะฝะตะฝะฝัะน ัะธะบะป ะบะฐััั ะฒ ััะบะต

```
IDLE (ะฒ ะฒะตะตัะต)
  โ  ะะฐััะฐ ะฟะพะบะฐัะธะฒะฐะตััั (rotation ยฑ1ยฐ, 3s ัะธะบะป)
  โ  ะขะตะฝั ะฝะฐ ััะพะปะต (lightingBitMask)
  โ
  โผ touch began
LIFT (ะฟะพะดะฝััะฐ)
  โ  Scale 1.0 โ 1.3 (150ms, easeOut)
  โ  zPosition โ 15
  โ  Haptic: .light
  โ  ะััะฐะปัะฝัะต ะบะฐััั ัะฐะทะดะฒะธะณะฐัััั
  โ
  โผ touch moved (> 5px)
DRAG (ัะปะตะดัะตั ะทะฐ ะฟะฐะปััะตะผ)
  โ  ะะพะทะธัะธั = ะฟะฐะปะตั + offset
  โ  ะขะตะฝั ัะดะปะธะฝัะตััั
  โ  ะะฐะปะธะดะฝัะต ะทะพะฝั ะฟะพะดัะฒะตัะธะฒะฐัััั:
  โ    ะััะณ: glow + scale pulse
  โ    ะะพัััั: ะพะณะพะฝั ัะฐะทะณะพัะฐะตััั
  โ    ะัะฐะณ: outline + targeting arrow
  โ
  โผ touch ended
DROP โ ััะธ ะธััะพะดะฐ:
  โ
  โโโบ ะะะ ะะะขะฃะะะฌะะซะ ะะะฃะะะ
  โ   Snap ะฒ ะบััะณ (spring, 200ms)
  โ   โ selectCard(cardId)
  โ   Haptic: .medium
  โ   ะััะณ ัะฐะทะณะพัะฐะตััั, ะฟะตัะฐัะธ ะฟะพัะฒะปััััั
  โ
  โโโบ ะะะ ะะะกะขะะะ (Effort)
  โ   ะกะถะธะผะฐะตััั ะธ ัะณะพัะฐะตั (scale โ 0 + particles)
  โ   โ burnForEffort(cardId)
  โ   Haptic: .medium
  โ   ะััะณ ัััะต, effort-counter++
  โ
  โโโบ ะะะ ะะะะะะะะ ะะะะซ (ะพัะผะตะฝะฐ)
      ะะพะทะฒัะฐัะฐะตััั ะฒ ััะบั (spring, 300ms)
      ะัะณะบะธะน "ะพััะบะพะบ" ะฟัะธ ะฟัะธะทะตะผะปะตะฝะธะธ
```

### 7.3 Gesture Priority (ัะตัััะตะฑะพะฒะฐะฝะธะต)

```
Touch Down โ ะทะฐะฟััะบะฐะตั ะดะฒะฐ ัะฐะนะผะตัะฐ ะฟะฐัะฐะปะปะตะปัะฝะพ:

  โโ Movement detector: ะตัะปะธ dxยฒ + dyยฒ > 25 (5px)
  โ  โ ะะขะะะะะขะฌ tooltip ัะฐะนะผะตั
  โ  โ ะะะงะะขะฌ drag (LIFT state)
  โ
  โโ Tooltip timer: 400ms ะฑะตะท ะดะฒะธะถะตะฝะธั
     โ ะะะะะะะขะฌ tooltip
     โ Drag ะทะฐะฑะปะพะบะธัะพะฒะฐะฝ ะดะพ dismiss

ะัะฐะฒะธะปะพ: Drag ะะกะะะะ ะฟะพะฑะตะถะดะฐะตั Tooltip.
ะัะปะธ ะฟะฐะปะตั ัะดะฒะธะฝัะปัั ัะพัั ะฝะฐ 5px โ ััะพ drag, ะฝะต tooltip.
```

### 7.4 ะัะบะฐ ะบะฐัั โ Arc Layout (ะฒะตะตั)

```
     โโโโโ
    โโค   โโ
   โโคโ   โโโ
  โโคโโ   โโโโ
  โโโโ   โโโโ  โ 5 ะบะฐัั
  โโคโโ   โโโโ    rotation: ยฑ8ยฐ ะพั ัะตะฝััะฐ
   โโคโ   โโโ     overlap: 40% ัะธัะธะฝั
    โโค   โโ      idle: "ะดััะฐั" (staggered)
     โโโโโ
```

- ะฆะตะฝััะฐะปัะฝะฐั ะบะฐััะฐ: rotation 0ยฐ, ัะฐะผะฐั ะฒััะพะบะฐั
- ะัะฐะนะฝะธะต: rotation ยฑ8ยฐ, y offset -5...-10
- Overlap ~40%: ะบะฐััั ะฟะตัะตะบััะฒะฐัััั
- ะัะธ >5 ะบะฐัั: spacing ัะผะตะฝััะฐะตััั
- ะัะธ >7 ะบะฐัั: scale 0.85
- ะะตะธะณัะพะฒัะต (ะฝะต ัะฒะฐัะฐะตั ัะฝะตัะณะธะธ): dimmed (alpha 0.4), ะฟัะธ drag โ ะดััะณะฐะตััั ะฝะพ ะฝะต ะฟะพะดะฝะธะผะฐะตััั, haptic `.error`

### 7.5 Targeting Arrow (ะผะฐะณะธัะตัะบะฐั ะฝะธัั)

- 8-12 SKShapeNode-ัะพัะตะบ, curved path ะพั ะบะฐััั ะบ ะฒัะฐะณั
- ะฆะฒะตั: ะบัะฐัะฝัะน (โ) ะธะปะธ ะณะพะปัะฑะพะน (๐ฌ)
- ะขะพัะบะธ ะฟัะปััะธัััั (alpha wave, 0.5s ัะธะบะป)
- "ะะธะฒะฐั ะฝะธัั" โ control points ัะปะตะณะบะฐ ัะตะฒะตะปัััั

### 7.6 ะะธะทัะฐะป ะบะฐััั (RitualCardNode, 100ร140)

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ โ 2                     โ      โ โ ะกัะพะธะผะพััั (ะฒะพัะบ-ะฟะตัะฐัั)
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ    + ัะธะฟ (ััะฝะฐ ะฒ ัะณะปั)
โ โ                           โ   โ
โ โ   [ ะฐัั / ะณัะฐะฒััะฐ ]       โ   โ โ ะะปะปััััะฐัะธั
โ โ   ( woodcut shader )      โ   โ    (ะฟัะพะณัะฐะผะผะฝัะน shader)
โ โ                           โ   โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โ
โ                                 โ
โ   ะฃะดะฐั ะะตะดะฒะตะดั                  โ โ ะะฐะทะฒะฐะฝะธะต
โ                                 โ
โ   ะะฐะฝะพัะธั 4 ััะพะฝะฐ.              โ โ ะะฟะธัะฐะฝะธะต (1-2 ัััะพะบะธ)
โ                                 โ
โ   ๐  โก                        โ โ ะะปะตะนะผะฐ (ะฒัะถะถะตะฝะฝัะต ะธะบะพะฝะบะธ)
โ  (ะััะพั.) (ะัััััะน)             โ    Tooltip ัะฐัะบััะฒะฐะตั
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  ะะฐัะตัะธะฐะป: "ะฑะตัะตััะฐ" (noise texture bg)
  ะัะฐั: ะฝะตัะพะฒะฝัะต (path ั jitter)
  ะขะตะฝั: ะดะธะฝะฐะผะธัะตัะบะฐั ะพั SKLightNode
```

**Keywords ะบะฐะบ ะฒัะถะถะตะฝะฝัะต ะบะปะตะนะผะฐ (ะฝะต ัะตะบัั):**

| ะะปะตะนะผะพ | ะะฝะฐัะตะฝะธะต |
|---|---|
| ๐ | ะััะพัะตะฝะธะต (Exhaust) |
| โก | ะัััััะน (Swift) |
| ๐ก | ะกัะพะนะบะพััั (Retain) |
| ๐ฅ | ะฃัะพะฝ (Damage type) |
| โฆ | ะััะพะฒะฝัะน (Spirit type) |
| ๐ | ะะตะทะพะฝะฐะฝั (Resonance shift) |

ะะธะทัะฐะปัะฝะพ: ะบััะณะปัะต "ะฒัะถะถะตะฝะฝัะต" ะพัะผะตัะบะธ, monochrome, 16ร16. Long-press โ ัะตะบััะพะฒะฐั ัะฐััะธััะพะฒะบะฐ.

---

## 8. Fate Moment โ ะณะปะฐะฒะฝะพะต ัะพะฑััะธะต ัะฐัะฝะดะฐ

### 8.1 Dynamic Tempo (ะบัะธัะธัะฝะพ ะดะปั UX)

| ะขะธะฟ ะดะตะนััะฒะธั | ะฅัะพะฝะพะผะตััะฐะถ | ะะธะทัะฐะป |
|---|---|---|
| **Major** (Attack/Influence ะฟะพ ะฒัะฐะณั) | 2.5s ะฟะพะปะฝะฐั | ะะฐัะตะผะฝะตะฝะธะต, ะณัะป, ะฟะพะปะฝัะน flip, keyword |
| **Minor** (Heal/Buff/Draw/Block) | 1.0s | ะะตะท ะทะฐัะตะผะฝะตะฝะธั, ะฑัััััะน flip (150ms), ัะธัะธะน ะทะฒัะบ |
| **Wait** | 0.6s | ะะตะท Fate-ะบะฐััั ะฒะพะพะฑัะต, ัะฒะตัะฐ ัะพะฒะฝะตะต, ะฒัะดะพั |

ะะฟัะตะดะตะปะตะฝะธะต ะฐะฒัะพะผะฐัะธัะตัะบะพะต: ะตัะปะธ `FateResolution` ะทะฐะดะตะนััะฒะพะฒะฐะฝ (ะฐัะฐะบะฐ/ะฒะปะธัะฝะธะต ะฟะพ ะฒัะฐะณั) โ Major. ะัะปะธ ะบะฐััะฐ only self-target โ Minor. `skipTurn()` โ Wait.

### 8.2 Major Fate Reveal โ ะฟะพะปะฝะฐั ะฐะฝะธะผะฐัะธั (2.5s)

```
0ms     ะะตัะฐัั ัะดะฐััะตั ะฟะพ ะธะดะพะปั.
        Screen shake (intensity 4). Haptic .heavy.
        ะัะต ะบะฐััั ะฒ ะบััะณะต ะฒัะฟััะธะฒะฐัั ะธ ะธััะตะทะฐัั.

200ms   ะะะขะะะะะะะ: ะฒะธะฝัะตัะบะฐ ััะธะปะธะฒะฐะตััั,
        ััะพะป ัะตะผะฝะตะตั (overlay alpha 0โ0.4).
        ะะฒัะบ: ะฝะธะทะบะธะน ะณัะป ะฝะฐัะฐััะฐะตั.

400ms   ะะะะขะ ะกะฃะะฌะะซ ะฟะพัะฒะปัะตััั ะฒ ัะตะฝััะต.
        ะัะฑะฐัะบะพะน ะฒะฒะตัั. Scale 0โ1.1โ1.0 (bounce).
        ะัะฑะฐัะบะฐ: ััะผะฝะฐั, ััะฝะฐ "?" ะฟะพ ัะตะฝััั.
        ะกัะธะปั: "ะขะฐัะพ" โ ะฒะตััะธะบะฐะปัะฝะฐั, 80ร120.

800ms   ะะะะะะะะะข: 3D flip (xScale 1โ0โ1, 300ms).
        ะัะฑะฐัะบะฐ ะบะพะปะปะฐะฟัะธััะตั โ ะปะธัะพ ัะฐัะบััะฒะฐะตััั.
        ะะฒัะบ: ัััะพะน ัะตะปัะพะบ / ัะตะปะตัั ะฟะตัะณะฐะผะตะฝัะฐ.

1100ms  ะะะะงะะะะ: ัะธัะปะพ ะฟัะพัะฒะปัะตััั.
        "+3" / "-1" / "ะะะะข" (36pt).
        ะฆะฒะตั: ะทะตะปัะฝัะน / ะบัะฐัะฝัะน / ะทะพะปะพัะพะน.
        Scale punch: 0.5โ1.2โ1.0 (200ms).

1300ms  KEYWORD (ะตัะปะธ ะตััั): ัะตะบัั ะฟะพะด ัะธัะปะพะผ.
        "ะะฐัะธัะบ" / "ะขะตะฝั" / "ะะฟะปะพั".
        Fade in 150ms. ะฆะฒะตั ะฟะพ ัะธะฟั.

1500ms  SUIT MATCH (ะตัะปะธ ัะพะฒะฟะฐะดะตะฝะธะต ะผะฐััะธ):
        ะัะฟััะบะฐ ะฟะพ ะบะพะฝัััั ะบะฐััั.
        ะัะฝะฐ ะผะฐััะธ ะฟัะปััะธััะตั 2 ัะฐะทะฐ. ะะฒะพะฝ.
        ะขะตะบัั "ะกะพะฒะฟะฐะดะตะฝะธะต!" fade in.

2000ms  ะะะะะะะะะะ: ััะพะฝ/ัััะตะบั ะปะตัะธั ะบ ัะตะปะธ.
        ะะฐััะฐ ะกัะดัะฑั fade out (300ms).
        ะะธะฝัะตัะบะฐ ะบ ะฝะพัะผะต. Damage number.

2500ms  ะะตัะตัะพะด ะบ ะฟะพัะปะตะดััะฒะธัะผ.
```

### 8.3 3D Flip ั ัะตะฝัั (ัะตัััะตะฑะพะฒะฐะฝะธะต)

ะะปั ะพะฑััะผะฝะพััะธ ะฟัะธ ะฟะตัะตะฒะพัะพัะต:

```
xScale 1.0 โ 0.05: ััะฑะฐัะบะฐ ะบะพะปะปะฐะฟัะธััะตั
  colorBlendFactor: 0 โ 0.3 (ะทะฐัะตะผะฝะตะฝะธะต ะบ ัะตะฑัั)

xScale 0.05: swap texture (ััะฑะฐัะบะฐ โ ะปะธัะพ)

xScale 0.05 โ 1.0: ะปะธัะพ ัะฐัะบััะฒะฐะตััั
  colorBlendFactor: 0.3 โ 0 (ัะฒะตั ะฒะพะทะฒัะฐัะฐะตััั)
```

### 8.4 Keyword-ัััะตะบัั โ ะฒะธะทัะฐะปัะฝัะน ะถะตัั

| Keyword | ะะธะทัะฐะป | ะะฒัะบ |
|---|---|---|
| Surge (ะะฐัะธัะบ) | ะฃะดะฐัะฝะฐั ะฒะพะปะฝะฐ ะพั ะบะฐััั, ััะพะป ัััััััั | ะะตะทะบะธะน ะฟะพััะฒ ะฒะตััะฐ |
| Shadow (ะขะตะฝั) | ะขะตะผะฝะพัะฐ ัะฐัะฟะพะปะทะฐะตััั, ะฒะธะฝัะตัะบะฐ ะผะฐะบัะธะผัะผ | ะจัะฟะพั |
| Ward (ะะฟะปะพั) | ะัะฝะฐ-ัะธั ะฒัะฟััะธะฒะฐะตั ะฟะตัะตะด ะณะตัะพะตะผ | ะกััะพะน ะทะฒะพะฝ ะผะตัะฐะปะปะฐ |
| Focus (ะคะพะบัั) | ะััะธ ััะพะดัััั ะบ ัะตะฝััั ะบะฐััั | ะขะธัะธะน ะฐะบะบะพัะด |
| Echo (ะญัะพ) | ะะฐััะฐ ะดะฒะพะธััั (ghost copy ะฟัะปััะธััะตั) | ะญัะพ-ัะตะฒะตัะฑ |

> **Scope constraint:** Keyword-ัััะตะบัั ะฒะธะทัะฐะปะธะทะธัััั **ัััะพะณะพ ะบะฐะฝะพะฝะธัะตัะบะธะต 5 `FateKeyword`** (`surge`/`focus`/`echo`/`shadow`/`ward`). ะะฐััะธัะตะฝะธะต ะฝะฐะฑะพัะฐ keywords ะทะฐ ะฟัะตะดะตะปะฐะผะธ ััะพะณะพ ัะฟะธะบะฐ.

### 8.5 Fate Choice (ะดะฒะต ะพะฟัะธะธ)

```
     โโโโโโโโโโโโ   โโโโโโโโโโโโ
     โ  ะััั 1  โ   โ  ะััั 2  โ
     โ  +2 โ   โ   โ  +1 โฆ   โ
     โ  ะะฐัะธัะบ  โ   โ  ะะฟะปะพั  โ
     โโโโโโโโโโโโ   โโโโโโโโโโโโ

      ะขะฐะฟ ะฟะพ ะพะดะฝะพะน โ ะฒัะฑะพั
      ะขะฐะนะผะตั (ะพะฟั.) โ ะดะตัะพะปั

   "ะะฒะฐ ะดััะฐ ัะตะฟััั. ะัะฑะตัะธ."
```

- ะะฑะต ะบะฐััั "ะฟะฐััั", ะฟะพะบะฐัะธะฒะฐััั
- Touch ะพะดะฝะพะน โ ะดััะณะฐั ัััะบะฝะตะตั
- ะัะฑัะฐะฝะฝะฐั: ะฒัะฟััะบะฐ + snap, ะฝะตะฒัะฑัะฐะฝะฝะฐั: fade out
- ะะฐััะฐัะธะฒ ะทะฐะฒะธัะธั ะพั ัะตะทะพะฝะฐะฝัะฐ ("ะะฒะฐ ะดััะฐ ัะตะฟััั" / "ะะฐะบะพะฝ ััะตะฑัะตั ะฒัะฑะพัะฐ" / "ะะตะผะปั ะฟะพะผะฝะธั ะดะฒะฐ ะฟััะธ")

### 8.6 ะะฐัะธัะฝะฐั Fate-ะบะฐััะฐ (ะฒัะฐะถะตัะบะธะน ัะพะด)

- ะะฒัะพะผะฐัะธัะตัะบะฐั (ะธะณัะพะบ ะฝะต ัะฟัะฐะฒะปัะตั)
- ะะตะฝััะต (60ร84), ะฑะปะธะถะต ะบ ะทะพะฝะต ะณะตัะพั
- Flip ะฑััััะตะต (200ms), ะฑะตะท ะทะฐัะตะผะฝะตะฝะธั
- ะะบัะตะฝั ะฝะฐ ัะตะทัะปััะฐัะต: damage number ั ะณะตัะพั

---

## 9. ะะตะทะพะฝะฐะฝั ะบะฐะบ ะฐัะผะพััะตัะฐ ััะตะฝั

### 9.1 ะขัะธ ัะพััะพัะฝะธั ะผะธัะฐ

```
-100 โโโโโโ -30 โโโโโโ +30 โโโโโโ +100
   ะะะะฌ          ะฏะะฌ          ะะะะะฌ
```

### 9.2 ะะฐัะฐะผะตััั ััะตะฝั ะฟะพ ัะตะทะพะฝะฐะฝัั

| ะะฐัะฐะผะตัั | ะะฐะฒั (-100...-30) | ะฏะฒั (-30...+30) | ะัะฐะฒั (+30...+100) |
|---|---|---|---|
| **ะกะฒะตั** | ะฅะพะปะพะดะฝัะน ัะธะพะปะตัะพะฒัะน, ะผะตััะฐะตั ะฝะตัะพะฒะฝะพ | ะขัะฟะปัะน ัะฝัะฐัะฝัะน, ัะพะฒะฝะพะต ะดััะฐะฝะธะต | ะงะธัััะน ะทะพะปะพัะพะน, ััะฐะฑะธะปัะฝัะน |
| **ะะธะฝัะตัะบะฐ** | ะกะธะปัะฝะฐั, ะดะฐะฒััะฐั (alpha 0.6) | ะกัะตะดะฝัั (alpha 0.3) | ะกะปะฐะฑะฐั (alpha 0.15) |
| **ะัะฝั ะฝะฐ ััะพะปะต** | ะคะธะพะปะตัะพะฒัะต, ััะตะฒะพะถะฝะพ ะฟัะปััะธัััั | ะขััะบะปัะต, ะตะดะฒะฐ ะฒะธะดะฝั | ะะพะปะพััะต, ัััะบะธะต, ัะพะฒะฝัะต |
| **ะงะฐััะธัั ะฒะพะทะดััะฐ** | ะขัะผะฐะฝ, ัะพะปะพะดะฝัะต ะธัะบัั | ะัะปั, ัะปะตััะธะต ัะณะพะปัะบะธ | ะะพะปะพััะต ะฟัะปะธะฝะบะธ, ััะฝะพััั |
| **ะคะพะฝ ััะพะปะฐ** | ะขะตะผะฝะตะต, "ะผะพะบัะพะต ะดะตัะตะฒะพ" | ะะตะนััะฐะปัะฝะพะต ะดะตัะตะฒะพ | ะกะฒะตัะปะตะต, "ัััะพะต ะดะตัะตะฒะพ" |
| **ะะฒัะบะพะฒะพะน ัะพะฝ** | ะจัะฟะพั, ะดะฐะปัะฝะธะน ะฒะพะน | ะะพััะตัะบะธะฒะฐะฝะธะต, ัะธัะธะฝะฐ | ะขะธัะธะน ะทะฒะพะฝ, "ะฒะฝะธะผะฐัะตะปัะฝะฐั ัะธัะธะฝะฐ" |
| **ะขะตะฝะธ** | ะะปะธะฝะฝัะต, ัะตะทะบะธะต, "ัะตะฒะตะปัััั" | ะกัะตะดะฝะธะต, ััะฐะฑะธะปัะฝัะต | ะะพัะพัะบะธะต, ัััะบะธะต |
| **Fate-ััะฑะฐัะบะฐ** | ะขัะผะฝะพ-ัะธะพะปะตัะพะฒะฐั, ััะฝะฐ ะผะตััะฐะตั | ะกะตัะพ-ะบะพัะธัะฝะตะฒะฐั | ะกะฒะตัะปะพ-ะทะพะปะพัะฐั, ััะฝะฐ ััะฝะฐั |

### 9.3 ะะฝัะตัะฟะพะปััะธั (ะฟะปะฐะฒะฝะฐั, ะฝะต ะดะธัะบัะตัะฝะฐั)

ะัะต ะฟะฐัะฐะผะตััั ะธะฝัะตัะฟะพะปะธัััััั **ะฟะปะฐะฒะฝะพ** ะฟะพ ะทะฝะฐัะตะฝะธั ัะตะทะพะฝะฐะฝัะฐ. ะะตั ะถัััะบะพะณะพ ะฟะตัะตะบะปััะตะฝะธั.

**ะขะตัััะตะฑะพะฒะฐะฝะธะต: HSL-ะธะฝัะตัะฟะพะปััะธั** (ะฝะต RGB, ััะพะฑั ะธะทะฑะตะถะฐัั "ะณััะทะฝัั ัะฒะตัะพะฒ"):
- ะกะตะณะผะตะฝั 1: ะะฐะฒั โ ะฏะฒั (resonance -100...0)
- ะกะตะณะผะตะฝั 2: ะฏะฒั โ ะัะฐะฒั (resonance 0...+100)
- Lerp ะฒ HSL ะฒะฝัััะธ ะบะฐะถะดะพะณะพ ัะตะณะผะตะฝัะฐ

### 9.4 Layered Audio (RTPC)

ะขัะธ ะฐัะดะธะพ-ััะตะบะฐ ะธะณัะฐัั **ะพะดะฝะพะฒัะตะผะตะฝะฝะพ**, crossfade ะฟะพ ะณัะพะผะบะพััะธ:

```swift
func updateAudio(resonance: Float) {
    let navVolume = clamp(map(resonance, -100, -30, 1.0, 0.0), 0, 1)
    let pravVolume = clamp(map(resonance, 30, 100, 0.0, 1.0), 0, 1)
    let baseVolume = 1.0 - (navVolume * 0.5) - (pravVolume * 0.5)

    audioEngine.setVolume("track_whispers", navVolume)
    audioEngine.setVolume("track_bells", pravVolume)
    audioEngine.setVolume("track_wind", baseVolume)
}
```

ะะตััะพะฒะฝัะน ะผะธะบั. ะะธะบะฐะบะธั ะฟะตัะตะบะปััะตะฝะธะน ััะตะบะพะฒ.

### 9.5 ะะธะฝะฐะผะธะบะฐ ะฒ ะฑะพั

ะะตะทะพะฝะฐะฝั ะผะพะถะตั ะผะตะฝััััั ะฒะพ ะฒัะตะผั ะฑะพั (ะบะฐััั ั `shiftBalance`, keyword-ัััะตะบัั):

- ะกะดะฒะธะณ ะฝะฐ ยฑ10: ะฟะปะฐะฒะฝัะน ะฟะตัะตัะพะด (1.5s lerp) ะฒัะตั ะฟะฐัะฐะผะตััะพะฒ
- ะกะดะฒะธะณ ะฝะฐ ยฑ30+: "ะฒะพะปะฝะฐ" ะฟัะพัะพะดะธั ะฟะพ ััะพะปั (shader ripple, 0.5s), ะทะฐัะตะผ lerp
- ะะตัะตัะตัะตะฝะธะต ะณัะฐะฝะธัั ะะฐะฒัโะฏะฒั ะธะปะธ ะฏะฒัโะัะฐะฒั: ambient-ะทะฒัะบ ะฟะตัะตัะพะดะฐ

### 9.6 ะะปะธัะฝะธะต ะฝะฐ Fate-ะบะฐััั (ะฟะพััะฐะฝะพะฒะบะฐ, ะฝะต ะผะตัะฐะฝะธะบะฐ)

| ะะตะทะพะฝะฐะฝั | Fate Reveal ััะธะปั |
|---|---|
| ะะฐะฒั | ะะฐััะฐ ะธะท ััะผะฐะฝะฐ, flip ะผะตะดะปะตะฝะฝะตะต, ะณัะป ะฝะธะถะต |
| ะฏะฒั | ะกัะฐะฝะดะฐััะฝะฐั ะฟะพะดะฐัะฐ |
| ะัะฐะฒั | ะะฐััะฐ ะฟะพัะฒะปัะตััั ัััะบะพ, flip ะฑััััะตะต, ะทะฒะพะฝ |

ะะต ะฒะปะธัะตั ะฝะฐ ะทะฝะฐัะตะฝะธั โ ัะพะปัะบะพ ะฝะฐ ะฟะพััะฐะฝะพะฒะบั.

### 9.7 ResonanceAtmosphereController

```
ResonanceAtmosphereController (Observer, read-only)
โโโ updateResonance(value: Float)
โ   โโโ interpolateLightColor(value)     // HSL lerp
โ   โโโ interpolateVignetteAlpha(value)
โ   โโโ interpolateRuneGlow(value)
โ   โโโ updateParticleEmitters(value)
โ   โโโ updateAmbientSound(value)       // RTPC crossfade
โ
โโโ animateResonanceShift(from:to:duration:)
โ   โโโ threshold crossing detection + FX
โ
โโโ getFateRevealStyle(resonance:) โ FateRevealStyle
    โโโ .nav / .yav / .prav
```

ะงะธัััะน presentation-ะบะพะฝััะพะปะปะตั. ะงะธัะฐะตั `simulation.resonance`, ะพะฑะฝะพะฒะปัะตั ะฒะธะทัะฐะป. ะะธะบะฐะบะพะน ะผััะฐัะธะธ ัะพััะพัะฝะธั.

> **ะััะธัะตะบัััะฝัะน ะธะฝะฒะฐัะธะฐะฝั:** `ResonanceAtmosphereController` **ะฝะต ะฒัะทัะฒะฐะตั** `simulation.update()`, `simulation.commitAttack()`, ะธะปะธ ะปัะฑัะต ะดััะณะธะต mutation-ะผะตัะพะดั `CombatSimulation`. ะขะพะปัะบะพ read-only ะดะพัััะฟ: `.resonance`, `.phase`, `.isOver`. Gate-ัะตัั: `testAtmosphereControllerIsReadOnly`.

---

## 10. HUD โ ะฐะผัะปะตัั ะฝะฐ ััะพะปะต

### 10.1 ะัะธะฝัะธะฟ

HUD โ ะฝะต "UI ะฟะพะฒะตัั ะธะณัั", ะฐ ะฟัะตะดะผะตัั ะฝะฐ ััะพะปะต. ะะผัะปะตัั, ะบะฐะผะฝะธ, ะทะฐััะฑะบะธ. ะะฝัะพัะผะฐัะธั ัะตัะตะท ะพะฑัะตะบัั ะผะธัะฐ.

### 10.2 Always Visible

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ะะฐัะฝะด 3                    ๐ Fate: 8  โ โ ะะตััะฝัั ะบัะพะผะบะฐ
โ  โ ะฃะณัะพะทะฐ โ                             โ
โ                                         โ
โ         [ ... ะฒัะฐะณะธ/ะบััะณ ... ]          โ
โ                                         โ
โ  โโโโโโโ                    โโโโโโโ    โ โ ะะธะถะฝะธะต ัะณะปั
โ  โ โฅ 8 โ                    โ โก 3 โ    โ
โ  โ /12 โ                    โ /5  โ    โ
โ  โโโโโโโ                    โโโโโโโ    โ
โ             โฏ -15                       โ โ ะะตะทะพะฝะฐะฝั-ััะฝะฐ
โ       [ ... ััะบะฐ ะบะฐัั ... ]             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### 10.3 HP-ะฐะผัะปะตั (ะปะตะฒัะน ะฝะธะถะฝะธะน ัะณะพะป)

- ะะฐะผะตะฝั-ะฐะผัะปะตั ั ััะฝะพะน, ะฝะฐัะตัะบะธ (ัะพะฝ ะดะปั ะฐัะผะพััะตัั)
- **ะงะธัะปะฐ โ ะดะพะผะธะฝะฐะฝัะฝัะต** (18pt, ะฑะตะปัะน, text shadow, WCAG AA ะบะพะฝััะฐัั)
- ะะฐัะตัะบะธ โ ะฐัะผะพััะตัะฝัะน ัะพะฝ, ะฝะต ะดะปั ะฟะตัะตััััะฐ
- ะัะธ ััะพะฝะต: ะฒะทะดัะฐะณะธะฒะฐะตั (shake 3pt, 100ms), haptic `.medium`
- ะัะธ ะปะตัะตะฝะธะธ: ััะฝะฐ ะฒัะฟััะธะฒะฐะตั ะทะตะปัะฝัะผ
- ะัะธัะธัะตัะบะธะน HP (<25%): ััะฝะฐ ะฟัะปััะธััะตั ะบัะฐัะฝัะผ

### 10.4 Faith-ะบะฐะผะตะฝั (ะฟัะฐะฒัะน ะฝะธะถะฝะธะน ัะณะพะป)

- ะัะธััะฐะปะป/ะบะฐะผะตะฝั, ัะฒะตัะตะฝะธะต ะฟัะพะฟะพััะธะพะฝะฐะปัะฝะพ ะพััะฐัะบั
- ะัะธ ััะฐัะต: ัััะบะฝะตะตั (200ms)
- ะัะธ ะฒะพัะฟะพะปะฝะตะฝะธะธ: ะฒัะฟััะบะฐ (150ms)
- 0 ัะฝะตัะณะธะธ: ะบะฐะผะตะฝั ััะผะฝัะน, ะดัะผะธััั

### 10.5 ะะตะทะพะฝะฐะฝั-ััะฝะฐ (ัะตะฝัั)

- ะัะฝะฐ, ัะฒะตั = ัะตะบััะธะน ัะตะทะพะฝะฐะฝั (โฝ ะะฐะฒั / โฏ ะฏะฒั / โ ะัะฐะฒั)
- ะัะธ ัะดะฒะธะณะต: "ะฟะตัะตัะตะบะฐะตั" ะฒ ะฝะพะฒัะน ัะฒะตั/ัะธะผะฒะพะป
- ะงะธัะปะพ ััะดะพะผ ะผะตะปะบะพ ะดะปั ัะพัะฝะพััะธ

### 10.6 ะคะฐะทะฐ ะธ ัะฐัะฝะด (ะฒะตััะฝัั ะบัะพะผะบะฐ)

```
ะะฐัะฝะด 3 ยท ะฃะณัะพะทะฐ
```

- ะะตะปะบะธะน ัะตะบัั, ัะฐะทะฐ ัะปะพะฒะพะผ: "ะฃะณัะพะทะฐ" / "ะะธััะฐะป" / "ะกัะดัะฑะฐ" / "ะะพัะปะตะดััะฒะธั"
- Fade-ะฟะตัะตะบะปััะตะฝะธะต (200ms), ะฑะตะท ะฑะฐะฝะฝะตัะฐ ะฟะพ ัะตะฝััั

### 10.7 Combat Log

- **ะกะบััั ะฟะพ ัะผะพะปัะฐะฝะธั**
- ะขะฐะฟ ะฟะพ ััะฝะต โ overlay "ัะฒะธัะพะบ" ั 10 ัะพะฑััะธัะผะธ
- ะกัะธะปั: ะฑะตัะตัััะฝะพะน ัะพะฝ, ัะตะบัั ะฟะตัะพะผ
- Auto-dismiss: 3s ะฑะตะท ะบะฐัะฐะฝะธั

### 10.8 ะะฝัะพัะผะฐัะธั ะฟะพ ะทะฐะฟัะพัั

| ะะฑัะตะบั | ะะตัั | ะะพะบะฐะทัะฒะฐะตั |
|---|---|---|
| HP-ะฐะผัะปะตั | Tap | ะะพะดะธัะธะบะฐัะพัั, ััะฐััั-ัััะตะบัั |
| Faith-ะบะฐะผะตะฝั | Tap | ะะฐัะตะทะตัะฒะธัะพะฒะฐะฝะพ/ะดะพัััะฟะฝะพ/ะผะฐะบั |
| ะะตะทะพะฝะฐะฝั-ััะฝะฐ | Tap | ะงะธัะปะพะฒะพะต ะทะฝะฐัะตะฝะธะต + ะพะฟะธัะฐะฝะธะต |
| Fate-ัััััะธะบ | Tap | ะกะฟะธัะพะบ discard pile |
| ะะฐััะฐ ะฒ ััะบะต | Long-press (400ms, static) | ะะพะปะฝะพะต ะพะฟะธัะฐะฝะธะต |
| ะะดะพะป ะฒัะฐะณะฐ | Tap (ะฒะฝะต drag) | ะะผั, ัะธะฟ, ัะฟะพัะพะฑะฝะพััะธ, weaknesses |

### 10.9 ะขะธะฟะพะณัะฐัะธะบะฐ

- **ะัะฝะพะฒะฝะพะน:** Cormorant Garamond (ัะปะตะณะฐะฝัะฝัะน, ัะธัะฐะตะผัะน, ะบะธัะธะปะปะธัะฐ, ะฑะตัะฟะปะฐัะฝัะน)
- **ะะฐะณะพะปะพะฒะบะธ:** Podkova (ะฑัััะฐะปัะฝัะน/ะบะฒะฐะดัะฐัะฝัะน)
- **ะะตะปะบะธะต ัะธัะปะฐ:** AvenirNext (ัะตัะฝะธัะตัะบะฐั ัะพัะฝะพััั)
- **ะัะฐะฒะธะปะพ:** ะะธะบะฐะบะพะน "ะะถะธัั" ะธะปะธ ะฝะตัะธัะฐะตะผะพะน ััะฐัะพัะปะฐะฒัะฝัะบะพะน ััะธะปะธะทะฐัะธะธ

---

## 11. ะขะตัะฝะธัะตัะบะฐั ะฐััะธัะตะบัััะฐ

### 11.1 ะงัะพ ะะ ะผะตะฝัะตะผ (ะพะฑัะฐัะฝะฐั ัะพะฒะผะตััะธะผะพััั)

ะกััะตััะฒัััะธะน API ะฒัะตั ะฟะตัะตัะธัะปะตะฝะฝัั ะผะพะดัะปะตะน ัะพััะฐะฝัะตััั **ะฑะตะท ะธะทะผะตะฝะตะฝะธะน**. ะัะต ัะตะบััะธะต ะฒัะทะพะฒั (`selectCard`, `commitAttack()`, `commitInfluence()`, `skipTurn`, `resolveEnemyTurn`) ะฟัะพะดะพะปะถะฐัั ัะฐะฑะพัะฐัั ะบะฐะบ ะตััั.

`CombatSimulation` **ัะฐััะธััะตััั** ะฝะพะฒัะผะธ ะผะตัะพะดะฐะผะธ (ยง11.2), ะฝะพ ัััะตััะฒัััะธะต ะผะตัะพะดั **ะฝะตะธะทะผะตะฝะฝั** (default `effortBonus = 0`). ะญัะพ ะฐะดะดะธัะธะฒะฝะพะต ัะฐััะธัะตะฝะธะต, ะฝะต ะผะพะดะธัะธะบะฐัะธั.

| ะะพะดัะปั | ะะพะฝััะฐะบั |
|---|---|
| `CombatSimulation` | ะกััะตััะฒัััะธะต ะผะตัะพะดั โ ะฑะตะท ะธะทะผะตะฝะตะฝะธะน. ะะฐััะธัะตะฝะธะต (Effort) โ ยง11.2 |
| `CombatSystem`, `AISystem`, `DeckSystem` | ะกะธััะตะผั ะฑะพั โ ะฑะตะท ะธะทะผะตะฝะตะฝะธะน |
| `FateService` / `FateResolution` | ะะตัะตัะผะธะฝะธะทะผ, seed-based โ ะฑะตะท ะธะทะผะตะฝะตะฝะธะน |
| `TwilightGameEngine` | Engine-first ะบะพะฝััะฐะบั โ ะฑะตะท ะธะทะผะตะฝะตะฝะธะน |
| `EchoEncounterBridge` / `EchoCombatBridge` | ะะดะฐะฟัะตัั โ ะฑะตะท ะธะทะผะตะฝะตะฝะธะน |
| `RenderSystemGroup` / `NodeRegistry` | ECSโSpriteKit sync โ ะฑะตะท ะธะทะผะตะฝะตะฝะธะน |
| `EchoCombatResult` / `EchoCombatConfig` | Data contracts โ ะฑะตะท ะธะทะผะตะฝะตะฝะธะน |

### 11.2 ะะฐััะธัะตะฝะธะต CombatSimulation (Effort โ backward-compatible)

> **ะะฐะฝะพะฝะธัะตัะบะฐั ะพัะฝะพะฒะฐ:** `CombatCalculator` ัะถะต ะฟัะธะฝะธะผะฐะตั `effortCards: Int` ะธ ะฒะบะปััะฐะตั ะฒ ัะพัะผัะปั.
> Gap โ `CombatSimulation` ะฝะต ะฟัะตะดะพััะฐะฒะปัะตั ะผะตัะพะด ัะฑัะพัะฐ ะบะฐัั.
> ะะพะปะฝัะต ะฟัะฐะฒะธะปะฐ Effort โ ยง3.5.

ะะฒะฐ ะฝะพะฒัั ะผะตัะพะดะฐ + internal state (ัะธััะพะต ัะฐััะธัะตะฝะธะต, ะฝะต ะผะพะดะธัะธะบะฐัะธั ัััะตััะฒัััะธั):

```swift
// --- Internal state ---
private(set) var effortBonus: Int = 0
private(set) var effortCardIds: [String] = []
let maxEffort: Int  // default = 2, ะธะท HeroDefinition

// --- ะะพะฒัะต ะผะตัะพะดั ---
+ burnForEffort(cardId: String) โ Bool
    // Pre: cardId ะฒ hand ะ ะฝะต ะฒ selectedCardIds ะ effortCardIds.count < maxEffort
    // Post: hand โ discardPile, effortBonus += 1, effortCardIds.append(cardId)
    // ะะต ััะฐัะธั ัะฝะตัะณะธั

+ undoBurnForEffort(cardId: String) โ Bool
    // Pre: cardId ะฒ effortCardIds
    // Post: discardPile โ hand, effortBonus -= 1, effortCardIds.remove(cardId)
```

**ะััะธัะตะบัััะฝะพะต ัะตัะตะฝะธะต:** `commitAttack()` ะธ `commitInfluence()` ัะธัะฐัั `self.effortBonus` **ะธะท ะฒะฝัััะตะฝะฝะตะณะพ ัะพััะพัะฝะธั**, ะฐ ะฝะต ะฟัะธะฝะธะผะฐัั ะตะณะพ ะบะฐะบ ะฟะฐัะฐะผะตัั. ะญัะพ ะธัะบะปััะฐะตั ัะฐััะธะฝััะพะฝ ะผะตะถะดั UI ะธ ัะธะผัะปััะธะตะน.

```swift
// commitAttack() โ ะะะ ะฟะฐัะฐะผะตััะฐ effortBonus
// ะะฝัััะธ: CombatSystem ะฟะพะปััะฐะตั self.effortBonus โ CombatCalculator
// ะะพัะปะต commit: effortBonus ัะฑัะฐััะฒะฐะตััั ะฒ 0, effortCardIds ะพัะธัะฐะตััั
```

ะกััะตััะฒัััะธะต `commitAttack()` / `commitInfluence()` ัะฐะฑะพัะฐัั ะบะฐะบ ะตััั (effortBonus = 0 ะฟะพ ัะผะพะปัะฐะฝะธั, ะตัะปะธ `burnForEffort` ะฝะต ะฒัะทัะฒะฐะปัั).

**ะะฝะฒะฐัะธะฐะฝัั Effort (ะพะฑัะทะฐัะตะปัะฝัะต gate-ัะตััั):**

| ะะฝะฒะฐัะธะฐะฝั | ะะฟะธัะฐะฝะธะต |
|---|---|
| Effort ะฝะต ััะฐัะธั ัะฝะตัะณะธั | `burnForEffort` ะฝะต ะธะทะผะตะฝัะตั `energy` / `reservedEnergy` |
| Effort ะบะฐััะฐ ะฒ discard | ะะพัะปะต `burnForEffort` ะบะฐััะฐ ะฒ `discardPile`, ะฝะต ะฒ `exhaustPile` |
| Effort ะฝะต ะผะตะฝัะตั Fate Deck | `fateDeckCount` ะฝะต ะธะทะผะตะฝัะตััั ะฟัะธ burn |
| Effort undo ัะฐะฑะพัะฐะตั | `undoBurnForEffort` ะฒะพะทะฒัะฐัะฐะตั ะบะฐััั ะฒ hand, `effortBonus -= 1` |
| ะะตะปัะทั ัะถะตัั selected card | `burnForEffort(selectedCardId)` ะฒะพะทะฒัะฐัะฐะตั `false` |
| Effort ะฟัะพัะพะดะธั ะฒ ัะพัะผัะปั | `self.effortBonus` ะฟะพะฟะฐะดะฐะตั ะฒ `CombatCalculator` โ `FateAttackResult.effortBonus` |
| Effort ัะฑัะฐััะฒะฐะตััั ะฟะพัะปะต commit | `commitAttack/Influence` ะพะฑะฝัะปัะตั `effortBonus` ะธ `effortCardIds` |
| ะะธะผะธั ัะพะฑะปัะดะฐะตััั | `burnForEffort` ะฒะพะทะฒัะฐัะฐะตั `false` ะฟัะธ `effortCardIds.count >= maxEffort` |
| ะะตัะตัะผะธะฝะธะทะผ ัะพััะฐะฝัะฝ | Replay ั Effort + ะพะดะธะฝะฐะบะพะฒัะน seed โ ะธะดะตะฝัะธัะฝัะน ัะตะทัะปััะฐั |
| Save/Load ั Effort | Snapshot ะฒะบะปััะฐะตั `effortBonus`, `effortCardIds`, `selectedCardIds`, `phase` |
| Restore ะฒะธะทัะฐะปะฐ | `RitualCombatScene` ะฒะพัััะฐะฝะฐะฒะปะธะฒะฐะตั ะะพัััั/ะััะณ/ะะตัะฐัะธ ะธะท snapshot |

### 11.3 ะกัััะบัััะฐ ะฝะพะฒัั ัะฐะนะปะพะฒ

```
Packages/EchoScenes/Sources/EchoScenes/
โโโ CombatScene.swift                    [DEPRECATED]
โโโ CombatScene+*.swift                  [DEPRECATED]
โ
โโโ RitualCombat/                        [NEW]
โ   โโโ RitualCombatScene.swift          [ะะปะฐะฒะฝะฐั ััะตะฝะฐ, lifecycle]
โ   โโโ RitualCombatScene+Input.swift    [Drag & drop, gesture priority]
โ   โโโ RitualCombatScene+Flow.swift     [Turn choreography, dynamic tempo]
โ   โโโ RitualCombatScene+Atmosphere.swift [Resonance FX, ambient]
โ   โ
โ   โโโ Controllers/
โ   โ   โโโ ResonanceAtmosphereController.swift
โ   โ   โโโ AudioLayerController.swift
โ   โ   โโโ FateRevealDirector.swift
โ   โ   โโโ DragDropController.swift
โ   โ
โ   โโโ Nodes/
โ   โ   โโโ IdolNode.swift               [Enemy idol]
โ   โ   โโโ RitualCardNode.swift         [Player card, birch-bark]
โ   โ   โโโ SealNode.swift               [Action seal totem]
โ   โ   โโโ RitualCircleNode.swift       [Commit zone]
โ   โ   โโโ BonfireNode.swift            [Effort burn zone]
โ   โ   โโโ FateCardNode.swift           [Fate reveal, 3D flip]
โ   โ   โโโ AmuletNode.swift             [HP/Faith diegetic]
โ   โ   โโโ ResonanceRuneNode.swift      [Resonance indicator]
โ   โ   โโโ TargetingArrowNode.swift     [Magic thread]
โ   โ
โ   โโโ Theme/
โ   โ   โโโ RitualTheme.swift            [Colors, fonts, sizes]
โ   โ
โ   โโโ RitualCombatSceneView.swift      [SwiftUI bridge]
```

### 11.4 Data flow (ะฑะตะท ะธะทะผะตะฝะตะฝะธะน)

```
TwilightEngine
    โ makeExternalCombatSnapshot()
EchoEncounterBridge
    โ makeCombatConfig() โ EchoCombatConfig
RitualCombatSceneView (SwiftUI)
    โ configure(config)
RitualCombatScene (SpriteKit)
    โ CombatSimulation (ECS)
    โ ResonanceAtmosphereController
    โ DragDropController
    โ FateRevealDirector
    โ
    โ [game loop]
    โ Input โ DragDrop โ simulation.selectCard/burnForEffort
    โ Seal drag โ simulation.commitAttack()  // reads self.effortBonus
    โ simulation โ RenderSystemGroup.update()
    โ simulation.resonance โ ResonanceAtmosphereController
    โ FateResolution โ FateRevealDirector.present()
    โ
    โ Combat end:
    โ onCombatEndWithResult(EchoCombatResult)
EchoCombatBridge
    โ applyCombatResult()
TwilightEngine
    โ commitExternalCombat()
```

### 11.5 ะะธะณัะฐัะธั

1. **ะกะพะทะดะฐัะผ `RitualCombatScene`** ะฟะฐัะฐะปะปะตะปัะฝะพ `CombatScene`
2. **Arena (BattleArenaView)** ะฟะตัะตะบะปััะฐะตะผ ะฟะตัะฒะพะน โ sandbox, ะฑะตะทะพะฟะฐัะฝะพ
3. **Campaign (EventView)** ะฟะตัะตะบะปััะฐะตะผ ะฒัะพัะพะน โ ัะตัะตะท ัะพั ะถะต bridge
4. **Resume path** ะฟัะพะฒะตััะตะผ โ mid-combat save/load
5. **EncounterViewModel + SwiftUI combat** โ ัะดะฐะปัะตะผ ะฟะพัะปะต ะฟะพะดัะฒะตัะถะดะตะฝะธั
6. **CombatScene (ััะฐัะฐั)** โ ัะดะฐะปัะตะผ ะฟะพัะปะต ะผะธะณัะฐัะธะธ

### 11.6 Gate-ัะตััั (ะฝะพะฒัะต)

| ะขะตัั | ะงัะพ ะฟัะพะฒะตััะตั |
|---|---|
| `testRitualSceneUsesOnlyCombatSimulationAPI` | ะกัะตะฝะฐ ะฝะต ะผััะธััะตั ECS ะฝะฐะฟััะผัั |
| `testDragDropProducesCanonicalCommands` | Drag โ selectCard/burnForEffort/commitAttack |
| `testResonanceAtmosphereIsPurePresentation` | Controller read-only |
| `testAtmosphereControllerIsReadOnly` | ะะต ะฒัะทัะฒะฐะตั mutation-ะผะตัะพะดั CombatSimulation |
| `testFateRevealPreservesExistingDeterminism` | ะะธะทัะฐะป ะฝะต ะฒะปะธัะตั ะฝะฐ FateResolution |
| `testEffortBurnMovesToDiscard` | burnForEffort โ ะบะฐััะฐ ะฒ discardPile, ะฝะต exhaustPile |
| `testEffortDoesNotSpendEnergy` | burnForEffort ะฝะต ะผะตะฝัะตั energy/reservedEnergy |
| `testEffortDoesNotAffectFateDeck` | burnForEffort ะฝะต ะผะตะฝัะตั fateDeckCount |
| `testEffortBonusPassedToFateResolve` | effortBonus ะฟะพะฟะฐะดะฐะตั ะฒ CombatCalculator ะธ FateAttackResult |
| `testEffortUndoReturnsCardToHand` | undoBurnForEffort ะฒะพะทะฒัะฐัะฐะตั ะบะฐััั, effortBonus -= 1 |
| `testCannotBurnSelectedCard` | burnForEffort(selectedCardId) โ false |
| `testEffortDefaultZero` | commitAttack() ะฑะตะท ะฟะฐัะฐะผะตััะฐ = effortBonus 0 |
| `testEffortDeterminism` | Replay ั Effort + ะพะดะธะฝะฐะบะพะฒัะน seed โ ะธะดะตะฝัะธัะฝัะน ัะตะทัะปััะฐั |
| `testEffortMidCombatSaveLoad` | Mid-combat save ั Effort โ restore โ ัะพััะพัะฝะธะต ัะพััะฐะฝะตะฝะพ |
| `testSnapshotContainsEffortFields` | Snapshot ััะฐะฝะธั effortCardIds, effortBonus, selectedCardIds, phase |
| `testRitualSceneRestoresFromSnapshot` | RitualCombatScene ะฒะพัััะฐะฝะฐะฒะปะธะฒะฐะตั ะะพัััั/ะััะณ/ะะตัะฐัะธ ะธะท snapshot |
| `testOldCombatSceneNotImportedInProduction` | Deprecated ัะฐะนะปั ะฝะต ะฒ production |

### 11.7 ะกะพะฒะผะตััะธะผะพััั ั CLAUDE.md

- **ยง1.1 Engine-First:** RitualCombatScene ะฝะต ะผััะธััะตั engine state
- **ยง1.3 Determinism:** Effort ัะตัะตะท seed-based fate
- **ยง1.4 External combat ะบะฐะบ ััะฐะฝะทะฐะบัะธั:** snapshot/commit ัะตัะตะท bridge
- **ยง1.5 Arena ะธะทะพะปััะธั:** arena ะฝะต ะบะพะผะผะธัะธั ะฒ world state
- **ยง2.1 Engine module:** Effort โ ัะธะฟะธะทะธัะพะฒะฐะฝะฝะพะต ัะฐััะธัะตะฝะธะต
- **ยง5.1 600 ัััะพะบ:** 1 ัะฐะนะป = 1 ะพัะฒะตัััะฒะตะฝะฝะพััั

---

## 12. ะะตััะธะบะฐะปัะฝัะน ััะตะท

### 12.1 ะกะพััะฐะฒ

```
1 ะฒัะฐะณ (ะะพะปะบะพะปะฐะบ โ ะฑะฐะทะพะฒัะน, ั intent-ะฟะฐััะตัะฝะพะผ)
1 ะณะตัะพะน (5 ะบะฐัั ะฒ ััะบะต, 3 ัะธะฟะฐ: ะฐัะฐะบะฐ/ะปะตัะตะฝะธะต/ะฒะปะธัะฝะธะต)
1 ะฑะพะน (3-5 ัะฐัะฝะดะพะฒ ะดะพ ะฟะพะฑะตะดั/ะฟะพัะฐะถะตะฝะธั)
2 ัะพััะพัะฝะธั ัะตะทะพะฝะฐะฝัะฐ (ะะฐะฒั ะธ ะฏะฒั โ ะฒะธะทัะฐะปัะฝะพ ัะฐะทะปะธัะธะผั)
```

### 12.2 Go/No-Go ะบัะธัะตัะธะธ (10 ะฟัะฝะบัะพะฒ)

| # | ะัะธัะตัะธะน | ะะฐะบ ะฟัะพะฒะตััะตะผ |
|---|---|---|
| 1 | **ะงะธัะฐะตะผะพััั ะทะฐ 3 ัะตะบัะฝะดั:** ะบัะพ ะฒัะฐะณ, ััะพ ะดะตะปะฐะตั (Intent), ะบะฐะบะธะต ัะบะฐะปั | Playtest: ะฝะพะฒัะน ัะตะปะพะฒะตะบ ะฟะพะฝะธะผะฐะตั ะฑะตะท ะพะฑัััะฝะตะฝะธะน |
| 2 | **ะะดะธะฝ Fate-ะผะพะผะตะฝั = ะดัะฐะผะฐ** | Playtest: ะธะณัะพะบ ัะตะฐะณะธััะตั ะฝะฐ flip |
| 3 | **Kill โ Pacify ะฟะพ ะพัััะตะฝะธั** | A/B: ะดะฒะฐ ะธััะพะดะฐ ะฒะธะทัะฐะปัะฝะพ ัะฐะทะปะธัะธะผั |
| 4 | **Pacify ะถะธะทะฝะตัะฟะพัะพะฑะตะฝ** | Gameplay: ะผะพะถะฝะพ ะฟัะพะนัะธ ัะตัะตะท WP ะฑะตะท ัะปััะฐะนะฝะพะณะพ ัะฑะธะนััะฒะฐ |
| 5 | **Wait โ ัััะดะฝัะน ัะบะธะฟ** | UI: ะฟะตัะฐัั ะัะถะดะฐัั ะธะผะตะตั "ะฒะตั" |
| 6 | **ะะตะทะพะฝะฐะฝั ะถะธะฒัั** | Screenshot test: -50 ะธ +50 ะฝะต ัะฟััะฐัั |
| 7 | **"ะฏ ะฟะพะปะพะถะธะป ะบะฐััั ะฝะฐ ััะพะป"** | Haptic test: ะฒะตั, snap, ัะดะฐั |
| 8 | **ะะตัะตัะผะธะฝะธะทะผ ัะพััะฐะฝัะฝ** | ะะฒัะพัะตัั: replay, fingerprint ัะพะฒะฟะฐะดะฐะตั |
| 9 | **ะะต ััะตะฝะฐ ัะตะบััะฐ** | UI review: โค5 ัะตะบััะพะฒัั ัะปะตะผะตะฝัะพะฒ ะฝะฐ ะพัะฝะพะฒะฝะพะผ ัะบัะฐะฝะต |
| 10 | **Encounter ะธะทะพะปะธัะพะฒะฐะฝ ะธ ัะตัะธะฐะปะธะทัะตะผ** | ะะฒัะพัะตัั: save โ kill โ restore โ ัะพั ะถะต state |

### 12.3 ะงัะพ ะะ ะฒัะพะดะธั ะฒ ะฒะตััะธะบะฐะปัะฝัะน ััะตะท

- Multi-enemy (1vN)
- Mulligan redesign
- ะัะต keyword-ัััะตะบัั (ัะพะปัะบะพ Surge ะธ Ward)
- ะะฐััะพะผะฝัะน ััะธัั (AvenirNext + Cormorant Garamond)
- ะะตะฐะปัะฝัะน ะฐัั (SF Symbols + woodcut shader)
- ะะฒัะบะพะฒัะต ะฐััะตัั (placeholder)
- Campaign integration
- EncounterViewModel retirement

---

## 13. ะะพััะดะพะบ ัะฐะฑะพัั (TDD)

```
ะคะฐะทะฐ 1: ะะะะฃะะะะขะะฆะะฏ โ ัะตะบััะฐั
  โ ะะธะทะฐะนะฝ-ะดะพะบ (ััะพั ะดะพะบัะผะตะฝั)
  โ ะฃัะฒะตัะถะดะตะฝะธะต ะฐัะดะธัะพัะฐะผะธ

ะคะฐะทะฐ 2: ะขะะกะขะะะะฏ ะะะะะะฌ
  โ Gate-ัะตััั ะดะปั ะฝะพะฒัั ะบะพะฝััะฐะบัะพะฒ
  โ Unit-ัะตััั ะดะปั Effort mechanic
  โ Determinism ัะตััั ะดะปั Effort + Fate
  โ Presentation contract ัะตััั
  โ ะัะพะฒะตัะบะฐ ะฝะฐ ะฟะพะปะฝะพัั ะธ ะบะฐัะตััะฒะพ

ะคะฐะทะฐ 3: ะะะะะะะะขะะ
  โ Effort mechanic ะฒ CombatSimulation (ECS)
  โ RitualCombatScene + nodes
  โ Drag & Drop controller
  โ Fate Reveal director
  โ Resonance atmosphere
  โ Integration (Arena ะฟะตัะฒะฐั, Campaign ะฒัะพัะฐั)

ะคะฐะทะฐ 4: ะะะะะะะะะ
  โ Playtesting ะฟะพ Go/No-Go checklist
  โ ะัะตัะฐัะธะธ ะฝะฐ ะพัะฝะพะฒะต feedback
  โ Cleanup deprecated code
```

---

## ะัะธะปะพะถะตะฝะธะต A: ะะตัะฐะฝะธะบะธ ะฑะตะท ะฟะตัะตะฟะธััะฒะฐะฝะธั ะฟัะฐะฒะธะป

### A.1 Match Bonus โ ัะบััััะน "ะบะพะผะฑะพ-ะดะฒะธะณะฐัะตะปั"

FateCard ะธะผะตะตั suit ะธ keyword; ะฟัะธ ัะพะฒะฟะฐะดะตะฝะธะธ ะผะฐััะธ ะธ ัะธะฟะฐ ะดะตะนััะฒะธั keyword ััะธะปะธะฒะฐะตััั. ะะพะปะถะฝะพ "ัะฒะตัะธัััั" ะฒ UI: ะธะบะพะฝะบะธ ะผะฐััะตะน ััะดะพะผ ั ะฟะตัะฐััะผะธ, ะฒัะฟััะบะฐ ะฟัะธ ัะพะฒะฟะฐะดะตะฝะธะธ.

### A.2 Viability Pacify โ ะพะฑัะทะฐัะตะปัะฝัะน ะบะพะฝัะตะฝั-ะดะพะปะณ

ะงัะพะฑั Pacify ะฝะต ะฑัะป frustrating, ะฝัะถะฝั ะธะฝััััะผะตะฝัั ะบะพะฝััะพะปั HP-ััะพะฝะฐ: stun/disarm/spirit-only ัะธะฝะธั, ัะฝะธะถะตะฝะธะต ัะธะท. ััะพะฝะฐ. ะฃ ะณะตัะพั-ะดะธะฟะปะพะผะฐัะฐ ะดะพะปะถะฝั ะฑััั "ะฑะตะทะพะฟะฐัะฝัะต" ะธะฝััััะผะตะฝัั. ะฃ ะฒัะฐะณะพะฒ โ ะพะบะฝะฐ ะดะปั Pacify (intent "prepare/ritual" ะดะฐัั ัะฐะฝั ะฝะฐ influence).

### A.3 ะะฐะถะดะพะผั ะฒัะฐะณั โ ะพะดะธะฝ "ะณะฒะพะทะดั"

1 ะฑะฐะทะพะฒัะน ัะธะบะป intent'ะพะฒ + 1 ัะฝะธะบะฐะปัะฝะฐั ัะธัะบะฐ (ัะธััะฐะป, ะฟัะธะทัะฒ, ััะพััั, ัะธั ะฒะพะปะธ). ะัะปะธ ะฝะตะปัะทั ะพะฑัััะฝะธัั โ ัะปะธัะบะพะผ ัะปะพะถะฝะพ.

---

## ะัะธะปะพะถะตะฝะธะต B: ะขะตัะฝะธัะตัะบะธะต ะฟะพะดัะบะฐะทะบะธ

### B.1 Woodcut Shader Pipeline

1. Threshold: ะฟะพะปััะพะฝะฐ SF Symbol โ ะถัััะบะธะน ั/ะฑ
2. Noise Overlay: ัะตะบััััะฐ "ััะผะฐ ะฑัะผะฐะณะธ" (Multiply)
3. Edge Detection: ะปัะณะบะธะน ะบะพะฝััั (ะพััะธัะบ ัะตัะฝะธะป)
4. Colorize: ัััะฝะพะต โ "ััะผะฝะพ-ะฑัััะน", ะฑะตะปะพะต โ alpha (ะฒะธะดะฝะฐ ัะตะบััััะฐ ะดะตัะตะฒะฐ)

### B.2 ResonanceAtmosphereController

```swift
class ResonanceAtmosphereController {
    weak var lightNode: SKLightNode?
    weak var vignetteNode: SKSpriteNode?
    weak var particleEmitter: SKEmitterNode?

    func update(currentResonance: Float) {
        let t = currentResonance / 100.0  // -1...1

        lightNode?.ambientColor = ColorRamp.evaluate(t: t)  // HSL lerp
        vignetteNode?.alpha = map(abs(t), 0, 1, 0.15, 0.6)

        // ะ ะะฐะฒะธ ัะฐััะธัั ะฟะฐะดะฐัั (ะฟะตะฟะตะป), ะฒ ะัะฐะฒะธ โ ะปะตััั ะฒะฒะตัั (ะธัะบัั)
        particleEmitter?.yAcceleration = map(t, -1, 1, -10, 20)
    }
}
```

### B.3 Audio Layering (RTPC)

```swift
func updateAudio(resonance: Float) {
    let navVolume = clamp(map(resonance, -100, -30, 1.0, 0.0), 0, 1)
    let pravVolume = clamp(map(resonance, 30, 100, 0.0, 1.0), 0, 1)
    let baseVolume = 1.0 - (navVolume * 0.5) - (pravVolume * 0.5)

    audioEngine.setVolume("track_whispers", navVolume)
    audioEngine.setVolume("track_bells", pravVolume)
    audioEngine.setVolume("track_wind", baseVolume)
}
```
