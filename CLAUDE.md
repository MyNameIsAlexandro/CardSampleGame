# CardSampleGame / ECHO: Legends of the Veil ‚Äî Engineering Contract (v4.1, 2026-02-12)

**–¢–∏–ø –ø—Ä–æ–µ–∫—Ç–∞:** Narrative Co-op Deckbuilder RPG (iOS)  
**–Ø–¥—Ä–æ:** Engine-First + Deterministic Runtime + Data-Driven Content  
**–¶–µ–ª—å:** –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∏–Ω–∂–µ–Ω–µ—Ä–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞, —á—Ç–æ–±—ã —Ä–∞–∑–≤–∏—Ç–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞ –Ω–µ —Ç—Ä–µ–±–æ–≤–∞–ª–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–≥–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞.

---

## 0) –ò–µ—Ä–∞—Ä—Ö–∏—è –ø—Ä–∞–≤–∏–ª

–ü—Ä–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª–∞ –≤ —ç—Ç–æ–º –ø–æ—Ä—è–¥–∫–µ:

1. **Gate-—Ç–µ—Å—Ç—ã –∏ CI-–∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã** (`CardSampleGameTests/GateTests`, `Packages/TwilightEngine/Tests`).
2. **–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç** (`CLAUDE.md`).
3. –û—Å—Ç–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (`Docs/**`).

–ò–∑–º–µ–Ω–µ–Ω–∏–µ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–º —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ **–∫–æ–¥–∞ + —Ç–µ—Å—Ç–æ–≤ + –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏** –≤ –æ–¥–Ω–æ–º change set.

---

## 1) –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã (–Ω–µ –æ–±—Å—É–∂–¥–∞—é—Ç—Å—è)

### 1.1 Engine-First –∏ action pipeline
- –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã ‚Äî runtime-state –≤ `TwilightGameEngine`.
- –õ—é–±–∞—è –º—É—Ç–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è ‚Äî —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –∫–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∏–π action/facade-–ø—É—Ç—å.
- App/UI/Bridge –Ω–µ –º—É—Ç–∏—Ä—É—é—Ç engine state –Ω–∞–ø—Ä—è–º—É—é.

### 1.2 –ì—Ä–∞–Ω–∏—Ü—ã —Å–ª–æ—ë–≤
- `Packages/TwilightEngine` ‚Äî pure logic, –±–µ–∑ UI-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫–æ–≤ (`SwiftUI`, `UIKit`, `AppKit`, `SpriteKit`, `SceneKit`).
- App/Views ‚Äî presentation + intent dispatch.
- Bridge ‚Äî –∞–¥–∞–ø—Ç–µ—Ä –¥–∞–Ω–Ω—ã—Ö, –Ω–µ –º–µ—Å—Ç–æ –¥–ª—è –¥–æ–º–µ–Ω–Ω–æ–π –ª–æ–≥–∏–∫–∏ —è–¥—Ä–∞.

### 1.3 Determinism-first
- –°–∏—Å—Ç–µ–º–Ω—ã–π RNG –∑–∞–ø—Ä–µ—â—ë–Ω –≤ gameplay-–ø–æ—Ç–æ–∫–µ.
- Seed –≤–Ω–µ—à–Ω–µ–≥–æ –±–æ—è —Ä–æ–∂–¥–∞–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ engine action-–ø—É—Ç–∏ (`.startCombat`), –Ω–µ –≤ App.
- Save/load/resume –æ–±—è–∑–∞–Ω—ã –±—ã—Ç—å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º—ã–º–∏ –¥–ª—è –æ–¥–Ω–æ–≥–æ pack set –∏ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–≥–æ –≤—Ö–æ–¥–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è.

### 1.4 External combat –∫–∞–∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è
- –°—Ç–∞—Ä—Ç –±–æ—è: engine –æ—Ç–¥–∞—ë—Ç snapshot/seed/context.
- –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –±–æ—è: engine –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –µ–¥–∏–Ω—ã–π commit —á–µ—Ä–µ–∑ –∫–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∏–π API (`commitExternalCombat` / action).
- –õ—é–±—ã–µ `pending*` –ø–æ–ª—è –∏–∑–º–µ–Ω—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —è–¥—Ä–æ–º.

### 1.5 Arena/Quick Battle –∏–∑–æ–ª—è—Ü–∏—è
- Arena ‚Äî sandbox-—Ä–µ–∂–∏–º.
- Arena –Ω–µ –ø–æ—Ç—Ä–µ–±–ª—è–µ—Ç RNG –º–∏—Ä–æ–≤–æ–≥–æ –¥–≤–∏–∂–∫–∞.
- Arena –Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ main world-engine state (–µ—Å–ª–∏ —ç—Ç–æ –Ω–µ –æ—Ç–¥–µ–ª—å–Ω—ã–π —è–≤–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º —Å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–º –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–º –∏ —Ç–µ—Å—Ç–∞–º–∏).

---

## 2) –ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã –ø–æ –º–æ–¥—É–ª—è–º

### 2.1 `Packages/TwilightEngine`
- –¢–æ–ª—å–∫–æ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã invalid action:
  - `ActionError.invalidAction(reason: InvalidActionReason)` ‚Äî –¥–∞
  - `ActionError.invalidAction(reason: String)` ‚Äî –Ω–µ—Ç
- `pendingEncounterState` –∏ –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ –ø–æ–ª—è ‚Äî `public private(set)`.
- –ü—É–±–ª–∏—á–Ω—ã–µ –æ–±—Ö–æ–¥–Ω—ã–µ API –¥–ª—è RNG/seed (`nextSeed(...)`) –∑–∞–ø—Ä–µ—â–µ–Ω—ã.
- `TwilightGameEngine` –æ–±—è–∑–∞–Ω –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞—Ç—å –¥–æ–º–µ–Ω—ã –≤ sub-managers/facades, –∞ –Ω–µ –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –≤—Å—é –ª–æ–≥–∏–∫—É –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ.

### 2.2 Bridge/App —Å–ª–æ–π
- Bridge –Ω–µ —Ä–∞—Å—à–∏—Ä—è–µ—Ç engine –¥–æ–º–µ–Ω–Ω–æ–π –ª–æ–≥–∏–∫–æ–π.
- App –Ω–µ –ø–∏—à–µ—Ç –Ω–∞–ø—Ä—è–º—É—é –≤ engine –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–æ–ª—è (`pendingEncounterState`, `pendingExternalCombatSeed`, `currentEventId` –∏ —Ç.–¥.).
- –õ—é–±–æ–π state change –∏–∑ UI –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å —è–≤–Ω—ã–π intent/action –≤ engine-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–µ.

### 2.3 DevTools –∏–∑–æ–ª—è—Ü–∏—è
- `TwilightEngineDevTools` –Ω–µ —É—á–∞—Å—Ç–≤—É–µ—Ç –≤ production graph.
- Legacy pipeline (`EventPipeline`, `MiniGameDispatcher`) –¥–æ–ø—É—Å–∫–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ devtools/—Ç–µ—Å—Ç–æ–≤–æ–º –∫–æ–Ω—Ç—É—Ä–µ –∏ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ—è–≤–Ω–æ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –≤ runtime.

---

## 3) –ö–æ–Ω—Ç–µ–Ω—Ç –∏ –ø–∞–∫–∏

### 3.1 IDs –∏ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å
- –í—Å–µ content IDs ‚Äî —Å—Ç–∞–±–∏–ª—å–Ω—ã–µ `String`.
- UUID/random IDs –¥–ª—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –∑–∞–ø—Ä–µ—â–µ–Ω—ã.
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–≥–æ `definitionId` ‚Äî fail-fast, –±–µ–∑ silent auto-repair.

### 3.2 Runtime vs Authoring
- Runtime —á–∏—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –±–∏–Ω–∞—Ä–Ω—ã–µ `.pack` (`BinaryPackReader`, `ContentRegistry.loadPacks`).
- `PackLoader`/`PackCompiler`/`PackValidator` ‚Äî authoring toolchain, –Ω–µ production runtime.

### 3.3 –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –∫–∞—Ä—Ç
- –ü—Ä–∏ authoring decode –ø–æ—Ä—è–¥–æ–∫:
  1) `PackCardDefinition` (legacy `name_ru` / `description_ru`)
  2) `StandardCardDefinition`
- –≠—Ç–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π backward compatibility —Å–ª–æ–π –¥–ª—è –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞.

### 3.4 –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç-–ø–∞–π–ø–ª–∞–π–Ω–∞
- –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∏ –ø–µ—Ä–µ–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å `.pack` —Ä–µ—Å—É—Ä—Å—ã.
- –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ–≥–æ–Ω `BundledPacksValidationTests`.
- –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ñ–æ—Ä–º–∞—Ç–∞ —Å–µ–π–≤–∞/–∫–æ–Ω—Ç–µ–Ω—Ç–∞ ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Ä—Å–∏—é.

---

## 4) –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è (hard contract)

### 4.1 Engine –∏ —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- –í engine –Ω–µ–ª—å–∑—è –∑–∞–∫—Ä–µ–ø–ª—è—Ç—å RU/EN —Ç–µ–∫—Å—Ç –∫–∞–∫ ¬´–∏—Å—Ç–∏–Ω—É¬ª.
- User-facing —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è ‚Äî —á–µ—Ä–µ–∑ key-based —Å–ª–æ–π (`L10n` / `LocalizationManager`).

### 4.2 Runtime —Ä–µ–∑–æ–ª–≤ –∏ resume-path
- –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∑–æ–ª–≤–∏—Ç—Å—è —á–µ—Ä–µ–∑ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π resolver, –∞ –Ω–µ —á–µ—Ä–µ–∑ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π `Locale.current`.
- –í resume/external-combat bridge –¥–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –ø–µ—Ä–µ-–ª–æ–∫–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å—Å—è –ø–æ —Ç–µ–∫—É—â–µ–º—É registry/locale –ø–µ—Ä–µ–¥ –ø–æ–∫–∞–∑–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.

### 4.3 UI —Ç–æ–∫–µ–Ω—ã –∏ —É—Ç–µ—á–∫–∏ –∫–ª—é—á–µ–π
- SF Symbols —Ä–µ–Ω–¥–µ—Ä—è—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–∞–∫ `Image(systemName:)`.
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ `Text("cross.fill")`, `Text("icon.*")` –∏ –ª—é–±—ã—Ö raw service keys –∑–∞–ø—Ä–µ—â–µ–Ω–æ.
- –ü–æ—è–≤–ª–µ–Ω–∏–µ raw –∫–ª—é—á–µ–π/—Ç–æ–∫–µ–Ω–æ–≤ –≤ UI —Å—á–∏—Ç–∞–µ—Ç—Å—è –¥–µ—Ñ–µ–∫—Ç–æ–º –±–ª–æ–∫–∏—Ä—É—é—â–µ–≥–æ —É—Ä–æ–≤–Ω—è –∏ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Ä–µ–≥—Ä–µ—Å—Å–∏–æ–Ω–Ω—ã–º —Ç–µ—Å—Ç–æ–º.

---

## 5) –°—Ç–∞–Ω–¥–∞—Ä—Ç—ã –∫–æ–¥–∞ –∏ –¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏–∏

### 5.1 –ñ—ë—Å—Ç–∫–∏–µ –ª–∏–º–∏—Ç—ã first-party –∫–æ–¥–∞
- Swift-—Ñ–∞–π–ª: –º–∞–∫—Å–∏–º—É–º **600 —Å—Ç—Ä–æ–∫**.
- –§–∞–π–ª engine: –º–∞–∫—Å–∏–º—É–º **5 top-level —Ç–∏–ø–æ–≤**.
- –ü—Ä–∏–Ω—Ü–∏–ø: `1 file = 1 main type`, —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è ‚Äî `Type+Feature.swift`.
- Legacy whitelist –¥–ª—è first-party –∫–æ–¥–∞ –Ω–µ –¥–æ–ø—É—Å–∫–∞–µ—Ç—Å—è.
- –ò—Å–∫–ª—é—á–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –¥–ª—è –≤–Ω–µ—à–Ω–µ–≥–æ –∫–æ–¥–∞: `/.build/`, `/Packages/ThirdParty/`, `/.codex_home/`.

### 5.2 –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Ñ–∞–π–ª–∞
–î–ª—è production/test Swift-—Ñ–∞–π–ª–æ–≤:

```swift
/// –§–∞–π–ª: ...
/// –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: ...
/// –ó–æ–Ω–∞ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏: ...
/// –ö–æ–Ω—Ç–µ–∫—Å—Ç: ...
```

### 5.3 –ó–∞–ø—Ä–µ—Ç –Ω–∞ —Ç–µ—Ö–¥–æ–ª–≥ –≤ runtime
- `TODO`/`FIXME` –≤ production-–∫–æ–¥–µ –∑–∞–ø—Ä–µ—â–µ–Ω—ã.
- –í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–æ–ø—É—Å—Ç–∏–º–æ —Ç–æ–ª—å–∫–æ –∫–∞–∫ –∫—Ä–∞—Ç–∫–æ–∂–∏–≤—É—â–∏–π migration seam —Å —Ç–µ—Å—Ç–æ–º, issue-—Å—Å—ã–ª–∫–æ–π –∏ —è–≤–Ω—ã–º –ø–ª–∞–Ω–æ–º —É–¥–∞–ª–µ–Ω–∏—è.
- –ú—ë—Ä—Ç–≤—ã–π –∫–æ–¥, –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫–ª–∞—Å—Å—ã –∏ legacy-–∫–æ—Å—Ç—ã–ª–∏ —É–¥–∞–ª—è—é—Ç—Å—è, –∞ –Ω–µ –ø—Ä—è—á—É—Ç—Å—è –∑–∞ —Ñ–ª–∞–≥–∞–º–∏ –±–µ–∑ –ø–ª–∞–Ω–∞ –≤—ã–≤–æ–¥–∞.

---

## 6) –¢–µ—Å—Ç–æ–≤–∞—è –º–æ–¥–µ–ª—å –∏ Quality Gates

### 6.1 –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä –ø–µ—Ä–µ–¥ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π
- `AuditArchitectureBoundaryGateTests`
- `AuditGateTests`
- `CodeHygieneTests`
- `LocalizationCompletenessTests`
- `LocalizationValidatorTests`
- `BundledPacksValidationTests`
- –ü–ª—é—Å —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Ç–µ—Å—Ç—ã –∏–∑–º–µ–Ω—ë–Ω–Ω–æ–≥–æ –º–æ–¥—É–ª—è.

### 6.2 –ö–æ–Ω—Ç—Ä–æ–ª—å –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
- –ö–∞–∂–¥–æ–º—É –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–º—É –¥–µ—Ñ–µ–∫—Ç—É —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ä–µ–≥—Ä–µ—Å—Å–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç (–∏–ª–∏ gate), –∫–æ—Ç–æ—Ä—ã–π –ø–∞–¥–∞–µ—Ç –¥–æ —Ñ–∏–∫—Å–∞ –∏ –ø—Ä–æ—Ö–æ–¥–∏—Ç –ø–æ—Å–ª–µ.
- –î–ª—è save/load/resume –∏ RNG –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã –¥–µ—Ç–µ—Ä–º–∏–Ω–∏–∑–º-–ø—Ä–æ–≤–µ—Ä–∫–∏ (snapshot/replay/property-style –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏).

### 6.3 Release –ø—Ä–æ–≤–µ—Ä–∫–∏
- Hard-contract –ø—Ä–æ–≤–µ—Ä–∫–∞:
  - `bash .github/ci/run_release_check.sh TestResults/QualityDashboard CardSampleGame`
  - –¢—Ä–µ–±—É–µ—Ç clean tree (`--require-clean-tree`).
- Snapshot-–ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ —Ä–∞–±–æ—á–µ–≥–æ —Å—Ä–µ–∑–∞:
  - `bash .github/ci/run_release_check_snapshot.sh TestResults/QualityDashboard CardSampleGame`

### 6.4 –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ gate-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å:
  - `Docs/QA/QUALITY_CONTROL_MODEL.md`
  - `Docs/QA/TESTING_GUIDE.md`
  - `TestResults/QualityDashboard/gate_inventory.json`

---

## 7) –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ –∏ Xcode

- –ì—Ä—É–ø–ø—ã –≤ Xcode –¥–æ–ª–∂–Ω—ã –æ—Ç—Ä–∞–∂–∞—Ç—å —Ñ–∞–π–ª–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –Ω–∞ –¥–∏—Å–∫–µ.
- –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –º–æ–¥—É–ª—å–Ω—ã–µ –∑–æ–Ω—ã (`App`, `Views`, `ViewModels`, `Packages/*`), –±–µ–∑ ¬´—Å–≤–∞–ª–æ–∫¬ª –≤ root.
- –õ—é–±–∞—è –∫—Ä—É–ø–Ω–∞—è –¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è —Å–æ–ø—Ä–æ–≤–æ–∂–¥–∞–µ—Ç—Å—è –ø–µ—Ä–µ–Ω–æ—Å–æ–º —Ñ–∞–π–ª–æ–≤ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º project structure gate.
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã –¥–ª—è –º–æ–¥—É–ª–µ–π –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —Å –ø–µ—Ä–µ–Ω–æ—Å–æ–º.

---

## 8) Definition of Done –¥–ª—è —Ñ–∏—á–∏/—Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

1. –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –¥–æ–ª–∂–µ–Ω –ª–æ–º–∞—Ç—å—Å—è.
2. –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤–Ω–µ—Å–µ–Ω—ã —Ç–æ–ª—å–∫–æ –≤ —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã—Ö —Å–ª–æ—è—Ö.
3. –î–æ–±–∞–≤–ª–µ–Ω/–æ–±–Ω–æ–≤–ª—ë–Ω —Ä–µ–≥—Ä–µ—Å—Å–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç –ø–æ–¥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ä–∏—Å–∫.
4. –ü—Ä–æ–≥–Ω–∞–Ω—ã —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ gate-—Ç–µ—Å—Ç—ã –∏ –º–æ–¥—É–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã.
5. –û–±–Ω–æ–≤–ª–µ–Ω—ã `CLAUDE.md`/`Docs/**` –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞.
6. –ù–µ—Ç –Ω–æ–≤—ã—Ö –Ω–∞—Ä—É—à–µ–Ω–∏–π hygiene, localization, determinism.

---

## 9) –ó–∞–ø—Ä–µ—â—ë–Ω–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã (–±—ã—Å—Ç—Ä—ã–π —Å–ø–∏—Å–æ–∫)

- –ü—Ä—è–º—ã–µ –ø—Ä–∏—Å–≤–∞–∏–≤–∞–Ω–∏—è engine-–∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –ø–æ–ª–µ–π –∏–∑ App/Views.
- –î–æ—Å—Ç—É–ø –∏–∑ App/Views –∫ `engine.services.rng` / `WorldRNG.shared`.
- –õ—é–±–æ–π —Å–∏—Å—Ç–µ–º–Ω—ã–π RNG –≤ gameplay (`Int.random`, `UInt64.random`, `UUID()` –∫–∞–∫ –∏—Å—Ç–æ—á–Ω–∏–∫ —Å–ª—É—á–∞–π–Ω–æ—Å—Ç–∏).
- `.invalidAction(reason: "raw string")` –≤ engine.
- –ò–º–ø–æ—Ä—Ç `TwilightEngineDevTools` –≤ production.
- `Text(...icon token...)` –≤–º–µ—Å—Ç–æ `Image(systemName:)`.
- –ö–æ–º–º–∏—Ç arena-—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤ main world-engine.
- –û—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –º—ë—Ä—Ç–≤–æ–≥–æ –∫–æ–¥–∞ –∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∫–æ—Å—Ç—ã–ª–µ–π –±–µ–∑ –ø–ª–∞–Ω–∞ —É–¥–∞–ª–µ–Ω–∏—è.

---

## 10) –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

- TwilightEngine tests:
  - `DEVELOPER_DIR=/Applications/Xcode.app/Contents/Developer /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/swift test --package-path Packages/TwilightEngine`
- Targeted app architecture gate:
  - `bash .github/ci/run_xcodebuild.sh test -scheme CardSampleGame -destination "$(bash .github/ci/select_ios_destination.sh --scheme CardSampleGame)" -only-testing:CardSampleGameTests/AuditArchitectureBoundaryGateTests`
- Snapshot release check:
  - `DEVELOPER_DIR=/Applications/Xcode.app/Contents/Developer bash .github/ci/run_release_check_snapshot.sh TestResults/QualityDashboard CardSampleGame`
- Switch development phase:
  - `./phase.sh code` / `./phase.sh tests` / `./phase.sh docs` / `./phase.sh content` / `./phase.sh contract`
  - `./phase.sh status` ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â—É—é —Ñ–∞–∑—É

---

## 11) Development Phases (file access control)

### 11.0 Phase system overview
- –ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ñ–∞–∑–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤.
- –¢–µ–∫—É—â–∞—è —Ñ–∞–∑–∞ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ `.claude/phase.json` –∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è —Å–∫—Ä–∏–ø—Ç–æ–º `./phase.sh`.
- Deny-—Å–ø–∏—Å–∫–∏ –≤ `.claude/settings.local.json` —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –±–ª–æ–∫–∏—Ä—É—é—Ç Edit –≤–Ω–µ —Ç–µ–∫—É—â–µ–π —Ñ–∞–∑—ã.
- Claude **–Ω–µ –º–æ–∂–µ—Ç** —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å —Ñ–∞–∑—É –∏–ª–∏ –º–µ–Ω—è—Ç—å `phase.json`/`settings.local.json`.

### 11.1 –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–µ—Å—Å–∏–∏
Claude –æ–±—è–∑–∞–Ω –ø—Ä–æ—á–∏—Ç–∞—Ç—å `.claude/phase.json` –∏ –ø–æ–∫–∞–∑–∞—Ç—å:
```
üìã –¢–µ–∫—É—â–∞—è —Ñ–∞–∑–∞: <phase>
‚úÖ –î–æ—Å—Ç—É–ø–Ω–æ: <allowed_summary –∏–∑ phase.json>
üîí –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ: –≤—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ
–ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ. –ß—Ç–æ –¥–µ–ª–∞–µ–º?
```
–ï—Å–ª–∏ `.claude/phase.json` –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç ‚Äî —Å–æ–æ–±—â–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é: `"–§–∞–∑–∞ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞. –ó–∞–ø—É—Å—Ç–∏—Ç–µ ./phase.sh <phase> –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ä–∞–±–æ—Ç—ã."`

### 11.2 –§–∞–∑—ã –∏ —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ –∑–æ–Ω—ã

| –§–∞–∑–∞ | –ú–æ–∂–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å |
|------|-------------------|
| `docs` | `Docs/**`, `README.md`, `gate_inventory.json` |
| `tests` | `**/Tests/**`, `CardSampleGameTests/**`, `gate_inventory.json`, `project.pbxproj` |
| `code` | `App/**`, `Views/**`, `ViewModels/**`, `Models/**`, `Managers/**`, `Utilities/**`, `Packages/*/Sources/**`, `DevTools/**`, `.github/ci/**`, `project.pbxproj` |
| `content` | `Packages/StoryPacks/**`, `Packages/CharacterPacks/**`, `**/Resources/**`, `*.lproj/**`, `Assets.xcassets/**` |
| `contract` | `CLAUDE.md`, `.claude/**` |

–í–æ –≤—Å–µ—Ö —Ñ–∞–∑–∞—Ö: —á—Ç–µ–Ω–∏–µ –ª—é–±—ã—Ö —Ñ–∞–π–ª–æ–≤ —Ä–∞–∑—Ä–µ—à–µ–Ω–æ. –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –∏ —Å–∫—Ä–∏–ø—Ç–æ–≤ —Ä–∞–∑—Ä–µ—à—ë–Ω.

### 11.3 –ü—Ä–æ—Ç–æ–∫–æ–ª STOP-–æ—Ç—á—ë—Ç–∞ (cross-phase change request)

–ö–æ–≥–¥–∞ Claude –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–∞–π–ª –≤–Ω–µ —Ç–µ–∫—É—â–µ–π —Ñ–∞–∑—ã, –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –ø–æ–ª–Ω—ã–π STOP:

1. **–ù–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞** —Ä–∞–±–æ—Ç—ã –Ω–∞–¥ —Ç–µ–∫—É—â–µ–π –∑–∞–¥–∞—á–µ–π.
2. **–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç—á—ë—Ç:**

```
‚ö†Ô∏è –¢–†–ï–ë–£–ï–¢–°–Ø –ò–ó–ú–ï–ù–ï–ù–ò–ï –í–ù–ï –¢–ï–ö–£–©–ï–ô –§–ê–ó–´

–¢–µ–∫—É—â–∞—è —Ñ–∞–∑–∞: phase:<current>
–§–∞–π–ª: <path>
–ü—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç —Ñ–∞–∑–µ: phase:<target>

–ß–¢–û: <—á—Ç–æ –∏–º–µ–Ω–Ω–æ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å>
–ó–ê–ß–ï–ú: <–ø–æ—á–µ–º—É –±–µ–∑ —ç—Ç–æ–≥–æ –Ω–µ–ª—å–∑—è –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å>
–û–ë–û–°–ù–û–í–ê–ù–ò–ï: <—Å—Å—ã–ª–∫–∞ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é/—Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ, –æ–±–æ—Å–Ω–æ–≤—ã–≤–∞—é—â–µ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ>
–í–õ–ò–Ø–ù–ò–ï: <scope –∏–∑–º–µ–Ω–µ–Ω–∏—è, —á—Ç–æ –∑–∞—Ç—Ä–∞–≥–∏–≤–∞–µ—Ç>
–†–ò–°–ö–ò: <—á—Ç–æ –º–æ–∂–µ—Ç –ø–æ–π—Ç–∏ –Ω–µ —Ç–∞–∫>
–ö–ê–ß–ï–°–¢–í–û: <–∫–∞–∫ –≤–ª–∏—è–µ—Ç –Ω–∞ –∫–∞—á–µ—Å—Ç–≤–æ ‚Äî —Å–Ω–∏–∂–∞–µ—Ç—Å—è / –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è / —É–ª—É—á—à–∞–µ—Ç—Å—è>

–ñ–¥—É —Ä–µ—à–µ–Ω–∏—è:
1. –û–¥–æ–±—Ä–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤ —ç—Ç–æ–º —Ñ–∞–π–ª–µ
2. –û—Ç–ª–æ–∂–∏—Ç—å ‚Äî –ø—Ä–æ–¥–æ–ª–∂—É —Ä–∞–±–æ—Ç—É –±–µ–∑ —ç—Ç–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è
3. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ñ–∞–∑—É –¥–ª—è batch-–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
```

3. **–ñ–¥–∞—Ç—å** —è–≤–Ω–æ–≥–æ –æ–¥–æ–±—Ä–µ–Ω–∏—è: `"–æ–¥–æ–±—Ä—è—é –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤ [—Ñ–∞–π–ª]"`.
4. **–ü—Ä–∏ –æ–¥–æ–±—Ä–µ–Ω–∏–∏** ‚Äî —Ç–æ–ª—å–∫–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –æ–¥–æ–±—Ä–µ–Ω–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ, –±–µ–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è scope.

### 11.4 –ó–∞–ø—Ä–µ—â—ë–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –≤ —Ñ–∞–∑–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ
- Claude –Ω–µ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç —Ñ–∞–∑—É —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ.
- Claude –Ω–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç `.claude/phase.json` –∏–ª–∏ `.claude/settings.local.json`.
- Claude –Ω–µ –æ–±—Ö–æ–¥–∏—Ç deny-–±–ª–æ–∫–∏—Ä–æ–≤–∫—É —á–µ—Ä–µ–∑ Bash/Write/–¥—Ä—É–≥–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã.
- Claude –Ω–µ –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ cross-phase –∏–∑–º–µ–Ω–µ–Ω–∏–π –±–µ–∑ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –æ–¥–æ–±—Ä–µ–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ.
